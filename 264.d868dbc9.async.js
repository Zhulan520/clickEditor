"use strict";(self.webpackChunkclick_insert_editor=self.webpackChunkclick_insert_editor||[]).push([[264],{2264:function(lo,Ui,Ht){Ht.d(Ui,{Xy:function(){return $h}});var T=Ht(75533),B=Ht(78120);const Oe=1024;let Kt=0;class ze{constructor(e,i){this.from=e,this.to=i}}class te{constructor(e={}){this.id=Kt++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=ie.match(e)),i=>{let r=e(i);return r===void 0?null:[this,r]}}}te.closedBy=new te({deserialize:s=>s.split(" ")}),te.openedBy=new te({deserialize:s=>s.split(" ")}),te.group=new te({deserialize:s=>s.split(" ")}),te.contextHash=new te({perNode:!0}),te.lookAhead=new te({perNode:!0}),te.mounted=new te({perNode:!0});class Te{constructor(e,i,r){this.tree=e,this.overlay=i,this.parser=r}}const ei=Object.create(null);class ie{constructor(e,i,r,l=0){this.name=e,this.props=i,this.id=r,this.flags=l}static define(e){let i=e.props&&e.props.length?Object.create(null):ei,r=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),l=new ie(e.name||"",i,e.id,r);if(e.props){for(let c of e.props)if(Array.isArray(c)||(c=c(l)),c){if(c[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");i[c[0].id]=c[1]}}return l}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let i=this.prop(te.group);return i?i.indexOf(e)>-1:!1}return this.id==e}static match(e){let i=Object.create(null);for(let r in e)for(let l of r.split(" "))i[l]=e[r];return r=>{for(let l=r.prop(te.group),c=-1;c<(l?l.length:0);c++){let d=i[c<0?r.name:l[c]];if(d)return d}}}}ie.none=new ie("",Object.create(null),0,8);class Pe{constructor(e){this.types=e;for(let i=0;i<e.length;i++)if(e[i].id!=i)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let i=[];for(let r of this.types){let l=null;for(let c of e){let d=c(r);d&&(l||(l=Object.assign({},r.props)),l[d[0].id]=d[1])}i.push(l?new ie(r.name,l,r.id,r.flags):r)}return new Pe(i)}}const he=new WeakMap,je=new WeakMap;var Z;(function(s){s[s.ExcludeBuffers=1]="ExcludeBuffers",s[s.IncludeAnonymous=2]="IncludeAnonymous",s[s.IgnoreMounts=4]="IgnoreMounts",s[s.IgnoreOverlays=8]="IgnoreOverlays"})(Z||(Z={}));class Y{constructor(e,i,r,l,c){if(this.type=e,this.children=i,this.positions=r,this.length=l,this.props=null,c&&c.length){this.props=Object.create(null);for(let[d,y]of c)this.props[typeof d=="number"?d:d.id]=y}}toString(){let e=this.prop(te.mounted);if(e&&!e.overlay)return e.tree.toString();let i="";for(let r of this.children){let l=r.toString();l&&(i&&(i+=","),i+=l)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(i.length?"("+i+")":""):i}cursor(e=0){return new Xe(this.topNode,e)}cursorAt(e,i=0,r=0){let l=he.get(this)||this.topNode,c=new Xe(l);return c.moveTo(e,i),he.set(this,c._tree),c}get topNode(){return new Be(this,0,0,null)}resolve(e,i=0){let r=tt(he.get(this)||this.topNode,e,i,!1);return he.set(this,r),r}resolveInner(e,i=0){let r=tt(je.get(this)||this.topNode,e,i,!0);return je.set(this,r),r}iterate(e){let{enter:i,leave:r,from:l=0,to:c=this.length}=e;for(let d=this.cursor((e.mode||0)|Z.IncludeAnonymous);;){let y=!1;if(d.from<=c&&d.to>=l&&(d.type.isAnonymous||i(d)!==!1)){if(d.firstChild())continue;y=!0}for(;y&&r&&!d.type.isAnonymous&&r(d),!d.nextSibling();){if(!d.parent())return;y=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let i in this.props)e.push([+i,this.props[i]]);return e}balance(e={}){return this.children.length<=8?this:ii(ie.none,this.children,this.positions,0,this.children.length,0,this.length,(i,r,l)=>new Y(this.type,i,r,l,this.propValues),e.makeTree||((i,r,l)=>new Y(ie.none,i,r,l)))}static build(e){return Ve(e)}}Y.empty=new Y(ie.none,[],[],0);class Ae{constructor(e,i){this.buffer=e,this.index=i}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new Ae(this.buffer,this.index)}}class ke{constructor(e,i,r){this.buffer=e,this.length=i,this.set=r}get type(){return ie.none}toString(){let e=[];for(let i=0;i<this.buffer.length;)e.push(this.childString(i)),i=this.buffer[i+3];return e.join(",")}childString(e){let i=this.buffer[e],r=this.buffer[e+3],l=this.set.types[i],c=l.name;if(/\W/.test(c)&&!l.isError&&(c=JSON.stringify(c)),e+=4,r==e)return c;let d=[];for(;e<r;)d.push(this.childString(e)),e=this.buffer[e+3];return c+"("+d.join(",")+")"}findChild(e,i,r,l,c){let{buffer:d}=this,y=-1;for(let k=e;k!=i&&!(Pt(c,l,d[k+1],d[k+2])&&(y=k,r>0));k=d[k+3]);return y}slice(e,i,r,l){let c=this.buffer,d=new Uint16Array(i-e);for(let y=e,k=0;y<i;)d[k++]=c[y++],d[k++]=c[y++]-r,d[k++]=c[y++]-r,d[k++]=c[y++]-e;return new ke(d,l-r,this.set)}}function Pt(s,e,i,r){switch(s){case-2:return i<e;case-1:return r>=e&&i<e;case 0:return i<e&&r>e;case 1:return i<=e&&r>e;case 2:return r>e;case 4:return!0}}function mt(s,e){let i=s.childBefore(e);for(;i;){let r=i.lastChild;if(!r||r.to!=i.to)break;r.type.isError&&r.from==r.to?(s=i,i=r.prevSibling):i=r}return s}function tt(s,e,i,r){for(var l;s.from==s.to||(i<1?s.from>=e:s.from>e)||(i>-1?s.to<=e:s.to<e);){let d=!r&&s instanceof Be&&s.index<0?null:s.parent;if(!d)return s;s=d}let c=r?0:Z.IgnoreOverlays;if(r)for(let d=s,y=d.parent;y;d=y,y=d.parent)d instanceof Be&&d.index<0&&((l=y.enter(e,i,c))===null||l===void 0?void 0:l.from)!=d.from&&(s=y);for(;;){let d=s.enter(e,i,c);if(!d)return s;s=d}}class Be{constructor(e,i,r,l){this._tree=e,this.from=i,this.index=r,this._parent=l}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,i,r,l,c=0){for(let d=this;;){for(let{children:y,positions:k}=d._tree,M=i>0?y.length:-1;e!=M;e+=i){let E=y[e],I=k[e]+d.from;if(Pt(l,r,I,I+E.length)){if(E instanceof ke){if(c&Z.ExcludeBuffers)continue;let W=E.findChild(0,E.buffer.length,i,r-I,l);if(W>-1)return new me(new Bt(d,E,e,I),null,W)}else if(c&Z.IncludeAnonymous||!E.type.isAnonymous||Re(E)){let W;if(!(c&Z.IgnoreMounts)&&E.props&&(W=E.prop(te.mounted))&&!W.overlay)return new Be(W.tree,I,e,d);let K=new Be(E,I,e,d);return c&Z.IncludeAnonymous||!K.type.isAnonymous?K:K.nextChild(i<0?E.children.length-1:0,i,r,l)}}}if(c&Z.IncludeAnonymous||!d.type.isAnonymous||(d.index>=0?e=d.index+i:e=i<0?-1:d._parent._tree.children.length,d=d._parent,!d))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,i,r=0){let l;if(!(r&Z.IgnoreOverlays)&&(l=this._tree.prop(te.mounted))&&l.overlay){let c=e-this.from;for(let{from:d,to:y}of l.overlay)if((i>0?d<=c:d<c)&&(i<0?y>=c:y>c))return new Be(l.tree,l.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,i,r)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}cursor(e=0){return new Xe(this,e)}get tree(){return this._tree}toTree(){return this._tree}resolve(e,i=0){return tt(this,e,i,!1)}resolveInner(e,i=0){return tt(this,e,i,!0)}enterUnfinishedNodesBefore(e){return mt(this,e)}getChild(e,i=null,r=null){let l=gt(this,e,i,r);return l.length?l[0]:null}getChildren(e,i=null,r=null){return gt(this,e,i,r)}toString(){return this._tree.toString()}get node(){return this}matchContext(e){return st(this,e)}}function gt(s,e,i,r){let l=s.cursor(),c=[];if(!l.firstChild())return c;if(i!=null){for(;!l.type.is(i);)if(!l.nextSibling())return c}for(;;){if(r!=null&&l.type.is(r))return c;if(l.type.is(e)&&c.push(l.node),!l.nextSibling())return r==null?c:[]}}function st(s,e,i=e.length-1){for(let r=s.parent;i>=0;r=r.parent){if(!r)return!1;if(!r.type.isAnonymous){if(e[i]&&e[i]!=r.name)return!1;i--}}return!0}class Bt{constructor(e,i,r,l){this.parent=e,this.buffer=i,this.index=r,this.start=l}}class me{constructor(e,i,r){this.context=e,this._parent=i,this.index=r,this.type=e.buffer.set.types[e.buffer.buffer[r]]}get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}child(e,i,r){let{buffer:l}=this.context,c=l.findChild(this.index+4,l.buffer[this.index+3],e,i-this.context.start,r);return c<0?null:new me(this.context,this,c)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,i,r=0){if(r&Z.ExcludeBuffers)return null;let{buffer:l}=this.context,c=l.findChild(this.index+4,l.buffer[this.index+3],i>0?1:-1,e-this.context.start,i);return c<0?null:new me(this.context,this,c)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,i=e.buffer[this.index+3];return i<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new me(this.context,this._parent,i):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,i=this._parent?this._parent.index+4:0;return this.index==i?this.externalSibling(-1):new me(this.context,this._parent,e.findChild(i,this.index,-1,0,4))}cursor(e=0){return new Xe(this,e)}get tree(){return null}toTree(){let e=[],i=[],{buffer:r}=this.context,l=this.index+4,c=r.buffer[this.index+3];if(c>l){let d=r.buffer[this.index+1],y=r.buffer[this.index+2];e.push(r.slice(l,c,d,y)),i.push(0)}return new Y(this.type,e,i,this.to-this.from)}resolve(e,i=0){return tt(this,e,i,!1)}resolveInner(e,i=0){return tt(this,e,i,!0)}enterUnfinishedNodesBefore(e){return mt(this,e)}toString(){return this.context.buffer.childString(this.index)}getChild(e,i=null,r=null){let l=gt(this,e,i,r);return l.length?l[0]:null}getChildren(e,i=null,r=null){return gt(this,e,i,r)}get node(){return this}matchContext(e){return st(this,e)}}class Xe{constructor(e,i=0){if(this.mode=i,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof Be)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let r=e._parent;r;r=r._parent)this.stack.unshift(r.index);this.bufferNode=e,this.yieldBuf(e.index)}}get name(){return this.type.name}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,i){this.index=e;let{start:r,buffer:l}=this.buffer;return this.type=i||l.set.types[l.buffer[e]],this.from=r+l.buffer[e+1],this.to=r+l.buffer[e+2],!0}yield(e){return e?e instanceof Be?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,i,r){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,i,r,this.mode));let{buffer:l}=this.buffer,c=l.findChild(this.index+4,l.buffer[this.index+3],e,i-this.buffer.start,r);return c<0?!1:(this.stack.push(this.index),this.yieldBuf(c))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,i,r=this.mode){return this.buffer?r&Z.ExcludeBuffers?!1:this.enterChild(1,e,i):this.yield(this._tree.enter(e,i,r))}parent(){if(!this.buffer)return this.yieldNode(this.mode&Z.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&Z.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:i}=this.buffer,r=this.stack.length-1;if(e<0){let l=r<0?0:this.stack[r]+4;if(this.index!=l)return this.yieldBuf(i.findChild(l,this.index,-1,0,4))}else{let l=i.buffer[this.index+3];if(l<(r<0?i.buffer.length:i.buffer[this.stack[r]+3]))return this.yieldBuf(l)}return r<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let i,r,{buffer:l}=this;if(l){if(e>0){if(this.index<l.buffer.buffer.length)return!1}else for(let c=0;c<this.index;c++)if(l.buffer.buffer[c+3]<this.index)return!1;({index:i,parent:r}=l)}else({index:i,_parent:r}=this._tree);for(;r;{index:i,_parent:r}=r)if(i>-1)for(let c=i+e,d=e<0?-1:r._tree.children.length;c!=d;c+=e){let y=r._tree.children[c];if(this.mode&Z.IncludeAnonymous||y instanceof ke||!y.type.isAnonymous||Re(y))return!1}return!0}move(e,i){if(i&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,i=0){for(;(this.from==this.to||(i<1?this.from>=e:this.from>e)||(i>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,i););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,i=null,r=0;if(e&&e.context==this.buffer)e:for(let l=this.index,c=this.stack.length;c>=0;){for(let d=e;d;d=d._parent)if(d.index==l){if(l==this.index)return d;i=d,r=c+1;break e}l=this.stack[--c]}for(let l=r;l<this.stack.length;l++)i=new me(this.buffer,i,this.stack[l]);return this.bufferNode=new me(this.buffer,i,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,i){for(let r=0;;){let l=!1;if(this.type.isAnonymous||e(this)!==!1){if(this.firstChild()){r++;continue}this.type.isAnonymous||(l=!0)}for(;l&&i&&i(this),l=this.type.isAnonymous,!this.nextSibling();){if(!r)return;this.parent(),r--,l=!0}}}matchContext(e){if(!this.buffer)return st(this.node,e);let{buffer:i}=this.buffer,{types:r}=i.set;for(let l=e.length-1,c=this.stack.length-1;l>=0;c--){if(c<0)return st(this.node,e,l);let d=r[i.buffer[this.stack[c]]];if(!d.isAnonymous){if(e[l]&&e[l]!=d.name)return!1;l--}}return!0}}function Re(s){return s.children.some(e=>e instanceof ke||!e.type.isAnonymous||Re(e))}function Ve(s){var e;let{buffer:i,nodeSet:r,maxBufferLength:l=Oe,reused:c=[],minRepeatType:d=r.types.length}=s,y=Array.isArray(i)?new Ae(i,i.length):i,k=r.types,M=0,E=0;function I(re,ne,ee,ue,lt){let{id:Ce,start:pe,end:We,size:Ot}=y,Yt=E;for(;Ot<0;)if(y.next(),Ot==-1){let qi=c[Ce];ee.push(qi),ue.push(pe-re);return}else if(Ot==-3){M=Ce;return}else if(Ot==-4){E=Ce;return}else throw new RangeError(`Unrecognized record size: ${Ot}`);let Kn=k[Ce],$i,Di,Aa=pe-re;if(We-pe<=l&&(Di=Se(y.pos-ne,lt))){let qi=new Uint16Array(Di.size-Di.skip),Zt=y.pos-Di.size,Oi=qi.length;for(;y.pos>Zt;)Oi=Je(Di.start,qi,Oi);$i=new ke(qi,We-Di.start,r),Aa=Di.start-re}else{let qi=y.pos-Ot;y.next();let Zt=[],Oi=[],gn=Ce>=d?Ce:-1,_n=0,oo=We;for(;y.pos>qi;)gn>=0&&y.id==gn&&y.size>=0?(y.end<=oo-l&&(K(Zt,Oi,pe,_n,y.end,oo,gn,Yt),_n=Zt.length,oo=y.end),y.next()):I(pe,qi,Zt,Oi,gn);if(gn>=0&&_n>0&&_n<Zt.length&&K(Zt,Oi,pe,_n,pe,oo,gn,Yt),Zt.reverse(),Oi.reverse(),gn>-1&&_n>0){let Ma=W(Kn);$i=ii(Kn,Zt,Oi,0,Zt.length,0,We-pe,Ma,Ma)}else $i=Q(Kn,Zt,Oi,We-pe,Yt-We)}ee.push($i),ue.push(Aa)}function W(re){return(ne,ee,ue)=>{let lt=0,Ce=ne.length-1,pe,We;if(Ce>=0&&(pe=ne[Ce])instanceof Y){if(!Ce&&pe.type==re&&pe.length==ue)return pe;(We=pe.prop(te.lookAhead))&&(lt=ee[Ce]+pe.length+We)}return Q(re,ne,ee,ue,lt)}}function K(re,ne,ee,ue,lt,Ce,pe,We){let Ot=[],Yt=[];for(;re.length>ue;)Ot.push(re.pop()),Yt.push(ne.pop()+ee-lt);re.push(Q(r.types[pe],Ot,Yt,Ce-lt,We-Ce)),ne.push(lt-ee)}function Q(re,ne,ee,ue,lt=0,Ce){if(M){let pe=[te.contextHash,M];Ce=Ce?[pe].concat(Ce):[pe]}if(lt>25){let pe=[te.lookAhead,lt];Ce=Ce?[pe].concat(Ce):[pe]}return new Y(re,ne,ee,ue,Ce)}function Se(re,ne){let ee=y.fork(),ue=0,lt=0,Ce=0,pe=ee.end-l,We={size:0,start:0,skip:0};e:for(let Ot=ee.pos-re;ee.pos>Ot;){let Yt=ee.size;if(ee.id==ne&&Yt>=0){We.size=ue,We.start=lt,We.skip=Ce,Ce+=4,ue+=4,ee.next();continue}let Kn=ee.pos-Yt;if(Yt<0||Kn<Ot||ee.start<pe)break;let $i=ee.id>=d?4:0,Di=ee.start;for(ee.next();ee.pos>Kn;){if(ee.size<0)if(ee.size==-3)$i+=4;else break e;else ee.id>=d&&($i+=4);ee.next()}lt=Di,ue+=Yt,Ce+=$i}return(ne<0||ue==re)&&(We.size=ue,We.start=lt,We.skip=Ce),We.size>4?We:void 0}function Je(re,ne,ee){let{id:ue,start:lt,end:Ce,size:pe}=y;if(y.next(),pe>=0&&ue<d){let We=ee;if(pe>4){let Ot=y.pos-(pe-4);for(;y.pos>Ot;)ee=Je(re,ne,ee)}ne[--ee]=We,ne[--ee]=Ce-re,ne[--ee]=lt-re,ne[--ee]=ue}else pe==-3?M=ue:pe==-4&&(E=ue);return ee}let De=[],ae=[];for(;y.pos>0;)I(s.start||0,s.bufferStart||0,De,ae,-1);let Ne=(e=s.length)!==null&&e!==void 0?e:De.length?ae[0]+De[0].length:0;return new Y(k[s.topID],De.reverse(),ae.reverse(),Ne)}const at=new WeakMap;function ti(s,e){if(!s.isAnonymous||e instanceof ke||e.type!=s)return 1;let i=at.get(e);if(i==null){i=1;for(let r of e.children){if(r.type!=s||!(r instanceof Y)){i=1;break}i+=ti(s,r)}at.set(e,i)}return i}function ii(s,e,i,r,l,c,d,y,k){let M=0;for(let Q=r;Q<l;Q++)M+=ti(s,e[Q]);let E=Math.ceil(M*1.5/8),I=[],W=[];function K(Q,Se,Je,De,ae){for(let Ne=Je;Ne<De;){let re=Ne,ne=Se[Ne],ee=ti(s,Q[Ne]);for(Ne++;Ne<De;Ne++){let ue=ti(s,Q[Ne]);if(ee+ue>=E)break;ee+=ue}if(Ne==re+1){if(ee>E){let ue=Q[re];K(ue.children,ue.positions,0,ue.children.length,Se[re]+ae);continue}I.push(Q[re])}else{let ue=Se[Ne-1]+Q[Ne-1].length-ne;I.push(ii(s,Q,Se,re,Ne,ne,ue,null,k))}W.push(ne+ae-c)}}return K(e,i,r,l,0),(y||k)(I,W,d)}class $e{constructor(){this.map=new WeakMap}setBuffer(e,i,r){let l=this.map.get(e);l||this.map.set(e,l=new Map),l.set(i,r)}getBuffer(e,i){let r=this.map.get(e);return r&&r.get(i)}set(e,i){e instanceof me?this.setBuffer(e.context.buffer,e.index,i):e instanceof Be&&this.map.set(e.tree,i)}get(e){return e instanceof me?this.getBuffer(e.context.buffer,e.index):e instanceof Be?this.map.get(e.tree):void 0}cursorSet(e,i){e.buffer?this.setBuffer(e.buffer.buffer,e.index,i):this.map.set(e.tree,i)}cursorGet(e){return e.buffer?this.getBuffer(e.buffer.buffer,e.index):this.map.get(e.tree)}}class Qe{constructor(e,i,r,l,c=!1,d=!1){this.from=e,this.to=i,this.tree=r,this.offset=l,this.open=(c?1:0)|(d?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,i=[],r=!1){let l=[new Qe(0,e.length,e,0,!1,r)];for(let c of i)c.to>e.length&&l.push(c);return l}static applyChanges(e,i,r=128){if(!i.length)return e;let l=[],c=1,d=e.length?e[0]:null;for(let y=0,k=0,M=0;;y++){let E=y<i.length?i[y]:null,I=E?E.fromA:1e9;if(I-k>=r)for(;d&&d.from<I;){let W=d;if(k>=W.from||I<=W.to||M){let K=Math.max(W.from,k)-M,Q=Math.min(W.to,I)-M;W=K>=Q?null:new Qe(K,Q,W.tree,W.offset+M,y>0,!!E)}if(W&&l.push(W),d.to>I)break;d=c<e.length?e[c++]:null}if(!E)break;k=E.toA,M=E.toA-E.toB}return l}}class de{startParse(e,i,r){return typeof e=="string"&&(e=new ge(e)),r=r?r.length?r.map(l=>new ze(l.from,l.to)):[new ze(0,0)]:[new ze(0,e.length)],this.createParse(e,i||[],r)}parse(e,i,r){let l=this.startParse(e,i,r);for(;;){let c=l.advance();if(c)return c}}}class ge{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,i){return this.string.slice(e,i)}}function yn(s){return(e,i,r,l)=>new ni(e,s,i,r,l)}class gi{constructor(e,i,r,l,c){this.parser=e,this.parse=i,this.overlay=r,this.target=l,this.ranges=c}}class Ye{constructor(e,i,r,l,c,d,y){this.parser=e,this.predicate=i,this.mounts=r,this.index=l,this.start=c,this.target=d,this.prev=y,this.depth=0,this.ranges=[]}}const qe=new te({perNode:!0});class ni{constructor(e,i,r,l,c){this.nest=i,this.input=r,this.fragments=l,this.ranges=c,this.inner=[],this.innerDone=0,this.baseTree=null,this.stoppedAt=null,this.baseParse=e}advance(){if(this.baseParse){let r=this.baseParse.advance();if(!r)return null;if(this.baseParse=null,this.baseTree=r,this.startInner(),this.stoppedAt!=null)for(let l of this.inner)l.parse.stopAt(this.stoppedAt)}if(this.innerDone==this.inner.length){let r=this.baseTree;return this.stoppedAt!=null&&(r=new Y(r.type,r.children,r.positions,r.length,r.propValues.concat([[qe,this.stoppedAt]]))),r}let e=this.inner[this.innerDone],i=e.parse.advance();if(i){this.innerDone++;let r=Object.assign(Object.create(null),e.target.props);r[te.mounted.id]=new Te(i,e.overlay,e.parser),e.target.props=r}return null}get parsedPos(){if(this.baseParse)return 0;let e=this.input.length;for(let i=this.innerDone;i<this.inner.length;i++)this.inner[i].ranges[0].from<e&&(e=Math.min(e,this.inner[i].parse.parsedPos));return e}stopAt(e){if(this.stoppedAt=e,this.baseParse)this.baseParse.stopAt(e);else for(let i=this.innerDone;i<this.inner.length;i++)this.inner[i].parse.stopAt(e)}startInner(){let e=new Wt(this.fragments),i=null,r=null,l=new Xe(new Be(this.baseTree,this.ranges[0].from,0,null),Z.IncludeAnonymous|Z.IgnoreMounts);e:for(let c,d;this.stoppedAt==null||l.from<this.stoppedAt;){let y=!0,k;if(e.hasNode(l)){if(i){let M=i.mounts.find(E=>E.frag.from<=l.from&&E.frag.to>=l.to&&E.mount.overlay);if(M)for(let E of M.mount.overlay){let I=E.from+M.pos,W=E.to+M.pos;I>=l.from&&W<=l.to&&!i.ranges.some(K=>K.from<W&&K.to>I)&&i.ranges.push({from:I,to:W})}}y=!1}else if(r&&(d=Pi(r.ranges,l.from,l.to)))y=d!=2;else if(!l.type.isAnonymous&&l.from<l.to&&(c=this.nest(l,this.input))){l.tree||Gi(l);let M=e.findMounts(l.from,c.parser);if(typeof c.overlay=="function")i=new Ye(c.parser,c.overlay,M,this.inner.length,l.from,l.tree,i);else{let E=Lt(this.ranges,c.overlay||[new ze(l.from,l.to)]);E.length&&this.inner.push(new gi(c.parser,c.parser.startParse(this.input,Ki(M,E),E),c.overlay?c.overlay.map(I=>new ze(I.from-l.from,I.to-l.from)):null,l.tree,E)),c.overlay?E.length&&(r={ranges:E,depth:0,prev:r}):y=!1}}else i&&(k=i.predicate(l))&&(k===!0&&(k=new ze(l.from,l.to)),k.from<k.to&&i.ranges.push(k));if(y&&l.firstChild())i&&i.depth++,r&&r.depth++;else for(;!l.nextSibling();){if(!l.parent())break e;if(i&&!--i.depth){let M=Lt(this.ranges,i.ranges);M.length&&this.inner.splice(i.index,0,new gi(i.parser,i.parser.startParse(this.input,Ki(i.mounts,M),M),i.ranges.map(E=>new ze(E.from-i.start,E.to-i.start)),i.target,M)),i=i.prev}r&&!--r.depth&&(r=r.prev)}}}}function Pi(s,e,i){for(let r of s){if(r.from>=i)break;if(r.to>e)return r.from<=e&&r.to>=i?2:1}return 0}function yi(s,e,i,r,l,c){if(e<i){let d=s.buffer[e+1],y=s.buffer[i-2];r.push(s.slice(e,i,d,y)),l.push(d-c)}}function Gi(s){let{node:e}=s,i=0;do s.parent(),i++;while(!s.tree);let r=0,l=s.tree,c=0;for(;c=l.positions[r]+s.from,!(c<=e.from&&c+l.children[r].length>=e.to);r++);let d=l.children[r],y=d.buffer;function k(M,E,I,W,K){let Q=M;for(;y[Q+2]+c<=e.from;)Q=y[Q+3];let Se=[],Je=[];yi(d,M,Q,Se,Je,W);let De=y[Q+1],ae=y[Q+2],Ne=De+c==e.from&&ae+c==e.to&&y[Q]==e.type.id;return Se.push(Ne?e.toTree():k(Q+4,y[Q+3],d.set.types[y[Q]],De,ae-De)),Je.push(De-W),yi(d,y[Q+3],E,Se,Je,W),new Y(I,Se,Je,K)}l.children[r]=k(0,y.length,ie.none,0,d.length);for(let M=0;M<=i;M++)s.childAfter(e.from)}class si{constructor(e,i){this.offset=i,this.done=!1,this.cursor=e.cursor(Z.IncludeAnonymous|Z.IgnoreMounts)}moveTo(e){let{cursor:i}=this,r=e-this.offset;for(;!this.done&&i.from<r;)i.to>=e&&i.enter(r,1,Z.IgnoreOverlays|Z.ExcludeBuffers)||i.next(!1)||(this.done=!0)}hasNode(e){if(this.moveTo(e.from),!this.done&&this.cursor.from+this.offset==e.from&&this.cursor.tree)for(let i=this.cursor.tree;;){if(i==e.tree)return!0;if(i.children.length&&i.positions[0]==0&&i.children[0]instanceof Y)i=i.children[0];else break}return!1}}class Wt{constructor(e){var i;if(this.fragments=e,this.curTo=0,this.fragI=0,e.length){let r=this.curFrag=e[0];this.curTo=(i=r.tree.prop(qe))!==null&&i!==void 0?i:r.to,this.inner=new si(r.tree,-r.offset)}else this.curFrag=this.inner=null}hasNode(e){for(;this.curFrag&&e.from>=this.curTo;)this.nextFrag();return this.curFrag&&this.curFrag.from<=e.from&&this.curTo>=e.to&&this.inner.hasNode(e)}nextFrag(){var e;if(this.fragI++,this.fragI==this.fragments.length)this.curFrag=this.inner=null;else{let i=this.curFrag=this.fragments[this.fragI];this.curTo=(e=i.tree.prop(qe))!==null&&e!==void 0?e:i.to,this.inner=new si(i.tree,-i.offset)}}findMounts(e,i){var r;let l=[];if(this.inner){this.inner.cursor.moveTo(e,1);for(let c=this.inner.cursor.node;c;c=c.parent){let d=(r=c.tree)===null||r===void 0?void 0:r.prop(te.mounted);if(d&&d.parser==i)for(let y=this.fragI;y<this.fragments.length;y++){let k=this.fragments[y];if(k.from>=c.to)break;k.tree==this.curFrag.tree&&l.push({frag:k,pos:c.from-k.offset,mount:d})}}}return l}}function Lt(s,e){let i=null,r=e;for(let l=1,c=0;l<s.length;l++){let d=s[l-1].to,y=s[l].from;for(;c<r.length;c++){let k=r[c];if(k.from>=y)break;k.to<=d||(i||(r=i=e.slice()),k.from<d?(i[c]=new ze(k.from,d),k.to>y&&i.splice(c+1,0,new ze(y,k.to))):k.to>y?i[c--]=new ze(y,k.to):i.splice(c--,1))}}return r}function ri(s,e,i,r){let l=0,c=0,d=!1,y=!1,k=-1e9,M=[];for(;;){let E=l==s.length?1e9:d?s[l].to:s[l].from,I=c==e.length?1e9:y?e[c].to:e[c].from;if(d!=y){let W=Math.max(k,i),K=Math.min(E,I,r);W<K&&M.push(new ze(W,K))}if(k=Math.min(E,I),k==1e9)break;E==k&&(d?(d=!1,l++):d=!0),I==k&&(y?(y=!1,c++):y=!0)}return M}function Ki(s,e){let i=[];for(let{pos:r,mount:l,frag:c}of s){let d=r+(l.overlay?l.overlay[0].from:0),y=d+l.tree.length,k=Math.max(c.from,d),M=Math.min(c.to,y);if(l.overlay){let E=l.overlay.map(W=>new ze(W.from+r,W.to+r)),I=ri(e,E,k,M);for(let W=0,K=k;;W++){let Q=W==I.length,Se=Q?M:I[W].from;if(Se>K&&i.push(new Qe(K,Se,l.tree,-d,c.from>=K,c.to<=Se)),Q)break;K=I[W].to}}else i.push(new Qe(k,M,l.tree,-d,c.from>=d,c.to<=y))}return i}let _i=0;class U{constructor(e,i,r){this.set=e,this.base=i,this.modified=r,this.id=_i++}static define(e){if(e?.base)throw new Error("Can not derive from a modified tag");let i=new U([],null,[]);if(i.set.push(i),e)for(let r of e.set)i.set.push(r);return i}static defineModifier(){let e=new it;return i=>i.modified.indexOf(e)>-1?i:it.get(i.base||i,i.modified.concat(e).sort((r,l)=>r.id-l.id))}}let Ji=0;class it{constructor(){this.instances=[],this.id=Ji++}static get(e,i){if(!i.length)return e;let r=i[0].instances.find(y=>y.base==e&&kt(i,y.modified));if(r)return r;let l=[],c=new U(l,e,i);for(let y of i)y.instances.push(c);let d=zt(i);for(let y of e.set)for(let k of d)l.push(it.get(y,k));return c}}function kt(s,e){return s.length==e.length&&s.every((i,r)=>i==e[r])}function zt(s){let e=[s];for(let i=0;i<s.length;i++)for(let r of zt(s.slice(0,i).concat(s.slice(i+1))))e.push(r);return e}function yt(s){let e=Object.create(null);for(let i in s){let r=s[i];Array.isArray(r)||(r=[r]);for(let l of i.split(" "))if(l){let c=[],d=2,y=l;for(let I=0;;){if(y=="..."&&I>0&&I+3==l.length){d=1;break}let W=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(y);if(!W)throw new RangeError("Invalid path: "+l);if(c.push(W[0]=="*"?"":W[0][0]=='"'?JSON.parse(W[0]):W[0]),I+=W[0].length,I==l.length)break;let K=l[I++];if(I==l.length&&K=="!"){d=0;break}if(K!="/")throw new RangeError("Invalid path: "+l);y=l.slice(I)}let k=c.length-1,M=c[k];if(!M)throw new RangeError("Invalid path: "+l);let E=new Li(r,d,k>0?c.slice(0,k):null);e[M]=E.sort(e[M])}}return Bi.add(e)}const Bi=new te;class Li{constructor(e,i,r,l){this.tags=e,this.mode=i,this.context=r,this.next=l}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}function Ei(s,e){let i=Object.create(null);for(let c of s)if(!Array.isArray(c.tag))i[c.tag.id]=c.class;else for(let d of c.tag)i[d.id]=c.class;let{scope:r,all:l=null}=e||{};return{style:c=>{let d=l;for(let y of c)for(let k of y.set){let M=i[k.id];if(M){d=d?d+" "+M:M;break}}return d},scope:r}}function _t(s,e){let i=null;for(let r of s){let l=r.style(e);l&&(i=i?i+" "+l:l)}return i}function bn(s,e,i,r=0,l=s.length){let c=new Xi(r,Array.isArray(e)?e:[e],i);c.highlightRange(s.cursor(),r,l,"",c.highlighters),c.flush(l)}class Xi{constructor(e,i,r){this.at=e,this.highlighters=i,this.span=r,this.class=""}startSpan(e,i){i!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=i)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,i,r,l,c){let{type:d,from:y,to:k}=e;if(y>=r||k<=i)return;d.isTop&&(c=this.highlighters.filter(K=>!K.scope||K.scope(d)));let M=l,E=d.prop(Bi),I=!1;for(;E;){if(!E.context||e.matchContext(E.context)){let K=_t(c,E.tags);K&&(M&&(M+=" "),M+=K,E.mode==1?l+=(l?" ":"")+K:E.mode==0&&(I=!0));break}E=E.next}if(this.startSpan(e.from,M),I)return;let W=e.tree&&e.tree.prop(te.mounted);if(W&&W.overlay){let K=e.node.enter(W.overlay[0].from+y,1),Q=this.highlighters.filter(Je=>!Je.scope||Je.scope(W.tree.type)),Se=e.firstChild();for(let Je=0,De=y;;Je++){let ae=Je<W.overlay.length?W.overlay[Je]:null,Ne=ae?ae.from+y:k,re=Math.max(i,De),ne=Math.min(r,Ne);if(re<ne&&Se)for(;e.from<ne&&(this.highlightRange(e,re,ne,l,c),this.startSpan(Math.min(r,e.to),M),!(e.to>=Ne||!e.nextSibling())););if(!ae||Ne>r)break;De=ae.to+y,De>i&&(this.highlightRange(K.cursor(),Math.max(i,ae.from+y),Math.min(r,De),l,Q),this.startSpan(De,M))}Se&&e.parent()}else if(e.firstChild()){do if(!(e.to<=i)){if(e.from>=r)break;this.highlightRange(e,i,r,l,c),this.startSpan(Math.min(r,e.to),M)}while(e.nextSibling());e.parent()}}}const $=U.define,vt=$(),St=$(),Ri=$(St),Fe=$(St),ce=$(),fe=$(ce),oe=$(ce),Ze=$(),ht=$(Ze),Ge=$(),bt=$(),Qi=$(),ct=$(Qi),be=$(),q={comment:vt,lineComment:$(vt),blockComment:$(vt),docComment:$(vt),name:St,variableName:$(St),typeName:Ri,tagName:$(Ri),propertyName:Fe,attributeName:$(Fe),className:$(St),labelName:$(St),namespace:$(St),macroName:$(St),literal:ce,string:fe,docString:$(fe),character:$(fe),attributeValue:$(fe),number:oe,integer:$(oe),float:$(oe),bool:$(ce),regexp:$(ce),escape:$(ce),color:$(ce),url:$(ce),keyword:Ge,self:$(Ge),null:$(Ge),atom:$(Ge),unit:$(Ge),modifier:$(Ge),operatorKeyword:$(Ge),controlKeyword:$(Ge),definitionKeyword:$(Ge),moduleKeyword:$(Ge),operator:bt,derefOperator:$(bt),arithmeticOperator:$(bt),logicOperator:$(bt),bitwiseOperator:$(bt),compareOperator:$(bt),updateOperator:$(bt),definitionOperator:$(bt),typeOperator:$(bt),controlOperator:$(bt),punctuation:Qi,separator:$(Qi),bracket:ct,angleBracket:$(ct),squareBracket:$(ct),paren:$(ct),brace:$(ct),content:Ze,heading:ht,heading1:$(ht),heading2:$(ht),heading3:$(ht),heading4:$(ht),heading5:$(ht),heading6:$(ht),contentSeparator:$(Ze),list:$(Ze),quote:$(Ze),emphasis:$(Ze),strong:$(Ze),link:$(Ze),monospace:$(Ze),strikethrough:$(Ze),inserted:$(),deleted:$(),changed:$(),invalid:$(),meta:be,documentMeta:$(be),annotation:$(be),processingInstruction:$(be),definition:U.defineModifier(),constant:U.defineModifier(),function:U.defineModifier(),standard:U.defineModifier(),local:U.defineModifier(),special:U.defineModifier()},Ii=Ei([{tag:q.link,class:"tok-link"},{tag:q.heading,class:"tok-heading"},{tag:q.emphasis,class:"tok-emphasis"},{tag:q.strong,class:"tok-strong"},{tag:q.keyword,class:"tok-keyword"},{tag:q.atom,class:"tok-atom"},{tag:q.bool,class:"tok-bool"},{tag:q.url,class:"tok-url"},{tag:q.labelName,class:"tok-labelName"},{tag:q.inserted,class:"tok-inserted"},{tag:q.deleted,class:"tok-deleted"},{tag:q.literal,class:"tok-literal"},{tag:q.string,class:"tok-string"},{tag:q.number,class:"tok-number"},{tag:[q.regexp,q.escape,q.special(q.string)],class:"tok-string2"},{tag:q.variableName,class:"tok-variableName"},{tag:q.local(q.variableName),class:"tok-variableName tok-local"},{tag:q.definition(q.variableName),class:"tok-variableName tok-definition"},{tag:q.special(q.variableName),class:"tok-variableName2"},{tag:q.definition(q.propertyName),class:"tok-propertyName tok-definition"},{tag:q.typeName,class:"tok-typeName"},{tag:q.namespace,class:"tok-namespace"},{tag:q.className,class:"tok-className"},{tag:q.macroName,class:"tok-macroName"},{tag:q.propertyName,class:"tok-propertyName"},{tag:q.operator,class:"tok-operator"},{tag:q.comment,class:"tok-comment"},{tag:q.meta,class:"tok-meta"},{tag:q.invalid,class:"tok-invalid"},{tag:q.punctuation,class:"tok-punctuation"}]);var bi=Ht(28699),Ni;const ye=new te;function Yi(s){return Facet.define({combine:s?e=>e.concat(s):void 0})}class Ue{constructor(e,i,r=[]){this.data=e,B.yy.prototype.hasOwnProperty("tree")||Object.defineProperty(B.yy.prototype,"tree",{get(){return Le(this)}}),this.parser=i,this.extension=[Ct.of(this),B.yy.languageData.of((l,c,d)=>l.facet(Jt(l,c,d)))].concat(r)}isActiveAt(e,i,r=-1){return Jt(e,i,r)==this.data}findRegions(e){let i=e.facet(Ct);if(i?.data==this.data)return[{from:0,to:e.doc.length}];if(!i||!i.allowsNesting)return[];let r=[],l=(c,d)=>{if(c.prop(ye)==this.data){r.push({from:d,to:d+c.length});return}let y=c.prop(te.mounted);if(y){if(y.tree.prop(ye)==this.data){if(y.overlay)for(let k of y.overlay)r.push({from:k.from+d,to:k.to+d});else r.push({from:d,to:d+c.length});return}else if(y.overlay){let k=r.length;if(l(y.tree,y.overlay[0].from+d),r.length>k)return}}for(let k=0;k<c.children.length;k++){let M=c.children[k];M instanceof Y&&l(M,c.positions[k]+d)}};return l(Le(e),0),r}get allowsNesting(){return!0}}Ue.setState=B.Py.define();function Jt(s,e,i){let r=s.facet(Ct);if(!r)return null;let l=r.data;if(r.allowsNesting)for(let c=Le(s).topNode;c;c=c.enter(e,i,Z.ExcludeBuffers))l=c.type.prop(ye)||l;return l}class Xt extends null{constructor(e,i){super(e,i),this.parser=i}static define(e){let i=Yi(e.languageData);return new Xt(i,e.parser.configure({props:[ye.add(r=>r.isTop?i:void 0)]}))}configure(e){return new Xt(this.data,this.parser.configure(e))}get allowsNesting(){return this.parser.hasWrappers()}}function Le(s){let e=s.field(Ue.state,!1);return e?e.tree:Y.empty}function nt(s,e,i=50){var r;let l=(r=s.field(Ue.state,!1))===null||r===void 0?void 0:r.context;return l&&(l.isDone(e)||l.work(i,e))?l.tree:null}function Zi(s,e=s.doc.length){var i;return((i=s.field(Ue.state,!1))===null||i===void 0?void 0:i.context.isDone(e))||!1}function wi(s,e=s.viewport.to,i=100){let r=nt(s.state,e,i);return r!=Le(s.state)&&s.dispatch({}),!!r}function Et(s){var e;return((e=s.plugin(Nt))===null||e===void 0?void 0:e.isWorking())||!1}class oi{constructor(e,i=e.length){this.doc=e,this.length=i,this.cursorPos=0,this.string="",this.cursor=e.iter()}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,i){let r=this.cursorPos-this.string.length;return e<r||i>=this.cursorPos?this.doc.sliceString(e,i):this.string.slice(e-r,i-r)}}let Rt=null;class ft{constructor(e,i,r=[],l,c,d,y,k){this.parser=e,this.state=i,this.fragments=r,this.tree=l,this.treeLen=c,this.viewport=d,this.skipped=y,this.scheduleOn=k,this.parse=null,this.tempSkipped=[]}static create(e,i,r){return new ft(e,i,[],Y.empty,0,r,[],null)}startParse(){return this.parser.startParse(new oi(this.state.doc),this.fragments)}work(e,i){return i!=null&&i>=this.state.doc.length&&(i=void 0),this.tree!=Y.empty&&this.isDone(i??this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var r;if(typeof e=="number"){let l=Date.now()+e;e=()=>Date.now()>l}for(this.parse||(this.parse=this.startParse()),i!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>i)&&i<this.state.doc.length&&this.parse.stopAt(i);;){let l=this.parse.advance();if(l)if(this.fragments=this.withoutTempSkipped(Qe.addTree(l,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(r=this.parse.stoppedAt)!==null&&r!==void 0?r:this.state.doc.length,this.tree=l,this.parse=null,this.treeLen<(i??this.state.doc.length))this.parse=this.startParse();else return!0;if(e())return!1}})}takeTree(){let e,i;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(i=this.parse.advance()););}),this.treeLen=e,this.tree=i,this.fragments=this.withoutTempSkipped(Qe.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let i=Rt;Rt=this;try{return e()}finally{Rt=i}}withoutTempSkipped(e){for(let i;i=this.tempSkipped.pop();)e=Ie(e,i.from,i.to);return e}changes(e,i){let{fragments:r,tree:l,treeLen:c,viewport:d,skipped:y}=this;if(this.takeTree(),!e.empty){let k=[];if(e.iterChangedRanges((M,E,I,W)=>k.push({fromA:M,toA:E,fromB:I,toB:W})),r=Qe.applyChanges(r,k),l=Y.empty,c=0,d={from:e.mapPos(d.from,-1),to:e.mapPos(d.to,1)},this.skipped.length){y=[];for(let M of this.skipped){let E=e.mapPos(M.from,1),I=e.mapPos(M.to,-1);E<I&&y.push({from:E,to:I})}}}return new ft(this.parser,i,r,l,c,d,y,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let i=this.skipped.length;for(let r=0;r<this.skipped.length;r++){let{from:l,to:c}=this.skipped[r];l<e.to&&c>e.from&&(this.fragments=Ie(this.fragments,l,c),this.skipped.splice(r--,1))}return this.skipped.length>=i?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,i){this.skipped.push({from:e,to:i})}static getSkippingParser(e){return new class extends de{createParse(i,r,l){let c=l[0].from,d=l[l.length-1].to;return{parsedPos:c,advance(){let k=Rt;if(k){for(let M of l)k.tempSkipped.push(M);e&&(k.scheduleOn=k.scheduleOn?Promise.all([k.scheduleOn,e]):e)}return this.parsedPos=d,new Y(ie.none,[],[],d-c)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let i=this.fragments;return this.treeLen>=e&&i.length&&i[0].from==0&&i[0].to>=e}static get(){return Rt}}function Ie(s,e,i){return Qe.applyChanges(s,[{fromA:e,toA:i,fromB:e,toB:i}])}class It{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let i=this.context.changes(e.changes,e.state),r=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),i.viewport.to);return i.work(20,r)||i.takeTree(),new It(i)}static init(e){let i=Math.min(3e3,e.doc.length),r=ft.create(e.facet(Ct).parser,e,{from:0,to:i});return r.work(20,i)||r.takeTree(),new It(r)}}Ue.state=B.QQ.define({create:It.init,update(s,e){for(let i of e.effects)if(i.is(Ue.setState))return i.value;return e.startState.facet(Ct)!=e.state.facet(Ct)?It.init(e.state):s.apply(e)}});let xi=s=>{let e=setTimeout(()=>s(),500);return()=>clearTimeout(e)};typeof requestIdleCallback<"u"&&(xi=s=>{let e=-1,i=setTimeout(()=>{e=requestIdleCallback(s,{timeout:400})},100);return()=>e<0?clearTimeout(i):cancelIdleCallback(e)});const jt=typeof navigator<"u"&&(!((Ni=navigator.scheduling)===null||Ni===void 0)&&Ni.isInputPending)?()=>navigator.scheduling.isInputPending():null,Nt=T.lg.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let i=this.view.state.field(Ue.state).context;(i.updateViewport(e.view.viewport)||this.view.viewport.to>i.treeLen)&&this.scheduleWork(),e.docChanged&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(i)}scheduleWork(){if(this.working)return;let{state:e}=this.view,i=e.field(Ue.state);(i.tree!=i.context.tree||!i.context.isDone(e.doc.length))&&(this.working=xi(this.work))}work(e){this.working=null;let i=Date.now();if(this.chunkEnd<i&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=i+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:r,viewport:{to:l}}=this.view,c=r.field(Ue.state);if(c.tree==c.context.tree&&c.context.isDone(l+1e5))return;let d=Date.now()+Math.min(this.chunkBudget,100,e&&!jt?Math.max(25,e.timeRemaining()-5):1e9),y=c.context.treeLen<l&&r.doc.length>l+1e3,k=c.context.work(()=>jt&&jt()||Date.now()>d,l+(y?0:1e5));this.chunkBudget-=Date.now()-i,(k||this.chunkBudget<=0)&&(c.context.takeTree(),this.view.dispatch({effects:Ue.setState.of(new It(c.context))})),this.chunkBudget>0&&!(k&&!y)&&this.scheduleWork(),this.checkAsyncSchedule(c.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(i=>(0,T.OO)(this.view.state,i)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),Ct=B.r$.define({combine(s){return s.length?s[0]:null},enables:[Ue.state,Nt]});class Jn{constructor(e,i=[]){this.language=e,this.support=i,this.extension=[e,i]}}class li{constructor(e,i,r,l,c,d=void 0){this.name=e,this.alias=i,this.extensions=r,this.filename=l,this.loadFunc=c,this.support=d,this.loading=null}load(){return this.loading||(this.loading=this.loadFunc().then(e=>this.support=e,e=>{throw this.loading=null,e}))}static of(e){let{load:i,support:r}=e;if(!i){if(!r)throw new RangeError("Must pass either 'load' or 'support' to LanguageDescription.of");i=()=>Promise.resolve(r)}return new li(e.name,(e.alias||[]).concat(e.name).map(l=>l.toLowerCase()),e.extensions||[],e.filename,i,r)}static matchFilename(e,i){for(let l of e)if(l.filename&&l.filename.test(i))return l;let r=/\.([^.]+)$/.exec(i);if(r){for(let l of e)if(l.extensions.indexOf(r[1])>-1)return l}return null}static matchLanguageName(e,i,r=!0){i=i.toLowerCase();for(let l of e)if(l.alias.some(c=>c==i))return l;if(r)for(let l of e)for(let c of l.alias){let d=i.indexOf(c);if(d>-1&&(c.length>2||!/\w/.test(i[d-1])&&!/\w/.test(i[d+c.length])))return l}return null}}const C=B.r$.define(),f=B.r$.define({combine:s=>{if(!s.length)return"  ";if(!/^(?: +|\t+)$/.test(s[0]))throw new Error("Invalid indent unit: "+JSON.stringify(s[0]));return s[0]}});function p(s){let e=s.facet(f);return e.charCodeAt(0)==9?s.tabSize*e.length:e.length}function g(s,e){let i="",r=s.tabSize;if(s.facet(f).charCodeAt(0)==9)for(;e>=r;)i+="	",e-=r;for(let l=0;l<e;l++)i+=" ";return i}function w(s,e){s instanceof B.yy&&(s=new v(s));for(let r of s.state.facet(C)){let l=r(s,e);if(l!=null)return l}let i=Le(s.state);return i?O(s,i,e):null}class v{constructor(e,i={}){this.state=e,this.options=i,this.unit=p(e)}lineAt(e,i=1){let r=this.state.doc.lineAt(e),{simulateBreak:l,simulateDoubleBreak:c}=this.options;return l!=null&&l>=r.from&&l<=r.to?c&&l==e?{text:"",from:e}:(i<0?l<e:l<=e)?{text:r.text.slice(l-r.from),from:l}:{text:r.text.slice(0,l-r.from),from:r.from}:r}textAfterPos(e,i=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:r,from:l}=this.lineAt(e,i);return r.slice(e-l,Math.min(r.length,e+100-l))}column(e,i=1){let{text:r,from:l}=this.lineAt(e,i),c=this.countColumn(r,e-l),d=this.options.overrideIndentation?this.options.overrideIndentation(l):-1;return d>-1&&(c+=d-this.countColumn(r,r.search(/\S|$/))),c}countColumn(e,i=e.length){return(0,B.IS)(e,this.state.tabSize,i)}lineIndent(e,i=1){let{text:r,from:l}=this.lineAt(e,i),c=this.options.overrideIndentation;if(c){let d=c(l);if(d>-1)return d}return this.countColumn(r,r.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const S=new te;function O(s,e,i){return H(e.resolveInner(i).enterUnfinishedNodesBefore(i),i,s)}function L(s){return s.pos==s.options.simulateBreak&&s.options.simulateDoubleBreak}function R(s){let e=s.type.prop(S);if(e)return e;let i=s.firstChild,r;if(i&&(r=i.type.prop(te.closedBy))){let l=s.lastChild,c=l&&r.indexOf(l.name)>-1;return d=>Ee(d,!0,1,void 0,c&&!L(d)?l.from:void 0)}return s.parent==null?z:null}function H(s,e,i){for(;s;s=s.parent){let r=R(s);if(r)return r(G.create(i,e,s))}return null}function z(){return 0}class G extends v{constructor(e,i,r){super(e.state,e.options),this.base=e,this.pos=i,this.node=r}static create(e,i,r){return new G(e,i,r)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){let e=this.state.doc.lineAt(this.node.from);for(;;){let i=this.node.resolve(e.from);for(;i.parent&&i.parent.from==i.from;)i=i.parent;if(j(i,this.node))break;e=this.state.doc.lineAt(i.from)}return this.lineIndent(e.from)}continue(){let e=this.node.parent;return e?H(e,this.pos,this.base):0}}function j(s,e){for(let i=e;i;i=i.parent)if(s==i)return!0;return!1}function ve(s){let e=s.node,i=e.childAfter(e.from),r=e.lastChild;if(!i)return null;let l=s.options.simulateBreak,c=s.state.doc.lineAt(i.from),d=l==null||l<=c.from?c.to:Math.min(c.to,l);for(let y=i.to;;){let k=e.childAfter(y);if(!k||k==r)return null;if(!k.type.isSkipped)return k.from<d?i:null;y=k.to}}function At({closing:s,align:e=!0,units:i=1}){return r=>Ee(r,e,i,s)}function Ee(s,e,i,r,l){let c=s.textAfter,d=c.match(/^\s*/)[0].length,y=r&&c.slice(d,d+r.length)==r||l==s.pos+d,k=e?ve(s):null;return k?y?s.column(k.from):s.column(k.to):s.baseIndent+(y?0:s.unit*i)}const en=s=>s.baseIndent;function ki({except:s,units:e=1}={}){return i=>{let r=s&&s.test(i.textAfter);return i.baseIndent+(r?0:e*i.unit)}}const Is=200;function Ns(){return B.yy.transactionFilter.of(s=>{if(!s.docChanged||!s.isUserEvent("input.type")&&!s.isUserEvent("input.complete"))return s;let e=s.startState.languageDataAt("indentOnInput",s.startState.selection.main.head);if(!e.length)return s;let i=s.newDoc,{head:r}=s.newSelection.main,l=i.lineAt(r);if(r>l.from+Is)return s;let c=i.sliceString(l.from,r);if(!e.some(M=>M.test(c)))return s;let{state:d}=s,y=-1,k=[];for(let{head:M}of d.selection.ranges){let E=d.doc.lineAt(M);if(E.from==y)continue;y=E.from;let I=w(d,E.from);if(I==null)continue;let W=/^\s*/.exec(E.text)[0],K=g(d,I);W!=K&&k.push({from:E.from,to:E.from+W.length,insert:K})}return k.length?[s,{changes:k,sequential:!0}]:s})}const Vs=B.r$.define(),Fs=new te;function Cl(s){let e=s.firstChild,i=s.lastChild;return e&&e.to<i.from?{from:e.to,to:i.type.isError?s.to:i.from}:null}function Hs(s,e,i){let r=Le(s);if(r.length<i)return null;let l=r.resolveInner(i),c=null;for(let d=l;d;d=d.parent){if(d.to<=i||d.from>i)continue;if(c&&d.from<e)break;let y=d.type.prop(Fs);if(y&&(d.to<r.length-50||r.length==s.doc.length||!Ws(d))){let k=y(d,s);k&&k.from<=i&&k.from>=e&&k.to>i&&(c=k)}}return c}function Ws(s){let e=s.lastChild;return e&&e.to==s.to&&e.type.isError}function wn(s,e,i){for(let r of s.facet(Vs)){let l=r(s,e,i);if(l)return l}return Hs(s,e,i)}function zs(s,e){let i=e.mapPos(s.from,1),r=e.mapPos(s.to,-1);return i>=r?void 0:{from:i,to:r}}const tn=B.Py.define({map:zs}),nn=B.Py.define({map:zs});function js(s){let e=[];for(let{head:i}of s.state.selection.ranges)e.some(r=>r.from<=i&&r.to>=i)||e.push(s.lineBlockAt(i));return e}const ai=B.QQ.define({create(){return T.p.none},update(s,e){s=s.map(e.changes);for(let i of e.effects)i.is(tn)&&!ao(s,i.value.from,i.value.to)?s=s.update({add:[Xs.range(i.value.from,i.value.to)]}):i.is(nn)&&(s=s.update({filter:(r,l)=>i.value.from!=r||i.value.to!=l,filterFrom:i.value.from,filterTo:i.value.to}));if(e.selection){let i=!1,{head:r}=e.selection.main;s.between(r,r,(l,c)=>{l<r&&c>r&&(i=!0)}),i&&(s=s.update({filterFrom:r,filterTo:r,filter:(l,c)=>c<=r||l>=r}))}return s},provide:s=>T.tk.decorations.from(s)});function Al(s){return s.field(ai,!1)||RangeSet.empty}function xn(s,e,i){var r;let l=null;return(r=s.field(ai,!1))===null||r===void 0||r.between(e,i,(c,d)=>{(!l||l.from>c)&&(l={from:c,to:d})}),l}function ao(s,e,i){let r=!1;return s.between(e,e,(l,c)=>{l==e&&c==i&&(r=!0)}),r}function $s(s,e){return s.field(ai,!1)?e:e.concat(B.Py.appendConfig.of(Js()))}const Xn=s=>{for(let e of js(s)){let i=wn(s.state,e.from,e.to);if(i)return s.dispatch({effects:$s(s.state,[tn.of(i),Qn(s,i)])}),!0}return!1},qs=s=>{if(!s.state.field(ai,!1))return!1;let e=[];for(let i of js(s)){let r=xn(s.state,i.from,i.to);r&&e.push(nn.of(r),Qn(s,r,!1))}return e.length&&s.dispatch({effects:e}),e.length>0};function Qn(s,e,i=!0){let r=s.state.doc.lineAt(e.from).number,l=s.state.doc.lineAt(e.to).number;return T.tk.announce.of(`${s.state.phrase(i?"Folded lines":"Unfolded lines")} ${r} ${s.state.phrase("to")} ${l}.`)}const Gs=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:Xn},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:qs},{key:"Ctrl-Alt-[",run:s=>{let{state:e}=s,i=[];for(let r=0;r<e.doc.length;){let l=s.lineBlockAt(r),c=wn(e,l.from,l.to);c&&i.push(tn.of(c)),r=(c?s.lineBlockAt(c.to):l).to+1}return i.length&&s.dispatch({effects:$s(s.state,i)}),!!i.length}},{key:"Ctrl-Alt-]",run:s=>{let e=s.state.field(ai,!1);if(!e||!e.size)return!1;let i=[];return e.between(0,s.state.doc.length,(r,l)=>{i.push(nn.of({from:r,to:l}))}),s.dispatch({effects:i}),!0}}],Ks={placeholderDOM:null,placeholderText:"\u2026"},_s=B.r$.define({combine(s){return(0,B.BO)(s,Ks)}});function Js(s){let e=[ai,fo];return s&&e.push(_s.of(s)),e}const Xs=T.p.replace({widget:new class extends T.l9{toDOM(s){let{state:e}=s,i=e.facet(_s),r=c=>{let d=s.lineBlockAt(s.posAtDOM(c.target)),y=xn(s.state,d.from,d.to);y&&s.dispatch({effects:nn.of(y)}),c.preventDefault()};if(i.placeholderDOM)return i.placeholderDOM(s,r);let l=document.createElement("span");return l.textContent=i.placeholderText,l.setAttribute("aria-label",e.phrase("folded code")),l.title=e.phrase("unfold"),l.className="cm-foldPlaceholder",l.onclick=r,l}}}),co={openText:"\u2304",closedText:"\u203A",markerDOM:null,domEventHandlers:{}};class Yn extends T.SJ{constructor(e,i){super(),this.config=e,this.open=i}eq(e){return this.config==e.config&&this.open==e.open}toDOM(e){if(this.config.markerDOM)return this.config.markerDOM(this.open);let i=document.createElement("span");return i.textContent=this.open?this.config.openText:this.config.closedText,i.title=e.state.phrase(this.open?"Fold line":"Unfold line"),i}}function Zn(s={}){let e=Object.assign(Object.assign({},co),s),i=new Yn(e,!0),r=new Yn(e,!1),l=T.lg.fromClass(class{constructor(d){this.from=d.viewport.from,this.markers=this.buildMarkers(d)}update(d){(d.docChanged||d.viewportChanged||d.startState.facet(Ct)!=d.state.facet(Ct)||d.startState.field(ai,!1)!=d.state.field(ai,!1)||Le(d.startState)!=Le(d.state))&&(this.markers=this.buildMarkers(d.view))}buildMarkers(d){let y=new B.f_;for(let k of d.viewportLineBlocks){let M=xn(d.state,k.from,k.to)?r:wn(d.state,k.from,k.to)?i:null;M&&y.add(k.from,k.from,M)}return y.finish()}}),{domEventHandlers:c}=e;return[l,(0,T.v5)({class:"cm-foldGutter",markers(d){var y;return((y=d.plugin(l))===null||y===void 0?void 0:y.markers)||B.Xs.empty},initialSpacer(){return new Yn(e,!1)},domEventHandlers:Object.assign(Object.assign({},c),{click:(d,y,k)=>{if(c.click&&c.click(d,y,k))return!0;let M=xn(d.state,y.from,y.to);if(M)return d.dispatch({effects:nn.of(M)}),!0;let E=wn(d.state,y.from,y.to);return E?(d.dispatch({effects:tn.of(E)}),!0):!1}})}),Js()]}const fo=T.tk.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});class sn{constructor(e,i){let r;function l(y){let k=bi.V.newName();return(r||(r=Object.create(null)))["."+k]=y,k}const c=typeof i.all=="string"?i.all:i.all?l(i.all):void 0,d=i.scope;this.scope=d instanceof Ue?y=>y.prop(ye)==d.data:d?y=>y==d:void 0,this.style=Ei(e.map(y=>({tag:y.tag,class:y.class||l(Object.assign({},y,{tag:null}))})),{all:c}).style,this.module=r?new bi.V(r):null,this.themeType=i.themeType}static define(e,i){return new sn(e,i||{})}}const kn=B.r$.define(),Qs=B.r$.define({combine(s){return s.length?[s[0]]:null}});function vn(s){let e=s.facet(kn);return e.length?e:s.facet(Qs)}function uo(s,e){let i=[Ke],r;return s instanceof sn&&(s.module&&i.push(T.tk.styleModule.of(s.module)),r=s.themeType),e?.fallback?i.push(Qs.of(s)):r?i.push(kn.computeN([T.tk.darkTheme],l=>l.facet(T.tk.darkTheme)==(r=="dark")?[s]:[])):i.push(kn.of(s)),i}function Ml(s,e,i){let r=vn(s),l=null;if(r){for(let c of r)if(!c.scope||i&&c.scope(i)){let d=c.style(e);d&&(l=l?l+" "+d:d)}}return l}class Ys{constructor(e){this.markCache=Object.create(null),this.tree=Le(e.state),this.decorations=this.buildDeco(e,vn(e.state))}update(e){let i=Le(e.state),r=vn(e.state),l=r!=vn(e.startState);i.length<e.view.viewport.to&&!l&&i.type==this.tree.type?this.decorations=this.decorations.map(e.changes):(i!=this.tree||e.viewportChanged||l)&&(this.tree=i,this.decorations=this.buildDeco(e.view,r))}buildDeco(e,i){if(!i||!this.tree.length)return T.p.none;let r=new B.f_;for(let{from:l,to:c}of e.visibleRanges)bn(this.tree,i,(d,y,k)=>{r.add(d,y,this.markCache[k]||(this.markCache[k]=T.p.mark({class:k})))},l,c);return r.finish()}}const Ke=B.Wl.high(T.lg.fromClass(Ys,{decorations:s=>s.decorations})),Zs=sn.define([{tag:q.meta,color:"#7a757a"},{tag:q.link,textDecoration:"underline"},{tag:q.heading,textDecoration:"underline",fontWeight:"bold"},{tag:q.emphasis,fontStyle:"italic"},{tag:q.strong,fontWeight:"bold"},{tag:q.strikethrough,textDecoration:"line-through"},{tag:q.keyword,color:"#708"},{tag:[q.atom,q.bool,q.url,q.contentSeparator,q.labelName],color:"#219"},{tag:[q.literal,q.inserted],color:"#164"},{tag:[q.string,q.deleted],color:"#a11"},{tag:[q.regexp,q.escape,q.special(q.string)],color:"#e40"},{tag:q.definition(q.variableName),color:"#00f"},{tag:q.local(q.variableName),color:"#30a"},{tag:[q.typeName,q.namespace],color:"#085"},{tag:q.className,color:"#167"},{tag:[q.special(q.variableName),q.macroName],color:"#256"},{tag:q.definition(q.propertyName),color:"#00c"},{tag:q.comment,color:"#940"},{tag:q.invalid,color:"#f00"}]),po=T.tk.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),es=1e4,ts="()[]{}",is=B.r$.define({combine(s){return(0,B.BO)(s,{afterCursor:!0,brackets:ts,maxScanDistance:es,renderMatch:mo})}}),er=T.p.mark({class:"cm-matchingBracket"}),tr=T.p.mark({class:"cm-nonmatchingBracket"});function mo(s){let e=[],i=s.matched?er:tr;return e.push(i.range(s.start.from,s.start.to)),s.end&&e.push(i.range(s.end.from,s.end.to)),e}const yo=[B.QQ.define({create(){return T.p.none},update(s,e){if(!e.docChanged&&!e.selection)return s;let i=[],r=e.state.facet(is);for(let l of e.state.selection.ranges){if(!l.empty)continue;let c=Vt(e.state,l.head,-1,r)||l.head>0&&Vt(e.state,l.head-1,1,r)||r.afterCursor&&(Vt(e.state,l.head,1,r)||l.head<e.state.doc.length&&Vt(e.state,l.head+1,-1,r));c&&(i=i.concat(r.renderMatch(c,e.state)))}return T.p.set(i,!0)},provide:s=>T.tk.decorations.from(s)}),po];function ir(s={}){return[is.of(s),yo]}function Sn(s,e,i){let r=s.prop(e<0?te.openedBy:te.closedBy);if(r)return r;if(s.name.length==1){let l=i.indexOf(s.name);if(l>-1&&l%2==(e<0?1:0))return[i[l+e]]}return null}function Vt(s,e,i,r={}){let l=r.maxScanDistance||es,c=r.brackets||ts,d=Le(s),y=d.resolveInner(e,i);for(let k=y;k;k=k.parent){let M=Sn(k.type,i,c);if(M&&k.from<k.to)return ns(s,e,i,k,M,c)}return bo(s,e,i,d,y.type,l,c)}function ns(s,e,i,r,l,c){let d=r.parent,y={from:r.from,to:r.to},k=0,M=d?.cursor();if(M&&(i<0?M.childBefore(r.from):M.childAfter(r.to)))do if(i<0?M.to<=r.from:M.from>=r.to){if(k==0&&l.indexOf(M.type.name)>-1&&M.from<M.to)return{start:y,end:{from:M.from,to:M.to},matched:!0};if(Sn(M.type,i,c))k++;else if(Sn(M.type,-i,c)&&(k--,k==0))return{start:y,end:M.from==M.to?void 0:{from:M.from,to:M.to},matched:!1}}while(i<0?M.prevSibling():M.nextSibling());return{start:y,matched:!1}}function bo(s,e,i,r,l,c,d){let y=i<0?s.sliceDoc(e-1,e):s.sliceDoc(e,e+1),k=d.indexOf(y);if(k<0||k%2==0!=i>0)return null;let M={from:i<0?e-1:e,to:i>0?e+1:e},E=s.doc.iterRange(e,i>0?s.doc.length:0),I=0;for(let W=0;!E.next().done&&W<=c;){let K=E.value;i<0&&(W+=K.length);let Q=e+W*i;for(let Se=i>0?0:K.length-1,Je=i>0?K.length:-1;Se!=Je;Se+=i){let De=d.indexOf(K[Se]);if(!(De<0||r.resolve(Q+Se,1).type!=l))if(De%2==0==i>0)I++;else{if(I==1)return{start:M,end:{from:Q+Se,to:Q+Se+1},matched:De>>1==k>>1};I--}}i>0&&(W+=K.length)}return E.done?{start:M,matched:!1}:null}function ss(s,e,i,r=0,l=0){e==null&&(e=s.search(/[^\s\u00a0]/),e==-1&&(e=s.length));let c=l;for(let d=r;d<e;d++)s.charCodeAt(d)==9?c+=i-c%i:c++;return c}class nr{constructor(e,i,r){this.string=e,this.tabSize=i,this.indentUnit=r,this.pos=0,this.start=0,this.lastColumnPos=0,this.lastColumnValue=0}eol(){return this.pos>=this.string.length}sol(){return this.pos==0}peek(){return this.string.charAt(this.pos)||void 0}next(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)}eat(e){let i=this.string.charAt(this.pos),r;if(typeof e=="string"?r=i==e:r=i&&(e instanceof RegExp?e.test(i):e(i)),r)return++this.pos,i}eatWhile(e){let i=this.pos;for(;this.eat(e););return this.pos>i}eatSpace(){let e=this.pos;for(;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e}skipToEnd(){this.pos=this.string.length}skipTo(e){let i=this.string.indexOf(e,this.pos);if(i>-1)return this.pos=i,!0}backUp(e){this.pos-=e}column(){return this.lastColumnPos<this.start&&(this.lastColumnValue=ss(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue}indentation(){return ss(this.string,null,this.tabSize)}match(e,i,r){if(typeof e=="string"){let l=d=>r?d.toLowerCase():d,c=this.string.substr(this.pos,e.length);return l(c)==l(e)?(i!==!1&&(this.pos+=e.length),!0):null}else{let l=this.string.slice(this.pos).match(e);return l&&l.index>0?null:(l&&i!==!1&&(this.pos+=l[0].length),l)}}current(){return this.string.slice(this.start,this.pos)}}function wo(s){return{token:s.token,blankLine:s.blankLine||(()=>{}),startState:s.startState||(()=>!0),copyState:s.copyState||rs,indent:s.indent||(()=>null),languageData:s.languageData||{},tokenTable:s.tokenTable||we}}function rs(s){if(typeof s!="object")return s;let e={};for(let i in s){let r=s[i];e[i]=r instanceof Array?r.slice():r}return e}class os extends null{constructor(e){let i=Yi(e.languageData),r=wo(e),l,c=new class extends Parser{createParse(d,y,k){return new rr(l,d,y,k)}};super(i,c,[C.of((d,y)=>this.getIndent(d,y))]),this.topNode=hs(i),l=this,this.streamParser=r,this.stateAfter=new NodeProp({perNode:!0}),this.tokenTable=e.tokenTable?new _e(r.tokenTable):xo}static define(e){return new os(e)}getIndent(e,i){let r=Le(e.state),l=r.resolve(i);for(;l&&l.type!=this.topNode;)l=l.parent;if(!l)return null;let c=Cn(this,r,0,l.from,i),d,y;if(c?(y=c.state,d=c.pos+1):(y=this.streamParser.startState(e.unit),d=0),i-d>1e4)return null;for(;d<i;){let M=e.state.doc.lineAt(d),E=Math.min(i,M.to);if(M.length){let I=new nr(M.text,e.state.tabSize,e.unit);for(;I.pos<E-M.from;)Qt(this.streamParser.token,I,y)}else this.streamParser.blankLine(y,e.unit);if(E==i)break;d=M.to+1}let{text:k}=e.lineAt(i);return this.streamParser.indent(y,/^\s*(.*)/.exec(k)[1],e)}get allowsNesting(){return!1}}function Cn(s,e,i,r,l){let c=i>=r&&i+e.length<=l&&e.prop(s.stateAfter);if(c)return{state:s.streamParser.copyState(c),pos:i+e.length};for(let d=e.children.length-1;d>=0;d--){let y=e.children[d],k=i+e.positions[d],M=y instanceof Tree&&k<l&&Cn(s,y,k,r,l);if(M)return M}return null}function ls(s,e,i,r,l){if(l&&i<=0&&r>=e.length)return e;!l&&e.type==s.topNode&&(l=!0);for(let c=e.children.length-1;c>=0;c--){let d=e.positions[c],y=e.children[c],k;if(d<r&&y instanceof Tree){if(!(k=ls(s,y,i-d,r-d,l)))break;return l?new Tree(e.type,e.children.slice(0,c).concat(k),e.positions.slice(0,c+1),d+k.length):k}}return null}function sr(s,e,i,r){for(let l of e){let c=l.from+(l.openStart?25:0),d=l.to-(l.openEnd?25:0),y=c<=i&&d>i&&Cn(s,l.tree,0-l.offset,i,d),k;if(y&&(k=ls(s,l.tree,i+l.offset,y.pos+l.offset,!1)))return{state:y.state,tree:k}}return{state:s.streamParser.startState(r?p(r):4),tree:Tree.empty}}class rr{constructor(e,i,r,l){this.lang=e,this.input=i,this.fragments=r,this.ranges=l,this.stoppedAt=null,this.chunks=[],this.chunkPos=[],this.chunk=[],this.chunkReused=void 0,this.rangeIndex=0,this.to=l[l.length-1].to;let c=ft.get(),d=l[0].from,{state:y,tree:k}=sr(e,r,d,c?.state);this.state=y,this.parsedPos=this.chunkStart=d+k.length;for(let M=0;M<k.children.length;M++)this.chunks.push(k.children[M]),this.chunkPos.push(k.positions[M]);c&&this.parsedPos<c.viewport.from-1e5&&(this.state=this.lang.streamParser.startState(p(c.state)),c.skipUntilInView(this.parsedPos,c.viewport.from),this.parsedPos=c.viewport.from),this.moveRangeIndex()}advance(){let e=ft.get(),i=this.stoppedAt==null?this.to:Math.min(this.to,this.stoppedAt),r=Math.min(i,this.chunkStart+2048);for(e&&(r=Math.min(r,e.viewport.to));this.parsedPos<r;)this.parseLine(e);return this.chunkStart<this.parsedPos&&this.finishChunk(),this.parsedPos>=i?this.finish():e&&this.parsedPos>=e.viewport.to?(e.skipUntilInView(this.parsedPos,i),this.finish()):null}stopAt(e){this.stoppedAt=e}lineAfter(e){let i=this.input.chunk(e);if(this.input.lineChunks)i==`
`&&(i="");else{let r=i.indexOf(`
`);r>-1&&(i=i.slice(0,r))}return e+i.length<=this.to?i:i.slice(0,this.to-e)}nextLine(){let e=this.parsedPos,i=this.lineAfter(e),r=e+i.length;for(let l=this.rangeIndex;;){let c=this.ranges[l].to;if(c>=r||(i=i.slice(0,c-(r-i.length)),l++,l==this.ranges.length))break;let d=this.ranges[l].from,y=this.lineAfter(d);i+=y,r=d+y.length}return{line:i,end:r}}skipGapsTo(e,i,r){for(;;){let l=this.ranges[this.rangeIndex].to,c=e+i;if(r>0?l>c:l>=c)break;let d=this.ranges[++this.rangeIndex].from;i+=d-l}return i}moveRangeIndex(){for(;this.ranges[this.rangeIndex].to<this.parsedPos;)this.rangeIndex++}emitToken(e,i,r,l,c){if(this.ranges.length>1){c=this.skipGapsTo(i,c,1),i+=c;let d=this.chunk.length;c=this.skipGapsTo(r,c,-1),r+=c,l+=this.chunk.length-d}return this.chunk.push(e,i,r,l),c}parseLine(e){let{line:i,end:r}=this.nextLine(),l=0,{streamParser:c}=this.lang,d=new nr(i,e?e.state.tabSize:4,e?p(e.state):2);if(d.eol())c.blankLine(this.state,d.indentUnit);else for(;!d.eol();){let y=Qt(c.token,d,this.state);if(y&&(l=this.emitToken(this.lang.tokenTable.resolve(y),this.parsedPos+d.start,this.parsedPos+d.pos,4,l)),d.start>1e4)break}this.parsedPos=r,this.moveRangeIndex(),this.parsedPos<this.to&&this.parsedPos++}finishChunk(){let e=Tree.build({buffer:this.chunk,start:this.chunkStart,length:this.parsedPos-this.chunkStart,nodeSet:rt,topID:0,maxBufferLength:2048,reused:this.chunkReused});e=new Tree(e.type,e.children,e.positions,e.length,[[this.lang.stateAfter,this.lang.streamParser.copyState(this.state)]]),this.chunks.push(e),this.chunkPos.push(this.chunkStart-this.ranges[0].from),this.chunk=[],this.chunkReused=void 0,this.chunkStart=this.parsedPos}finish(){return new Tree(this.lang.topNode,this.chunks,this.chunkPos,this.parsedPos-this.ranges[0].from).balance()}}function Qt(s,e,i){e.start=e.pos;for(let r=0;r<10;r++){let l=s(e,i);if(e.pos>e.start)return l}throw new Error("Stream parser failed to advance stream.")}const we=Object.create(null),hi=[ie.none],rt=new Pe(hi),as=[],ut=Object.create(null);for(let[s,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","typeName"],["attribute","propertyName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])ut[s]=or(we,e);class _e{constructor(e){this.extra=e,this.table=Object.assign(Object.create(null),ut)}resolve(e){return e?this.table[e]||(this.table[e]=or(this.extra,e)):0}}const xo=new _e(we);function An(s,e){as.indexOf(s)>-1||(as.push(s),console.warn(e))}function or(s,e){let i=null;for(let c of e.split(".")){let d=s[c]||q[c];d?typeof d=="function"?i?i=d(i):An(c,`Modifier ${c} used at start of tag`):i?An(c,`Tag ${c} used as modifier`):i=d:An(c,`Unknown highlighting tag ${c}`)}if(!i)return 0;let r=e.replace(/ /g,"_"),l=ie.define({id:hi.length,name:r,props:[yt({[r]:i})]});return hi.push(l),l.id}function hs(s){let e=NodeType.define({id:hi.length,name:"Document",props:[ye.add(()=>s)]});return hi.push(e),e}const ko=s=>{let e=Vi(s.state);return e.line?vo(s):e.block?Ao(s):!1};function cs(s,e){return({state:i,dispatch:r})=>{if(i.readOnly)return!1;let l=s(e,i);return l?(r(i.update(l)),!0):!1}}const vo=cs(To,0),Tl=null,lr=null,So=cs(us,0),Co=null,fs=null,Ao=cs((s,e)=>us(s,e,Mo(e)),0);function Vi(s,e=s.selection.main.head){let i=s.languageDataAt("commentTokens",e);return i.length?i[0]:{}}const Fi=50;function ar(s,{open:e,close:i},r,l){let c=s.sliceDoc(r-Fi,r),d=s.sliceDoc(l,l+Fi),y=/\s*$/.exec(c)[0].length,k=/^\s*/.exec(d)[0].length,M=c.length-y;if(c.slice(M-e.length,M)==e&&d.slice(k,k+i.length)==i)return{open:{pos:r-y,margin:y&&1},close:{pos:l+k,margin:k&&1}};let E,I;l-r<=2*Fi?E=I=s.sliceDoc(r,l):(E=s.sliceDoc(r,r+Fi),I=s.sliceDoc(l-Fi,l));let W=/^\s*/.exec(E)[0].length,K=/\s*$/.exec(I)[0].length,Q=I.length-K-i.length;return E.slice(W,W+e.length)==e&&I.slice(Q,Q+i.length)==i?{open:{pos:r+W+e.length,margin:/\s/.test(E.charAt(W+e.length))?1:0},close:{pos:l-K-i.length,margin:/\s/.test(I.charAt(Q-1))?1:0}}:null}function Mo(s){let e=[];for(let i of s.selection.ranges){let r=s.doc.lineAt(i.from),l=i.to<=r.to?r:s.doc.lineAt(i.to),c=e.length-1;c>=0&&e[c].to>r.from?e[c].to=l.to:e.push({from:r.from,to:l.to})}return e}function us(s,e,i=e.selection.ranges){let r=i.map(c=>Vi(e,c.from).block);if(!r.every(c=>c))return null;let l=i.map((c,d)=>ar(e,r[d],c.from,c.to));if(s!=2&&!l.every(c=>c))return{changes:e.changes(i.map((c,d)=>l[d]?[]:[{from:c.from,insert:r[d].open+" "},{from:c.to,insert:" "+r[d].close}]))};if(s!=1&&l.some(c=>c)){let c=[];for(let d=0,y;d<l.length;d++)if(y=l[d]){let k=r[d],{open:M,close:E}=y;c.push({from:M.pos-k.open.length,to:M.pos+M.margin},{from:E.pos-E.margin,to:E.pos+k.close.length})}return{changes:c}}return null}function To(s,e,i=e.selection.ranges){let r=[],l=-1;for(let{from:c,to:d}of i){let y=r.length,k=1e9;for(let M=c;M<=d;){let E=e.doc.lineAt(M);if(E.from>l&&(c==d||d>E.from)){l=E.from;let I=Vi(e,M).line;if(!I)continue;let W=/^\s*/.exec(E.text)[0].length,K=W==E.length,Q=E.text.slice(W,W+I.length)==I?W:-1;W<E.text.length&&W<k&&(k=W),r.push({line:E,comment:Q,token:I,indent:W,empty:K,single:!1})}M=E.to+1}if(k<1e9)for(let M=y;M<r.length;M++)r[M].indent<r[M].line.text.length&&(r[M].indent=k);r.length==y+1&&(r[y].single=!0)}if(s!=2&&r.some(c=>c.comment<0&&(!c.empty||c.single))){let c=[];for(let{line:y,token:k,indent:M,empty:E,single:I}of r)(I||!E)&&c.push({from:y.from+M,insert:k+" "});let d=e.changes(c);return{changes:d,selection:e.selection.map(d,1)}}else if(s!=1&&r.some(c=>c.comment>=0)){let c=[];for(let{line:d,comment:y,token:k}of r)if(y>=0){let M=d.from+y,E=M+k.length;d.text[E-d.from]==" "&&E++,c.push({from:M,to:E})}return{changes:c}}return null}const vi=B.q6.define(),Mn=B.q6.define(),ds=B.r$.define(),Tn=B.r$.define({combine(s){return(0,B.BO)(s,{minDepth:100,newGroupDelay:500},{minDepth:Math.max,newGroupDelay:Math.min})}});function hr(s){let e=0;return s.iterChangedRanges((i,r)=>e=r),e}const Dn=B.QQ.define({create(){return Ft.empty},update(s,e){let i=e.state.facet(Tn),r=e.annotation(vi);if(r){let k=e.docChanged?B.jT.single(hr(e.changes)):void 0,M=dt.fromTransaction(e,k),E=r.side,I=E==0?s.undone:s.done;return M?I=Bn(I,I.length,i.minDepth,M):I=mr(I,e.startState.selection),new Ft(E==0?r.rest:I,E==0?I:r.rest)}let l=e.annotation(Mn);if((l=="full"||l=="before")&&(s=s.isolate()),e.annotation(B.YW.addToHistory)===!1)return e.changes.empty?s:s.addMapping(e.changes.desc);let c=dt.fromTransaction(e),d=e.annotation(B.YW.time),y=e.annotation(B.YW.userEvent);return c?s=s.addChanges(c,d,y,i.newGroupDelay,i.minDepth):e.selection&&(s=s.addSelection(e.startState.selection,d,y,i.newGroupDelay)),(l=="full"||l=="after")&&(s=s.isolate()),s},toJSON(s){return{done:s.done.map(e=>e.toJSON()),undone:s.undone.map(e=>e.toJSON())}},fromJSON(s){return new Ft(s.done.map(dt.fromJSON),s.undone.map(dt.fromJSON))}});function cr(s={}){return[Dn,Tn.of(s),T.tk.domEventHandlers({beforeinput(e,i){let r=e.inputType=="historyUndo"?ur:e.inputType=="historyRedo"?Pn:null;return r?(e.preventDefault(),r(i)):!1}})]}const fr=null;function On(s,e){return function({state:i,dispatch:r}){if(!e&&i.readOnly)return!1;let l=i.field(Dn,!1);if(!l)return!1;let c=l.pop(s,i,e);return c?(r(c),!0):!1}}const ur=On(0,!1),Pn=On(1,!1),Do=On(0,!0),dr=On(1,!0);function Dl(s){return function(e){let i=e.field(Dn,!1);if(!i)return 0;let r=s==0?i.done:i.undone;return r.length-(r.length&&!r[0].changes?1:0)}}const Ol=null,Pl=null;class dt{constructor(e,i,r,l,c){this.changes=e,this.effects=i,this.mapped=r,this.startSelection=l,this.selectionsAfter=c}setSelAfter(e){return new dt(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,i,r;return{changes:(e=this.changes)===null||e===void 0?void 0:e.toJSON(),mapped:(i=this.mapped)===null||i===void 0?void 0:i.toJSON(),startSelection:(r=this.startSelection)===null||r===void 0?void 0:r.toJSON(),selectionsAfter:this.selectionsAfter.map(l=>l.toJSON())}}static fromJSON(e){return new dt(e.changes&&B.as.fromJSON(e.changes),[],e.mapped&&B.n0.fromJSON(e.mapped),e.startSelection&&B.jT.fromJSON(e.startSelection),e.selectionsAfter.map(B.jT.fromJSON))}static fromTransaction(e,i){let r=ot;for(let l of e.startState.facet(ds)){let c=l(e);c.length&&(r=r.concat(c))}return!r.length&&e.changes.empty?null:new dt(e.changes.invert(e.startState.doc),r,void 0,i||e.startState.selection,ot)}static selection(e){return new dt(void 0,ot,void 0,void 0,e)}}function Bn(s,e,i,r){let l=e+1>i+20?e-i-1:0,c=s.slice(l,e);return c.push(r),c}function xe(s,e){let i=[],r=!1;return s.iterChangedRanges((l,c)=>i.push(l,c)),e.iterChangedRanges((l,c,d,y)=>{for(let k=0;k<i.length;){let M=i[k++],E=i[k++];y>=M&&d<=E&&(r=!0)}}),r}function Oo(s,e){return s.ranges.length==e.ranges.length&&s.ranges.filter((i,r)=>i.empty!=e.ranges[r].empty).length===0}function ps(s,e){return s.length?e.length?s.concat(e):s:e}const ot=[],pr=200;function mr(s,e){if(s.length){let i=s[s.length-1],r=i.selectionsAfter.slice(Math.max(0,i.selectionsAfter.length-pr));return r.length&&r[r.length-1].eq(e)?s:(r.push(e),Bn(s,s.length-1,1e9,i.setSelAfter(r)))}else return[dt.selection([e])]}function Po(s){let e=s[s.length-1],i=s.slice();return i[s.length-1]=e.setSelAfter(e.selectionsAfter.slice(0,e.selectionsAfter.length-1)),i}function rn(s,e){if(!s.length)return s;let i=s.length,r=ot;for(;i;){let l=Bo(s[i-1],e,r);if(l.changes&&!l.changes.empty||l.effects.length){let c=s.slice(0,i);return c[i-1]=l,c}else e=l.mapped,i--,r=l.selectionsAfter}return r.length?[dt.selection(r)]:ot}function Bo(s,e,i){let r=ps(s.selectionsAfter.length?s.selectionsAfter.map(y=>y.map(e)):ot,i);if(!s.changes)return dt.selection(r);let l=s.changes.map(e),c=e.mapDesc(s.changes,!0),d=s.mapped?s.mapped.composeDesc(c):c;return new dt(l,B.Py.mapEffects(s.effects,e),d,s.startSelection.map(c),r)}const gr=/^(input\.type|delete)($|\.)/;class Ft{constructor(e,i,r=0,l=void 0){this.done=e,this.undone=i,this.prevTime=r,this.prevUserEvent=l}isolate(){return this.prevTime?new Ft(this.done,this.undone):this}addChanges(e,i,r,l,c){let d=this.done,y=d[d.length-1];return y&&y.changes&&!y.changes.empty&&e.changes&&(!r||gr.test(r))&&(!y.selectionsAfter.length&&i-this.prevTime<l&&xe(y.changes,e.changes)||r=="input.type.compose")?d=Bn(d,d.length-1,c,new dt(e.changes.compose(y.changes),ps(e.effects,y.effects),y.mapped,y.startSelection,ot)):d=Bn(d,d.length,c,e),new Ft(d,ot,i,r)}addSelection(e,i,r,l){let c=this.done.length?this.done[this.done.length-1].selectionsAfter:ot;return c.length>0&&i-this.prevTime<l&&r==this.prevUserEvent&&r&&/^select($|\.)/.test(r)&&Oo(c[c.length-1],e)?this:new Ft(mr(this.done,e),this.undone,i,r)}addMapping(e){return new Ft(rn(this.done,e),rn(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,i,r){let l=e==0?this.done:this.undone;if(l.length==0)return null;let c=l[l.length-1];if(r&&c.selectionsAfter.length)return i.update({selection:c.selectionsAfter[c.selectionsAfter.length-1],annotations:vi.of({side:e,rest:Po(l)}),userEvent:e==0?"select.undo":"select.redo",scrollIntoView:!0});if(c.changes){let d=l.length==1?ot:l.slice(0,l.length-1);return c.mapped&&(d=rn(d,c.mapped)),i.update({changes:c.changes,selection:c.startSelection,effects:c.effects,annotations:vi.of({side:e,rest:d}),filter:!1,userEvent:e==0?"undo":"redo",scrollIntoView:!0})}else return null}}Ft.empty=new Ft(ot,ot);const yr=[{key:"Mod-z",run:ur,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:Pn,preventDefault:!0},{key:"Mod-u",run:Do,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:dr,preventDefault:!0}];function Hi(s,e){return B.jT.create(s.ranges.map(e),s.mainIndex)}function et(s,e){return s.update({selection:e,scrollIntoView:!0,userEvent:"select"})}function $t({state:s,dispatch:e},i){let r=Hi(s.selection,i);return r.eq(s.selection)?!1:(e(et(s,r)),!0)}function on(s,e){return B.jT.cursor(e?s.to:s.from)}function ln(s,e){return $t(s,i=>i.empty?s.moveByChar(i,e):on(i,e))}function wt(s){return s.textDirectionAt(s.state.selection.main.head)==T.Nm.LTR}const Wi=s=>ln(s,!wt(s)),br=s=>ln(s,wt(s)),Lo=s=>ln(s,!0),Bl=s=>ln(s,!1);function an(s,e){return $t(s,i=>i.empty?s.moveByGroup(i,e):on(i,e))}const Eo=s=>an(s,!wt(s)),wr=s=>an(s,wt(s)),Ro=s=>an(s,!0),Io=s=>an(s,!1);function xr(s,e,i){let r=s.state.charCategorizer(e.from);return s.moveByChar(e,i,l=>{let c=CharCategory.Space,d=e.from,y=!1,k=!1,M=!1,E=I=>{if(y)return!1;d+=i?I.length:-I.length;let W=r(I),K;if(c==CharCategory.Space&&(c=W),c!=W)return!1;if(c==CharCategory.Word)if(I.toLowerCase()==I){if(!i&&k)return!1;M=!0}else if(M){if(i)return!1;y=!0}else{if(k&&i&&r(K=s.state.sliceDoc(d,d+1))==CharCategory.Word&&K.toLowerCase()==K)return!1;k=!0}return!0};return E(l),E})}function kr(s,e){return $t(s,i=>i.empty?xr(s,i,e):on(i,e))}const No=s=>kr(s,!0),Ln=s=>kr(s,!1);function Vo(s,e,i){if(e.type.prop(i))return!0;let r=e.to-e.from;return r&&(r>2||/[^\s,.;:]/.test(s.sliceDoc(e.from,e.to)))||e.firstChild}function En(s,e,i){let r=Le(s).resolveInner(e.head),l=i?te.closedBy:te.openedBy;for(let k=e.head;;){let M=i?r.childAfter(k):r.childBefore(k);if(!M)break;Vo(s,M,l)?r=M:k=i?M.to:M.from}let c=r.type.prop(l),d,y;return c&&(d=i?Vt(s,r.from,1):Vt(s,r.to,-1))&&d.matched?y=i?d.end.to:d.end.from:y=i?r.to:r.from,B.jT.cursor(y,i?-1:1)}const vr=s=>$t(s,e=>En(s.state,e,!wt(s))),Fo=s=>$t(s,e=>En(s.state,e,wt(s)));function Sr(s,e){return $t(s,i=>{if(!i.empty)return on(i,e);let r=s.moveVertically(i,e);return r.head!=i.head?r:s.moveToLineBoundary(i,e)})}const Rn=s=>Sr(s,!1),Cr=s=>Sr(s,!0);function Ar(s,e){let{state:i}=s,r=Hi(i.selection,y=>y.empty?s.moveVertically(y,e,Math.min(s.dom.clientHeight,innerHeight)):on(y,e));if(r.eq(i.selection))return!1;let l=s.coordsAtPos(i.selection.main.head),c=s.scrollDOM.getBoundingClientRect(),d;return l&&l.top>c.top&&l.bottom<c.bottom&&l.top-c.top<=s.scrollDOM.scrollHeight-s.scrollDOM.scrollTop-s.scrollDOM.clientHeight&&(d=T.tk.scrollIntoView(r.main.head,{y:"start",yMargin:l.top-c.top})),s.dispatch(et(i,r),{effects:d}),!0}const In=s=>Ar(s,!1),ms=s=>Ar(s,!0);function Si(s,e,i){let r=s.lineBlockAt(e.head),l=s.moveToLineBoundary(e,i);if(l.head==e.head&&l.head!=(i?r.to:r.from)&&(l=s.moveToLineBoundary(e,i,!1)),!i&&l.head==r.from&&r.length){let c=/^\s*/.exec(s.state.sliceDoc(r.from,Math.min(r.from+100,r.to)))[0].length;c&&e.head!=r.from+c&&(l=B.jT.cursor(r.from+c))}return l}const Mr=s=>$t(s,e=>Si(s,e,!0)),gs=s=>$t(s,e=>Si(s,e,!1)),Ho=s=>$t(s,e=>B.jT.cursor(s.lineBlockAt(e.head).from,1)),Wo=s=>$t(s,e=>B.jT.cursor(s.lineBlockAt(e.head).to,-1));function Tr(s,e,i){let r=!1,l=Hi(s.selection,c=>{let d=Vt(s,c.head,-1)||Vt(s,c.head,1)||c.head>0&&Vt(s,c.head-1,1)||c.head<s.doc.length&&Vt(s,c.head+1,-1);if(!d||!d.end)return c;r=!0;let y=d.start.from==c.head?d.end.to:d.end.from;return i?B.jT.range(c.anchor,y):B.jT.cursor(y)});return r?(e(et(s,l)),!0):!1}const zo=({state:s,dispatch:e})=>Tr(s,e,!1),Ll=({state:s,dispatch:e})=>Tr(s,e,!0);function Mt(s,e){let i=Hi(s.state.selection,r=>{let l=e(r);return B.jT.range(r.anchor,l.head,l.goalColumn)});return i.eq(s.state.selection)?!1:(s.dispatch(et(s.state,i)),!0)}function ys(s,e){return Mt(s,i=>s.moveByChar(i,e))}const Dr=s=>ys(s,!wt(s)),Or=s=>ys(s,wt(s)),El=s=>ys(s,!0),Rl=s=>ys(s,!1);function bs(s,e){return Mt(s,i=>s.moveByGroup(i,e))}const ws=s=>bs(s,!wt(s)),jo=s=>bs(s,wt(s)),Il=s=>bs(s,!0),$o=s=>bs(s,!1);function Pr(s,e){return Mt(s,i=>xr(s,i,e))}const Nl=s=>Pr(s,!0),Vl=s=>Pr(s,!1),qo=s=>Mt(s,e=>En(s.state,e,!wt(s))),Uo=s=>Mt(s,e=>En(s.state,e,wt(s)));function Nn(s,e){return Mt(s,i=>s.moveVertically(i,e))}const xs=s=>Nn(s,!1),Go=s=>Nn(s,!0);function Br(s,e){return Mt(s,i=>s.moveVertically(i,e,Math.min(s.dom.clientHeight,innerHeight)))}const hn=s=>Br(s,!1),Vn=s=>Br(s,!0),Lr=s=>Mt(s,e=>Si(s,e,!0)),Er=s=>Mt(s,e=>Si(s,e,!1)),ks=s=>Mt(s,e=>B.jT.cursor(s.lineBlockAt(e.head).from)),cn=s=>Mt(s,e=>B.jT.cursor(s.lineBlockAt(e.head).to)),Fn=({state:s,dispatch:e})=>(e(et(s,{anchor:0})),!0),Rr=({state:s,dispatch:e})=>(e(et(s,{anchor:s.doc.length})),!0),Ir=({state:s,dispatch:e})=>(e(et(s,{anchor:s.selection.main.anchor,head:0})),!0),Nr=({state:s,dispatch:e})=>(e(et(s,{anchor:s.selection.main.anchor,head:s.doc.length})),!0),Ko=({state:s,dispatch:e})=>(e(s.update({selection:{anchor:0,head:s.doc.length},userEvent:"select"})),!0),_o=({state:s,dispatch:e})=>{let i=fi(s).map(({from:r,to:l})=>B.jT.range(r,Math.min(l+1,s.doc.length)));return e(s.update({selection:B.jT.create(i),userEvent:"select"})),!0},Jo=({state:s,dispatch:e})=>{let i=Hi(s.selection,r=>{var l;let c=Le(s).resolveInner(r.head,1);for(;!(c.from<r.from&&c.to>=r.to||c.to>r.to&&c.from<=r.from||!(!((l=c.parent)===null||l===void 0)&&l.parent));)c=c.parent;return B.jT.range(c.to,c.from)});return e(et(s,i)),!0},Fl=({state:s,dispatch:e})=>{let i=s.selection,r=null;return i.ranges.length>1?r=B.jT.create([i.main]):i.main.empty||(r=B.jT.create([B.jT.cursor(i.main.head)])),r?(e(et(s,r)),!0):!1};function Hn({state:s,dispatch:e},i){if(s.readOnly)return!1;let r="delete.selection",l=s.changeByRange(c=>{let{from:d,to:y}=c;if(d==y){let k=i(d);k<d?r="delete.backward":k>d&&(r="delete.forward"),d=Math.min(d,k),y=Math.max(y,k)}return d==y?{range:c}:{changes:{from:d,to:y},range:B.jT.cursor(d)}});return l.changes.empty?!1:(e(s.update(l,{scrollIntoView:!0,userEvent:r})),!0)}function vs(s,e,i){if(s instanceof T.tk)for(let r of s.state.facet(T.tk.atomicRanges).map(l=>l(s)))r.between(e,e,(l,c)=>{l<e&&c>e&&(e=i?c:l)});return e}const Xo=(s,e)=>Hn(s,i=>{let{state:r}=s,l=r.doc.lineAt(i),c,d;if(!e&&i>l.from&&i<l.from+200&&!/[^ \t]/.test(c=l.text.slice(0,i-l.from))){if(c[c.length-1]=="	")return i-1;let y=(0,B.IS)(c,r.tabSize),k=y%p(r)||p(r);for(let M=0;M<k&&c[c.length-1-M]==" ";M++)i--;d=i}else d=(0,B.cp)(l.text,i-l.from,e,e)+l.from,d==i&&l.number!=(e?r.doc.lines:1)&&(d+=e?1:-1);return vs(s,d,e)}),fn=s=>Xo(s,!1),Qo=s=>Xo(s,!0),Vr=(s,e)=>Hn(s,i=>{let r=i,{state:l}=s,c=l.doc.lineAt(r),d=l.charCategorizer(r);for(let y=null;;){if(r==(e?c.to:c.from)){r==i&&c.number!=(e?l.doc.lines:1)&&(r+=e?1:-1);break}let k=(0,B.cp)(c.text,r-c.from,e)+c.from,M=c.text.slice(Math.min(r,k)-c.from,Math.max(r,k)-c.from),E=d(M);if(y!=null&&E!=y)break;(M!=" "||r!=i)&&(y=E),r=k}return vs(s,r,e)}),Ss=s=>Vr(s,!1),Wn=s=>Vr(s,!0),Cs=s=>Hn(s,e=>{let i=s.lineBlockAt(e).to;return vs(s,e<i?i:Math.min(s.state.doc.length,e+1),!0)}),As=s=>Hn(s,e=>{let i=s.lineBlockAt(e).from;return vs(s,e>i?i:Math.max(0,e-1),!1)}),ci=({state:s,dispatch:e})=>{if(s.readOnly)return!1;let i=[];for(let r=0,l="",c=s.doc.iter();;){if(c.next(),c.lineBreak||c.done){let d=l.search(/\s+$/);if(d>-1&&i.push({from:r-(l.length-d),to:r}),c.done)break;l=""}else l=c.value;r+=c.value.length}return i.length?(e(s.update({changes:i,userEvent:"delete"})),!0):!1},zn=({state:s,dispatch:e})=>{if(s.readOnly)return!1;let i=s.changeByRange(r=>({changes:{from:r.from,to:r.to,insert:B.xv.of(["",""])},range:B.jT.cursor(r.from)}));return e(s.update(i,{scrollIntoView:!0,userEvent:"input"})),!0},Yo=({state:s,dispatch:e})=>{if(s.readOnly)return!1;let i=s.changeByRange(r=>{if(!r.empty||r.from==0||r.from==s.doc.length)return{range:r};let l=r.from,c=s.doc.lineAt(l),d=l==c.from?l-1:(0,B.cp)(c.text,l-c.from,!1)+c.from,y=l==c.to?l+1:(0,B.cp)(c.text,l-c.from,!0)+c.from;return{changes:{from:d,to:y,insert:s.doc.slice(l,y).append(s.doc.slice(d,l))},range:B.jT.cursor(y)}});return i.changes.empty?!1:(e(s.update(i,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function fi(s){let e=[],i=-1;for(let r of s.selection.ranges){let l=s.doc.lineAt(r.from),c=s.doc.lineAt(r.to);if(!r.empty&&r.to==c.from&&(c=s.doc.lineAt(r.to-1)),i>=l.number){let d=e[e.length-1];d.to=c.to,d.ranges.push(r)}else e.push({from:l.from,to:c.to,ranges:[r]});i=c.number+1}return e}function Fr(s,e,i){if(s.readOnly)return!1;let r=[],l=[];for(let c of fi(s)){if(i?c.to==s.doc.length:c.from==0)continue;let d=s.doc.lineAt(i?c.to+1:c.from-1),y=d.length+1;if(i){r.push({from:c.to,to:d.to},{from:c.from,insert:d.text+s.lineBreak});for(let k of c.ranges)l.push(B.jT.range(Math.min(s.doc.length,k.anchor+y),Math.min(s.doc.length,k.head+y)))}else{r.push({from:d.from,to:c.from},{from:c.to,insert:s.lineBreak+d.text});for(let k of c.ranges)l.push(B.jT.range(k.anchor-y,k.head-y))}}return r.length?(e(s.update({changes:r,scrollIntoView:!0,selection:B.jT.create(l,s.selection.mainIndex),userEvent:"move.line"})),!0):!1}const Ms=({state:s,dispatch:e})=>Fr(s,e,!1),Hr=({state:s,dispatch:e})=>Fr(s,e,!0);function Wr(s,e,i){if(s.readOnly)return!1;let r=[];for(let l of fi(s))i?r.push({from:l.from,insert:s.doc.slice(l.from,l.to)+s.lineBreak}):r.push({from:l.to,insert:s.lineBreak+s.doc.slice(l.from,l.to)});return e(s.update({changes:r,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const zr=({state:s,dispatch:e})=>Wr(s,e,!1),jr=({state:s,dispatch:e})=>Wr(s,e,!0),Zo=s=>{if(s.state.readOnly)return!1;let{state:e}=s,i=e.changes(fi(e).map(({from:l,to:c})=>(l>0?l--:c<e.doc.length&&c++,{from:l,to:c}))),r=Hi(e.selection,l=>s.moveVertically(l,!0)).map(i);return s.dispatch({changes:i,selection:r,scrollIntoView:!0,userEvent:"delete.line"}),!0},el=({state:s,dispatch:e})=>(e(s.update(s.replaceSelection(s.lineBreak),{scrollIntoView:!0,userEvent:"input"})),!0);function $r(s,e){if(/\(\)|\[\]|\{\}/.test(s.sliceDoc(e-1,e+1)))return{from:e,to:e};let i=Le(s).resolveInner(e),r=i.childBefore(e),l=i.childAfter(e),c;return r&&l&&r.to<=e&&l.from>=e&&(c=r.type.prop(te.closedBy))&&c.indexOf(l.name)>-1&&s.doc.lineAt(r.to).from==s.doc.lineAt(l.from).from?{from:r.to,to:l.from}:null}const tl=Ci(!1),il=Ci(!0);function Ci(s){return({state:e,dispatch:i})=>{if(e.readOnly)return!1;let r=e.changeByRange(l=>{let{from:c,to:d}=l,y=e.doc.lineAt(c),k=!s&&c==d&&$r(e,c);s&&(c=d=(d<=y.to?y:e.doc.lineAt(d)).to);let M=new v(e,{simulateBreak:c,simulateDoubleBreak:!!k}),E=w(M,c);for(E==null&&(E=/^\s*/.exec(e.doc.lineAt(c).text)[0].length);d<y.to&&/\s/.test(y.text[d-y.from]);)d++;k?{from:c,to:d}=k:c>y.from&&c<y.from+100&&!/\S/.test(y.text.slice(0,c))&&(c=y.from);let I=["",g(e,E)];return k&&I.push(g(e,M.lineIndent(y.from,-1))),{changes:{from:c,to:d,insert:B.xv.of(I)},range:B.jT.cursor(c+1+I[1].length)}});return i(e.update(r,{scrollIntoView:!0,userEvent:"input"})),!0}}function un(s,e){let i=-1;return s.changeByRange(r=>{let l=[];for(let d=r.from;d<=r.to;){let y=s.doc.lineAt(d);y.number>i&&(r.empty||r.to>y.from)&&(e(y,l,r),i=y.number),d=y.to+1}let c=s.changes(l);return{changes:l,range:B.jT.range(c.mapPos(r.anchor,1),c.mapPos(r.head,1))}})}const Ts=({state:s,dispatch:e})=>{if(s.readOnly)return!1;let i=Object.create(null),r=new v(s,{overrideIndentation:c=>{let d=i[c];return d??-1}}),l=un(s,(c,d,y)=>{let k=w(r,c.from);if(k==null)return;/\S/.test(c.text)||(k=0);let M=/^\s*/.exec(c.text)[0],E=g(s,k);(M!=E||y.from<c.from+M.length)&&(i[c.from]=k,d.push({from:c.from,to:c.from+M.length,insert:E}))});return l.changes.empty||e(s.update(l,{userEvent:"indent"})),!0},Ds=({state:s,dispatch:e})=>s.readOnly?!1:(e(s.update(un(s,(i,r)=>{r.push({from:i.from,insert:s.facet(f)})}),{userEvent:"input.indent"})),!0),qr=({state:s,dispatch:e})=>s.readOnly?!1:(e(s.update(un(s,(i,r)=>{let l=/^\s*/.exec(i.text)[0];if(!l)return;let c=(0,B.IS)(l,s.tabSize),d=0,y=g(s,Math.max(0,c-p(s)));for(;d<l.length&&d<y.length&&l.charCodeAt(d)==y.charCodeAt(d);)d++;r.push({from:i.from+d,to:i.from+l.length,insert:y.slice(d)})}),{userEvent:"delete.dedent"})),!0),nl=({state:s,dispatch:e})=>s.selection.ranges.some(i=>!i.empty)?Ds({state:s,dispatch:e}):(e(s.update(s.replaceSelection("	"),{scrollIntoView:!0,userEvent:"input"})),!0),sl=[{key:"Ctrl-b",run:Wi,shift:Dr,preventDefault:!0},{key:"Ctrl-f",run:br,shift:Or},{key:"Ctrl-p",run:Rn,shift:xs},{key:"Ctrl-n",run:Cr,shift:Go},{key:"Ctrl-a",run:Ho,shift:ks},{key:"Ctrl-e",run:Wo,shift:cn},{key:"Ctrl-d",run:Qo},{key:"Ctrl-h",run:fn},{key:"Ctrl-k",run:Cs},{key:"Ctrl-Alt-h",run:Ss},{key:"Ctrl-o",run:zn},{key:"Ctrl-t",run:Yo},{key:"Ctrl-v",run:ms}],rl=[{key:"ArrowLeft",run:Wi,shift:Dr,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:Eo,shift:ws},{mac:"Cmd-ArrowLeft",run:gs,shift:Er},{key:"ArrowRight",run:br,shift:Or,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:wr,shift:jo},{mac:"Cmd-ArrowRight",run:Mr,shift:Lr},{key:"ArrowUp",run:Rn,shift:xs,preventDefault:!0},{mac:"Cmd-ArrowUp",run:Fn,shift:Ir},{mac:"Ctrl-ArrowUp",run:In,shift:hn},{key:"ArrowDown",run:Cr,shift:Go,preventDefault:!0},{mac:"Cmd-ArrowDown",run:Rr,shift:Nr},{mac:"Ctrl-ArrowDown",run:ms,shift:Vn},{key:"PageUp",run:In,shift:hn},{key:"PageDown",run:ms,shift:Vn},{key:"Home",run:gs,shift:Er,preventDefault:!0},{key:"Mod-Home",run:Fn,shift:Ir},{key:"End",run:Mr,shift:Lr,preventDefault:!0},{key:"Mod-End",run:Rr,shift:Nr},{key:"Enter",run:tl},{key:"Mod-a",run:Ko},{key:"Backspace",run:fn,shift:fn},{key:"Delete",run:Qo},{key:"Mod-Backspace",mac:"Alt-Backspace",run:Ss},{key:"Mod-Delete",mac:"Alt-Delete",run:Wn},{mac:"Mod-Backspace",run:As},{mac:"Mod-Delete",run:Cs}].concat(sl.map(s=>({mac:s.key,run:s.run,shift:s.shift}))),ol=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:vr,shift:qo},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:Fo,shift:Uo},{key:"Alt-ArrowUp",run:Ms},{key:"Shift-Alt-ArrowUp",run:zr},{key:"Alt-ArrowDown",run:Hr},{key:"Shift-Alt-ArrowDown",run:jr},{key:"Escape",run:Fl},{key:"Mod-Enter",run:il},{key:"Alt-l",mac:"Ctrl-l",run:_o},{key:"Mod-i",run:Jo,preventDefault:!0},{key:"Mod-[",run:qr},{key:"Mod-]",run:Ds},{key:"Mod-Alt-\\",run:Ts},{key:"Shift-Mod-k",run:Zo},{key:"Shift-Mod-\\",run:zo},{key:"Mod-/",run:ko},{key:"Alt-A",run:So}].concat(rl),Ta={key:"Tab",run:Ds,shift:qr};function a(){var s=arguments[0];typeof s=="string"&&(s=document.createElement(s));var e=1,i=arguments[1];if(i&&typeof i=="object"&&i.nodeType==null&&!Array.isArray(i)){for(var r in i)if(Object.prototype.hasOwnProperty.call(i,r)){var l=i[r];typeof l=="string"?s.setAttribute(r,l):l!=null&&(s[r]=l)}e++}for(;e<arguments.length;e++)t(s,arguments[e]);return s}function t(s,e){if(typeof e=="string")s.appendChild(document.createTextNode(e));else if(e!=null)if(e.nodeType!=null)s.appendChild(e);else if(Array.isArray(e))for(var i=0;i<e.length;i++)t(s,e[i]);else throw new RangeError("Unsupported child node: "+e)}const n=typeof String.prototype.normalize=="function"?s=>s.normalize("NFKD"):s=>s;class o{constructor(e,i,r=0,l=e.length,c){this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(r,l),this.bufferStart=r,this.normalize=c?d=>c(n(d)):n,this.query=this.normalize(i)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return(0,B.gm)(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let i=(0,B.bg)(e),r=this.bufferStart+this.bufferPos;this.bufferPos+=(0,B.nZ)(e);let l=this.normalize(i);for(let c=0,d=r;;c++){let y=l.charCodeAt(c),k=this.match(y,d);if(k)return this.value=k,this;if(c==l.length-1)break;d==r&&c<i.length&&i.charCodeAt(c)==y&&d++}}}match(e,i){let r=null;for(let l=0;l<this.matches.length;l+=2){let c=this.matches[l],d=!1;this.query.charCodeAt(c)==e&&(c==this.query.length-1?r={from:this.matches[l+1],to:i+1}:(this.matches[l]++,d=!0)),d||(this.matches.splice(l,2),l-=2)}return this.query.charCodeAt(0)==e&&(this.query.length==1?r={from:i,to:i+1}:this.matches.push(1,i)),r}}typeof Symbol<"u"&&(o.prototype[Symbol.iterator]=function(){return this});const h={from:-1,to:-1,match:/.*/.exec("")},u="gm"+(/x/.unicode==null?"":"u");class m{constructor(e,i,r,l=0,c=e.length){if(this.to=c,this.curLine="",this.done=!1,this.value=h,/\\[sWDnr]|\n|\r|\[\^/.test(i))return new A(e,i,r,l,c);this.re=new RegExp(i,u+(r?.ignoreCase?"i":"")),this.iter=e.iter();let d=e.lineAt(l);this.curLineStart=d.from,this.matchPos=l,this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let i=this.matchPos<=this.to&&this.re.exec(this.curLine);if(i){let r=this.curLineStart+i.index,l=r+i[0].length;if(this.matchPos=l+(r==l?1:0),r==this.curLine.length&&this.nextLine(),r<l||r>this.value.to)return this.value={from:r,to:l,match:i},this;e=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),e=0;else return this.done=!0,this}}}const b=new WeakMap;class x{constructor(e,i){this.from=e,this.text=i}get to(){return this.from+this.text.length}static get(e,i,r){let l=b.get(e);if(!l||l.from>=r||l.to<=i){let y=new x(i,e.sliceString(i,r));return b.set(e,y),y}if(l.from==i&&l.to==r)return l;let{text:c,from:d}=l;return d>i&&(c=e.sliceString(i,d)+c,d=i),l.to<r&&(c+=e.sliceString(l.to,r)),b.set(e,new x(d,c)),new x(i,c.slice(i-d,r-d))}}class A{constructor(e,i,r,l,c){this.text=e,this.to=c,this.done=!1,this.value=h,this.matchPos=l,this.re=new RegExp(i,u+(r?.ignoreCase?"i":"")),this.flat=x.get(e,l,this.chunkEnd(l+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,i=this.re.exec(this.flat.text);if(i&&!i[0]&&i.index==e&&(this.re.lastIndex=e+1,i=this.re.exec(this.flat.text)),i&&this.flat.to<this.to&&i.index+i[0].length>this.flat.text.length-10&&(i=null),i){let r=this.flat.from+i.index,l=r+i[0].length;return this.value={from:r,to:l,match:i},this.matchPos=l+(r==l?1:0),this}else{if(this.flat.to==this.to)return this.done=!0,this;this.flat=x.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}}}typeof Symbol<"u"&&(m.prototype[Symbol.iterator]=A.prototype[Symbol.iterator]=function(){return this});function D(s){try{return new RegExp(s,u),!0}catch{return!1}}function P(s){let e=a("input",{class:"cm-textfield",name:"line"}),i=a("form",{class:"cm-gotoLine",onkeydown:l=>{l.keyCode==27?(l.preventDefault(),s.dispatch({effects:V.of(!1)}),s.focus()):l.keyCode==13&&(l.preventDefault(),r())},onsubmit:l=>{l.preventDefault(),r()}},a("label",s.state.phrase("Go to line"),": ",e)," ",a("button",{class:"cm-button",type:"submit"},s.state.phrase("go")));function r(){let l=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(e.value);if(!l)return;let{state:c}=s,d=c.doc.lineAt(c.selection.main.head),[,y,k,M,E]=l,I=M?+M.slice(1):0,W=k?+k:d.number;if(k&&E){let Q=W/100;y&&(Q=Q*(y=="-"?-1:1)+d.number/c.doc.lines),W=Math.round(c.doc.lines*Q)}else k&&y&&(W=W*(y=="-"?-1:1)+d.number);let K=c.doc.line(Math.max(1,Math.min(c.doc.lines,W)));s.dispatch({effects:V.of(!1),selection:B.jT.cursor(K.from+Math.max(0,Math.min(I,K.length))),scrollIntoView:!0}),s.focus()}return{dom:i}}const V=B.Py.define(),N=B.QQ.define({create(){return!0},update(s,e){for(let i of e.effects)i.is(V)&&(s=i.value);return s},provide:s=>T.mH.from(s,e=>e?P:null)}),F=s=>{let e=(0,T.Sd)(s,P);if(!e){let i=[V.of(!0)];s.state.field(N,!1)==null&&i.push(B.Py.appendConfig.of([N,_])),s.dispatch({effects:i}),e=(0,T.Sd)(s,P)}return e&&e.dom.querySelector("input").focus(),!0},_=T.tk.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}}),J={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},X=B.r$.define({combine(s){return(0,B.BO)(s,J,{highlightWordAroundCursor:(e,i)=>e||i,minSelectionLength:Math.min,maxMatches:Math.min})}});function Me(s){let e=[jn,di];return s&&e.push(X.of(s)),e}const le=T.p.mark({class:"cm-selectionMatch"}),se=T.p.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function He(s,e,i,r){return(i==0||s(e.sliceDoc(i-1,i))!=B.D0.Word)&&(r==e.doc.length||s(e.sliceDoc(r,r+1))!=B.D0.Word)}function ui(s,e,i,r){return s(e.sliceDoc(i,i+1))==B.D0.Word&&s(e.sliceDoc(r-1,r))==B.D0.Word}const di=T.lg.fromClass(class{constructor(s){this.decorations=this.getDeco(s)}update(s){(s.selectionSet||s.docChanged||s.viewportChanged)&&(this.decorations=this.getDeco(s.view))}getDeco(s){let e=s.state.facet(X),{state:i}=s,r=i.selection;if(r.ranges.length>1)return T.p.none;let l=r.main,c,d=null;if(l.empty){if(!e.highlightWordAroundCursor)return T.p.none;let k=i.wordAt(l.head);if(!k)return T.p.none;d=i.charCategorizer(l.head),c=i.sliceDoc(k.from,k.to)}else{let k=l.to-l.from;if(k<e.minSelectionLength||k>200)return T.p.none;if(e.wholeWords){if(c=i.sliceDoc(l.from,l.to),d=i.charCategorizer(l.head),!(He(d,i,l.from,l.to)&&ui(d,i,l.from,l.to)))return T.p.none}else if(c=i.sliceDoc(l.from,l.to).trim(),!c)return T.p.none}let y=[];for(let k of s.visibleRanges){let M=new o(i.doc,c,k.from,k.to);for(;!M.next().done;){let{from:E,to:I}=M.value;if((!d||He(d,i,E,I))&&(l.empty&&E<=l.from&&I>=l.to?y.push(se.range(E,I)):(E>=l.to||I<=l.from)&&y.push(le.range(E,I)),y.length>e.maxMatches))return T.p.none}}return T.p.set(y)}},{decorations:s=>s.decorations}),jn=T.tk.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),Ur=({state:s,dispatch:e})=>{let{selection:i}=s,r=B.jT.create(i.ranges.map(l=>s.wordAt(l.head)||B.jT.cursor(l.head)),i.mainIndex);return r.eq(i)?!1:(e(s.update({selection:r})),!0)};function $n(s,e){let{main:i,ranges:r}=s.selection,l=s.wordAt(i.head),c=l&&l.from==i.from&&l.to==i.to;for(let d=!1,y=new o(s.doc,e,r[r.length-1].to);;)if(y.next(),y.done){if(d)return null;y=new o(s.doc,e,0,Math.max(0,r[r.length-1].from-1)),d=!0}else{if(d&&r.some(k=>k.from==y.value.from))continue;if(c){let k=s.wordAt(y.value.from);if(!k||k.from!=y.value.from||k.to!=y.value.to)continue}return y.value}}const qn=({state:s,dispatch:e})=>{let{ranges:i}=s.selection;if(i.some(c=>c.from===c.to))return Ur({state:s,dispatch:e});let r=s.sliceDoc(i[0].from,i[0].to);if(s.selection.ranges.some(c=>s.sliceDoc(c.from,c.to)!=r))return!1;let l=$n(s,r);return l?(e(s.update({selection:s.selection.addRange(B.jT.range(l.from,l.to),!1),effects:T.tk.scrollIntoView(l.to)})),!0):!1},qt=B.r$.define({combine(s){var e;return{top:s.reduce((i,r)=>i??r.top,void 0)||!1,caseSensitive:s.reduce((i,r)=>i??r.caseSensitive,void 0)||!1,createPanel:((e=s.find(i=>i.createPanel))===null||e===void 0?void 0:e.createPanel)||(i=>new Na(i))}}});function Ai(s){return s?[qt.of(s),fl]:fl}class Mi{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||D(this.search)),this.unquoted=e.literal?this.search:this.search.replace(/\\([nrt\\])/g,(i,r)=>r=="n"?`
`:r=="r"?"\r":r=="t"?"	":"\\")}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp}create(){return this.regexp?new Da(this):new mi(this)}getCursor(e,i=0,r=e.length){return this.regexp?xt(this,e,i,r):Ut(this,e,i,r)}}class pi{constructor(e){this.spec=e}}function Ut(s,e,i,r){return new o(e,s.unquoted,i,r,s.caseSensitive?void 0:l=>l.toLowerCase())}class mi extends pi{constructor(e){super(e)}nextMatch(e,i,r){let l=Ut(this.spec,e,r,e.length).nextOverlapping();return l.done&&(l=Ut(this.spec,e,0,i).nextOverlapping()),l.done?null:l.value}prevMatchInRange(e,i,r){for(let l=r;;){let c=Math.max(i,l-1e4-this.spec.unquoted.length),d=Ut(this.spec,e,c,l),y=null;for(;!d.nextOverlapping().done;)y=d.value;if(y)return y;if(c==i)return null;l-=1e4}}prevMatch(e,i,r){return this.prevMatchInRange(e,0,i)||this.prevMatchInRange(e,r,e.length)}getReplacement(e){return this.spec.replace}matchAll(e,i){let r=Ut(this.spec,e,0,e.length),l=[];for(;!r.next().done;){if(l.length>=i)return null;l.push(r.value)}return l}highlight(e,i,r,l){let c=Ut(this.spec,e,Math.max(0,i-this.spec.unquoted.length),Math.min(r+this.spec.unquoted.length,e.length));for(;!c.next().done;)l(c.value.from,c.value.to)}}function xt(s,e,i,r){return new m(e,s.search,s.caseSensitive?void 0:{ignoreCase:!0},i,r)}class Da extends pi{nextMatch(e,i,r){let l=xt(this.spec,e,r,e.length).next();return l.done&&(l=xt(this.spec,e,0,i).next()),l.done?null:l.value}prevMatchInRange(e,i,r){for(let l=1;;l++){let c=Math.max(i,r-l*1e4),d=xt(this.spec,e,c,r),y=null;for(;!d.next().done;)y=d.value;if(y&&(c==i||y.from>c+10))return y;if(c==i)return null}}prevMatch(e,i,r){return this.prevMatchInRange(e,0,i)||this.prevMatchInRange(e,r,e.length)}getReplacement(e){return this.spec.replace.replace(/\$([$&\d+])/g,(i,r)=>r=="$"?"$":r=="&"?e.match[0]:r!="0"&&+r<e.match.length?e.match[r]:i)}matchAll(e,i){let r=xt(this.spec,e,0,e.length),l=[];for(;!r.next().done;){if(l.length>=i)return null;l.push(r.value)}return l}highlight(e,i,r,l){let c=xt(this.spec,e,Math.max(0,i-250),Math.min(r+250,e.length));for(;!c.next().done;)l(c.value.from,c.value.to)}}const Os=B.Py.define(),ll=B.Py.define(),Ti=B.QQ.define({create(s){return new al(_r(s).create(),null)},update(s,e){for(let i of e.effects)i.is(Os)?s=new al(i.value.create(),s.panel):i.is(ll)&&(s=new al(s.query,i.value?hl:null));return s},provide:s=>T.mH.from(s,e=>e.panel)});function qh(s){let e=s.field(Ti,!1);return e?e.query.spec:_r(s)}class al{constructor(e,i){this.query=e,this.panel=i}}const Oa=T.p.mark({class:"cm-searchMatch"}),Pa=T.p.mark({class:"cm-searchMatch cm-searchMatch-selected"}),Ba=T.lg.fromClass(class{constructor(s){this.view=s,this.decorations=this.highlight(s.state.field(Ti))}update(s){let e=s.state.field(Ti);(e!=s.startState.field(Ti)||s.docChanged||s.selectionSet||s.viewportChanged)&&(this.decorations=this.highlight(e))}highlight({query:s,panel:e}){if(!e||!s.spec.valid)return T.p.none;let{view:i}=this,r=new B.f_;for(let l=0,c=i.visibleRanges,d=c.length;l<d;l++){let{from:y,to:k}=c[l];for(;l<d-1&&k>c[l+1].from-2*250;)k=c[++l].to;s.highlight(i.state.doc,y,k,(M,E)=>{let I=i.state.selection.ranges.some(W=>W.from==M&&W.to==E);r.add(M,E,I?Pa:Oa)})}return r.finish()}},{decorations:s=>s.decorations});function Ps(s){return e=>{let i=e.state.field(Ti,!1);return i&&i.query.spec.valid?s(e,i):Wl(e)}}const Gr=Ps((s,{query:e})=>{let{from:i,to:r}=s.state.selection.main,l=e.nextMatch(s.state.doc,i,r);return!l||l.from==i&&l.to==r?!1:(s.dispatch({selection:{anchor:l.from,head:l.to},scrollIntoView:!0,effects:cl(s,l),userEvent:"select.search"}),!0)}),Kr=Ps((s,{query:e})=>{let{state:i}=s,{from:r,to:l}=i.selection.main,c=e.prevMatch(i.doc,r,l);return c?(s.dispatch({selection:{anchor:c.from,head:c.to},scrollIntoView:!0,effects:cl(s,c),userEvent:"select.search"}),!0):!1}),La=Ps((s,{query:e})=>{let i=e.matchAll(s.state.doc,1e3);return!i||!i.length?!1:(s.dispatch({selection:B.jT.create(i.map(r=>B.jT.range(r.from,r.to))),userEvent:"select.search.matches"}),!0)}),Ea=({state:s,dispatch:e})=>{let i=s.selection;if(i.ranges.length>1||i.main.empty)return!1;let{from:r,to:l}=i.main,c=[],d=0;for(let y=new o(s.doc,s.sliceDoc(r,l));!y.next().done;){if(c.length>1e3)return!1;y.value.from==r&&(d=c.length),c.push(B.jT.range(y.value.from,y.value.to))}return e(s.update({selection:B.jT.create(c,d),userEvent:"select.search.matches"})),!0},Hl=Ps((s,{query:e})=>{let{state:i}=s,{from:r,to:l}=i.selection.main;if(i.readOnly)return!1;let c=e.nextMatch(i.doc,r,r);if(!c)return!1;let d=[],y,k;if(c.from==r&&c.to==l&&(k=i.toText(e.getReplacement(c)),d.push({from:c.from,to:c.to,insert:k}),c=e.nextMatch(i.doc,c.from,c.to)),c){let M=d.length==0||d[0].from>=c.to?0:c.to-c.from-k.length;y={anchor:c.from-M,head:c.to-M}}return s.dispatch({changes:d,selection:y,scrollIntoView:!!y,effects:c?cl(s,c):void 0,userEvent:"input.replace"}),!0}),Ra=Ps((s,{query:e})=>{if(s.state.readOnly)return!1;let i=e.matchAll(s.state.doc,1e9).map(r=>{let{from:l,to:c}=r;return{from:l,to:c,insert:e.getReplacement(r)}});return i.length?(s.dispatch({changes:i,userEvent:"input.replace.all"}),!0):!1});function hl(s){return s.state.facet(qt).createPanel(s)}function _r(s,e){var i;let r=s.selection.main,l=r.empty||r.to>r.from+100?"":s.sliceDoc(r.from,r.to),c=(i=e?.caseSensitive)!==null&&i!==void 0?i:s.facet(qt).caseSensitive;return e&&!l?e:new Mi({search:l.replace(/\n/g,"\\n"),caseSensitive:c})}const Wl=s=>{let e=s.state.field(Ti,!1);if(e&&e.panel){let i=(0,T.Sd)(s,hl);if(!i)return!1;let r=i.dom.querySelector("[name=search]");if(r!=s.root.activeElement){let l=_r(s.state,e.query.spec);l.valid&&s.dispatch({effects:Os.of(l)}),r.focus(),r.select()}}else s.dispatch({effects:[ll.of(!0),e?Os.of(_r(s.state,e.query.spec)):B.Py.appendConfig.of(fl)]});return!0},zl=s=>{let e=s.state.field(Ti,!1);if(!e||!e.panel)return!1;let i=(0,T.Sd)(s,hl);return i&&i.dom.contains(s.root.activeElement)&&s.focus(),s.dispatch({effects:ll.of(!1)}),!0},Ia=[{key:"Mod-f",run:Wl,scope:"editor search-panel"},{key:"F3",run:Gr,shift:Kr,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:Gr,shift:Kr,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:zl,scope:"editor search-panel"},{key:"Mod-Shift-l",run:Ea},{key:"Alt-g",run:F},{key:"Mod-d",run:qn,preventDefault:!0}];class Na{constructor(e){this.view=e;let i=this.query=e.state.field(Ti).query.spec;this.commit=this.commit.bind(this),this.searchField=a("input",{value:i.search,placeholder:Gt(e,"Find"),"aria-label":Gt(e,"Find"),class:"cm-textfield",name:"search",onchange:this.commit,onkeyup:this.commit}),this.replaceField=a("input",{value:i.replace,placeholder:Gt(e,"Replace"),"aria-label":Gt(e,"Replace"),class:"cm-textfield",name:"replace",onchange:this.commit,onkeyup:this.commit}),this.caseField=a("input",{type:"checkbox",name:"case",checked:i.caseSensitive,onchange:this.commit}),this.reField=a("input",{type:"checkbox",name:"re",checked:i.regexp,onchange:this.commit});function r(l,c,d){return a("button",{class:"cm-button",name:l,onclick:c,type:"button"},d)}this.dom=a("div",{onkeydown:l=>this.keydown(l),class:"cm-search"},[this.searchField,r("next",()=>Gr(e),[Gt(e,"next")]),r("prev",()=>Kr(e),[Gt(e,"previous")]),r("select",()=>La(e),[Gt(e,"all")]),a("label",null,[this.caseField,Gt(e,"match case")]),a("label",null,[this.reField,Gt(e,"regexp")]),...e.state.readOnly?[]:[a("br"),this.replaceField,r("replace",()=>Hl(e),[Gt(e,"replace")]),r("replaceAll",()=>Ra(e),[Gt(e,"replace all")]),a("button",{name:"close",onclick:()=>zl(e),"aria-label":Gt(e,"close"),type:"button"},["\xD7"])]])}commit(){let e=new Mi({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:Os.of(e)}))}keydown(e){(0,T.$1)(this.view,e,"search-panel")?e.preventDefault():e.keyCode==13&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?Kr:Gr)(this.view)):e.keyCode==13&&e.target==this.replaceField&&(e.preventDefault(),Hl(this.view))}update(e){for(let i of e.transactions)for(let r of i.effects)r.is(Os)&&!r.value.eq(this.query)&&this.setQuery(r.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(qt).top}}function Gt(s,e){return s.state.phrase(e)}const Jr=30,Xr=/[\s\.,:;?!]/;function cl(s,{from:e,to:i}){let r=s.state.doc.lineAt(e).from,l=s.state.doc.lineAt(i).to,c=Math.max(r,e-Jr),d=Math.min(l,i+Jr),y=s.state.sliceDoc(c,d);if(c!=r){for(let k=0;k<Jr;k++)if(!Xr.test(y[k+1])&&Xr.test(y[k])){y=y.slice(k);break}}if(d!=l){for(let k=y.length-1;k>y.length-Jr;k--)if(!Xr.test(y[k-1])&&Xr.test(y[k])){y=y.slice(0,k);break}}return T.tk.announce.of(`${s.state.phrase("current match")}. ${y} ${s.state.phrase("on line")} ${s.state.doc.lineAt(e).number}`)}const Va=T.tk.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),fl=[Ti,B.Wl.lowest(Ba),Va];class jl{constructor(e,i,r){this.state=e,this.pos=i,this.explicit=r,this.abortListeners=[]}tokenBefore(e){let i=Le(this.state).resolveInner(this.pos,-1);for(;i&&e.indexOf(i.name)<0;)i=i.parent;return i?{from:i.from,to:this.pos,text:this.state.sliceDoc(i.from,this.pos),type:i.type}:null}matchBefore(e){let i=this.state.doc.lineAt(this.pos),r=Math.max(i.from,this.pos-250),l=i.text.slice(r-i.from,this.pos-i.from),c=l.search(Ul(e,!1));return c<0?null:{from:r+c,to:this.pos,text:l.slice(c)}}get aborted(){return this.abortListeners==null}addEventListener(e,i){e=="abort"&&this.abortListeners&&this.abortListeners.push(i)}}function $l(s){let e=Object.keys(s).join(""),i=/\w/.test(e);return i&&(e=e.replace(/\w/g,"")),`[${i?"\\w":""}${e.replace(/[^\w\s]/g,"\\$&")}]`}function Fa(s){let e=Object.create(null),i=Object.create(null);for(let{label:l}of s){e[l[0]]=!0;for(let c=1;c<l.length;c++)i[l[c]]=!0}let r=$l(e)+$l(i)+"*$";return[new RegExp("^"+r),new RegExp(r)]}function Ha(s){let e=s.map(l=>typeof l=="string"?{label:l}:l),[i,r]=e.every(l=>/^\w+$/.test(l.label))?[/\w*$/,/\w+$/]:Fa(e);return l=>{let c=l.matchBefore(r);return c||l.explicit?{from:c?c.from:l.pos,options:e,validFor:i}:null}}function Uh(s,e){return i=>{for(let r=syntaxTree(i.state).resolveInner(i.pos,-1);r;r=r.parent)if(s.indexOf(r.name)>-1)return e(i);return null}}function Gh(s,e){return i=>{for(let r=syntaxTree(i.state).resolveInner(i.pos,-1);r;r=r.parent)if(s.indexOf(r.name)>-1)return null;return e(i)}}class ql{constructor(e,i,r){this.completion=e,this.source=i,this.match=r}}function zi(s){return s.selection.main.head}function Ul(s,e){var i;let{source:r}=s,l=e&&r[0]!="^",c=r[r.length-1]!="$";return!l&&!c?s:new RegExp(`${l?"^":""}(?:${r})${c?"$":""}`,(i=s.flags)!==null&&i!==void 0?i:s.ignoreCase?"i":"")}const Kh=null;function Wa(s,e,i,r){return Object.assign(Object.assign({},s.changeByRange(l=>{if(l==s.selection.main)return{changes:{from:i,to:r,insert:e},range:B.jT.cursor(i+e.length)};let c=r-i;return!l.empty||c&&s.sliceDoc(l.from-c,l.from)!=s.sliceDoc(i,r)?{range:l}:{changes:{from:l.from-c,to:l.from,insert:e},range:B.jT.cursor(l.from-c+e.length)}})),{userEvent:"input.complete"})}function Gl(s,e){const i=e.completion.apply||e.completion.label;let r=e.source;typeof i=="string"?s.dispatch(Wa(s.state,i,r.from,r.to)):i(s,e.completion,r.from,r.to)}const Kl=new WeakMap;function za(s){if(!Array.isArray(s))return s;let e=Kl.get(s);return e||Kl.set(s,e=Ha(s)),e}class ja{constructor(e){this.pattern=e,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[];for(let i=0;i<e.length;){let r=(0,B.gm)(e,i),l=(0,B.nZ)(r);this.chars.push(r);let c=e.slice(i,i+l),d=c.toUpperCase();this.folded.push((0,B.gm)(d==c?c.toLowerCase():d,0)),i+=l}this.astral=e.length!=this.chars.length}match(e){if(this.pattern.length==0)return[0];if(e.length<this.pattern.length)return null;let{chars:i,folded:r,any:l,precise:c,byWord:d}=this;if(i.length==1){let ae=(0,B.gm)(e,0);return ae==i[0]?[0,0,(0,B.nZ)(ae)]:ae==r[0]?[-200,0,(0,B.nZ)(ae)]:null}let y=e.indexOf(this.pattern);if(y==0)return[0,0,this.pattern.length];let k=i.length,M=0;if(y<0){for(let ae=0,Ne=Math.min(e.length,200);ae<Ne&&M<k;){let re=(0,B.gm)(e,ae);(re==i[M]||re==r[M])&&(l[M++]=ae),ae+=(0,B.nZ)(re)}if(M<k)return null}let E=0,I=0,W=!1,K=0,Q=-1,Se=-1,Je=/[a-z]/.test(e),De=!0;for(let ae=0,Ne=Math.min(e.length,200),re=0;ae<Ne&&I<k;){let ne=(0,B.gm)(e,ae);y<0&&(E<k&&ne==i[E]&&(c[E++]=ae),K<k&&(ne==i[K]||ne==r[K]?(K==0&&(Q=ae),Se=ae+1,K++):K=0));let ee,ue=ne<255?ne>=48&&ne<=57||ne>=97&&ne<=122?2:ne>=65&&ne<=90?1:0:(ee=(0,B.bg)(ne))!=ee.toLowerCase()?1:ee!=ee.toUpperCase()?2:0;(!ae||ue==1&&Je||re==0&&ue!=0)&&(i[I]==ne||r[I]==ne&&(W=!0)?d[I++]=ae:d.length&&(De=!1)),re=ue,ae+=(0,B.nZ)(ne)}return I==k&&d[0]==0&&De?this.result(-100+(W?-200:0),d,e):K==k&&Q==0?[-200-e.length,0,Se]:y>-1?[-700-e.length,y,y+this.pattern.length]:K==k?[-900-e.length,Q,Se]:I==k?this.result(-100+(W?-200:0)+-700+(De?0:-1100),d,e):i.length==2?null:this.result((l[0]?-700:0)+-200+-1100,l,e)}result(e,i,r){let l=[e-r.length],c=1;for(let d of i){let y=d+(this.astral?(0,B.nZ)((0,B.gm)(r,d)):1);c>1&&l[c-1]==d?l[c-1]=y:(l[c++]=d,l[c++]=y)}return l}}const ji=B.r$.define({combine(s){return(0,B.BO)(s,{activateOnTyping:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[]},{defaultKeymap:(e,i)=>e&&i,closeOnBlur:(e,i)=>e&&i,icons:(e,i)=>e&&i,optionClass:(e,i)=>r=>$a(e(r),i(r)),addToOptions:(e,i)=>e.concat(i)})}});function $a(s,e){return s?e?s+" "+e:s:e}function qa(s){let e=s.addToOptions.slice();return s.icons&&e.push({render(i){let r=document.createElement("div");return r.classList.add("cm-completionIcon"),i.type&&r.classList.add(...i.type.split(/\s+/g).map(l=>"cm-completionIcon-"+l)),r.setAttribute("aria-hidden","true"),r},position:20}),e.push({render(i,r,l){let c=document.createElement("span");c.className="cm-completionLabel";let{label:d}=i,y=0;for(let k=1;k<l.length;){let M=l[k++],E=l[k++];M>y&&c.appendChild(document.createTextNode(d.slice(y,M)));let I=c.appendChild(document.createElement("span"));I.appendChild(document.createTextNode(d.slice(M,E))),I.className="cm-completionMatchedText",y=E}return y<d.length&&c.appendChild(document.createTextNode(d.slice(y))),c},position:50},{render(i){if(!i.detail)return null;let r=document.createElement("span");return r.className="cm-completionDetail",r.textContent=i.detail,r},position:80}),e.sort((i,r)=>i.position-r.position).map(i=>i.render)}function _l(s,e,i){if(s<=i)return{from:0,to:s};if(e<=s>>1){let l=Math.floor(e/i);return{from:l*i,to:(l+1)*i}}let r=Math.floor((s-e)/i);return{from:s-(r+1)*i,to:s-r*i}}class Ua{constructor(e,i){this.view=e,this.stateField=i,this.info=null,this.placeInfo={read:()=>this.measureInfo(),write:y=>this.positionInfo(y),key:this};let r=e.state.field(i),{options:l,selected:c}=r.open,d=e.state.facet(ji);this.optionContent=qa(d),this.optionClass=d.optionClass,this.range=_l(l.length,c,d.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.dom.addEventListener("mousedown",y=>{for(let k=y.target,M;k&&k!=this.dom;k=k.parentNode)if(k.nodeName=="LI"&&(M=/-(\d+)$/.exec(k.id))&&+M[1]<l.length){Gl(e,l[+M[1]]),y.preventDefault();return}}),this.list=this.dom.appendChild(this.createListBox(l,r.id,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfo)})}mount(){this.updateSel()}update(e){e.state.field(this.stateField)!=e.startState.field(this.stateField)&&this.updateSel()}positioned(){this.info&&this.view.requestMeasure(this.placeInfo)}updateSel(){let e=this.view.state.field(this.stateField),i=e.open;if((i.selected<this.range.from||i.selected>=this.range.to)&&(this.range=_l(i.options.length,i.selected,this.view.state.facet(ji).maxRenderedOptions),this.list.remove(),this.list=this.dom.appendChild(this.createListBox(i.options,e.id,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfo)})),this.updateSelectedOption(i.selected)){this.info&&(this.info.remove(),this.info=null);let{completion:r}=i.options[i.selected],{info:l}=r;if(!l)return;let c=typeof l=="string"?document.createTextNode(l):l(r);if(!c)return;"then"in c?c.then(d=>{d&&this.view.state.field(this.stateField,!1)==e&&this.addInfoPane(d)}).catch(d=>(0,T.OO)(this.view.state,d,"completion info")):this.addInfoPane(c)}}addInfoPane(e){let i=this.info=document.createElement("div");i.className="cm-tooltip cm-completionInfo",i.appendChild(e),this.dom.appendChild(i),this.view.requestMeasure(this.placeInfo)}updateSelectedOption(e){let i=null;for(let r=this.list.firstChild,l=this.range.from;r;r=r.nextSibling,l++)l==e?r.hasAttribute("aria-selected")||(r.setAttribute("aria-selected","true"),i=r):r.hasAttribute("aria-selected")&&r.removeAttribute("aria-selected");return i&&Ka(this.list,i),i}measureInfo(){let e=this.dom.querySelector("[aria-selected]");if(!e||!this.info)return null;let i=this.dom.getBoundingClientRect(),r=this.info.getBoundingClientRect(),l=e.getBoundingClientRect();if(l.top>Math.min(innerHeight,i.bottom)-10||l.bottom<Math.max(0,i.top)+10)return null;let c=Math.max(0,Math.min(l.top,innerHeight-r.height))-i.top,d=this.view.textDirection==T.Nm.RTL,y=i.left,k=innerWidth-i.right;return d&&y<Math.min(r.width,k)?d=!1:!d&&k<Math.min(r.width,y)&&(d=!0),{top:c,left:d}}positionInfo(e){this.info&&(this.info.style.top=(e?e.top:-1e6)+"px",e&&(this.info.classList.toggle("cm-completionInfo-left",e.left),this.info.classList.toggle("cm-completionInfo-right",!e.left)))}createListBox(e,i,r){const l=document.createElement("ul");l.id=i,l.setAttribute("role","listbox"),l.setAttribute("aria-expanded","true"),l.setAttribute("aria-label",this.view.state.phrase("Completions"));for(let c=r.from;c<r.to;c++){let{completion:d,match:y}=e[c];const k=l.appendChild(document.createElement("li"));k.id=i+"-"+c,k.setAttribute("role","option");let M=this.optionClass(d);M&&(k.className=M);for(let E of this.optionContent){let I=E(d,this.view.state,y);I&&k.appendChild(I)}}return r.from&&l.classList.add("cm-completionListIncompleteTop"),r.to<e.length&&l.classList.add("cm-completionListIncompleteBottom"),l}}function Ga(s){return e=>new Ua(e,s)}function Ka(s,e){let i=s.getBoundingClientRect(),r=e.getBoundingClientRect();r.top<i.top?s.scrollTop-=i.top-r.top:r.bottom>i.bottom&&(s.scrollTop+=r.bottom-i.bottom)}function Jl(s){return(s.boost||0)*100+(s.apply?10:0)+(s.info?5:0)+(s.type?1:0)}function _a(s,e){let i=[],r=0;for(let d of s)if(d.hasResult())if(d.result.filter===!1){let y=d.result.getMatch;for(let k of d.result.options){let M=[1e9-r++];if(y)for(let E of y(k))M.push(E);i.push(new ql(k,d,M))}}else{let y=new ja(e.sliceDoc(d.from,d.to)),k;for(let M of d.result.options)(k=y.match(M.label))&&(M.boost!=null&&(k[0]+=M.boost),i.push(new ql(M,d,k)))}let l=[],c=null;for(let d of i.sort(Ya))!c||c.label!=d.completion.label||c.detail!=d.completion.detail||c.type!=null&&d.completion.type!=null&&c.type!=d.completion.type||c.apply!=d.completion.apply?l.push(d):Jl(d.completion)>Jl(c)&&(l[l.length-1]=d),c=d.completion;return l}class Bs{constructor(e,i,r,l,c){this.options=e,this.attrs=i,this.tooltip=r,this.timestamp=l,this.selected=c}setSelected(e,i){return e==this.selected||e>=this.options.length?this:new Bs(this.options,Xl(i,e),this.tooltip,this.timestamp,e)}static build(e,i,r,l,c){let d=_a(e,i);if(!d.length)return null;let y=0;if(l&&l.selected){let k=l.options[l.selected].completion;for(let M=0;M<d.length;M++)if(d[M].completion==k){y=M;break}}return new Bs(d,Xl(r,y),{pos:e.reduce((k,M)=>M.hasResult()?Math.min(k,M.from):k,1e8),create:Ga(pt),above:c.aboveCursor},l?l.timestamp:Date.now(),y)}map(e){return new Bs(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:e.mapPos(this.tooltip.pos)}),this.timestamp,this.selected)}}class Qr{constructor(e,i,r){this.active=e,this.id=i,this.open=r}static start(){return new Qr(Qa,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null)}update(e){let{state:i}=e,r=i.facet(ji),c=(r.override||i.languageDataAt("autocomplete",zi(i)).map(za)).map(y=>(this.active.find(M=>M.source==y)||new Tt(y,this.active.some(M=>M.state!=0)?1:0)).update(e,r));c.length==this.active.length&&c.every((y,k)=>y==this.active[k])&&(c=this.active);let d=e.selection||c.some(y=>y.hasResult()&&e.changes.touchesRange(y.from,y.to))||!Ja(c,this.active)?Bs.build(c,i,this.id,this.open,r):this.open&&e.docChanged?this.open.map(e.changes):this.open;!d&&c.every(y=>y.state!=1)&&c.some(y=>y.hasResult())&&(c=c.map(y=>y.hasResult()?new Tt(y.source,0):y));for(let y of e.effects)y.is(pl)&&(d=d&&d.setSelected(y.value,this.id));return c==this.active&&d==this.open?this:new Qr(c,this.id,d)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:Xa}}function Ja(s,e){if(s==e)return!0;for(let i=0,r=0;;){for(;i<s.length&&!s[i].hasResult;)i++;for(;r<e.length&&!e[r].hasResult;)r++;let l=i==s.length,c=r==e.length;if(l||c)return l==c;if(s[i++].result!=e[r++].result)return!1}}const Xa={"aria-autocomplete":"list"};function Xl(s,e){return{"aria-autocomplete":"list","aria-haspopup":"listbox","aria-activedescendant":s+"-"+e,"aria-controls":s}}const Qa=[];function Ya(s,e){let i=e.match[0]-s.match[0];return i||s.completion.label.localeCompare(e.completion.label)}function ul(s){return s.isUserEvent("input.type")?"input":s.isUserEvent("delete.backward")?"delete":null}class Tt{constructor(e,i,r=-1){this.source=e,this.state=i,this.explicitPos=r}hasResult(){return!1}update(e,i){let r=ul(e),l=this;r?l=l.handleUserEvent(e,r,i):e.docChanged?l=l.handleChange(e):e.selection&&l.state!=0&&(l=new Tt(l.source,0));for(let c of e.effects)if(c.is(dl))l=new Tt(l.source,1,c.value?zi(e.state):-1);else if(c.is(Yr))l=new Tt(l.source,0);else if(c.is(Ql))for(let d of c.value)d.source==l.source&&(l=d);return l}handleUserEvent(e,i,r){return i=="delete"||!r.activateOnTyping?this.map(e.changes):new Tt(this.source,1)}handleChange(e){return e.changes.touchesRange(zi(e.startState))?new Tt(this.source,0):this.map(e.changes)}map(e){return e.empty||this.explicitPos<0?this:new Tt(this.source,this.state,e.mapPos(this.explicitPos))}}class Ls extends Tt{constructor(e,i,r,l,c){super(e,2,i),this.result=r,this.from=l,this.to=c}hasResult(){return!0}handleUserEvent(e,i,r){var l;let c=e.changes.mapPos(this.from),d=e.changes.mapPos(this.to,1),y=zi(e.state);if((this.explicitPos<0?y<=c:y<this.from)||y>d||i=="delete"&&zi(e.startState)==this.from)return new Tt(this.source,i=="input"&&r.activateOnTyping?1:0);let k=this.explicitPos<0?-1:e.changes.mapPos(this.explicitPos),M;return Za(this.result.validFor,e.state,c,d)?new Ls(this.source,k,this.result,c,d):this.result.update&&(M=this.result.update(this.result,c,d,new jl(e.state,y,k>=0)))?new Ls(this.source,k,M,M.from,(l=M.to)!==null&&l!==void 0?l:zi(e.state)):new Tt(this.source,1,k)}handleChange(e){return e.changes.touchesRange(this.from,this.to)?new Tt(this.source,0):this.map(e.changes)}map(e){return e.empty?this:new Ls(this.source,this.explicitPos<0?-1:e.mapPos(this.explicitPos),this.result,e.mapPos(this.from),e.mapPos(this.to,1))}}function Za(s,e,i,r){if(!s)return!1;let l=e.sliceDoc(i,r);return typeof s=="function"?s(l,i,r,e):Ul(s,!0).test(l)}const dl=B.Py.define(),Yr=B.Py.define(),Ql=B.Py.define({map(s,e){return s.map(i=>i.map(e))}}),pl=B.Py.define(),pt=B.QQ.define({create(){return Qr.start()},update(s,e){return s.update(e)},provide:s=>[T.hJ.from(s,e=>e.tooltip),T.tk.contentAttributes.from(s,e=>e.attrs)]}),Yl=75;function Zr(s,e="option"){return i=>{let r=i.state.field(pt,!1);if(!r||!r.open||Date.now()-r.open.timestamp<Yl)return!1;let l=1,c;e=="page"&&(c=(0,T.gB)(i,r.open.tooltip))&&(l=Math.max(2,Math.floor(c.dom.offsetHeight/c.dom.querySelector("li").offsetHeight)-1));let d=r.open.selected+l*(s?1:-1),{length:y}=r.open.options;return d<0?d=e=="page"?0:y-1:d>=y&&(d=e=="page"?y-1:0),i.dispatch({effects:pl.of(d)}),!0}}const eh=s=>{let e=s.state.field(pt,!1);return s.state.readOnly||!e||!e.open||Date.now()-e.open.timestamp<Yl?!1:(Gl(s,e.open.options[e.open.selected]),!0)},th=s=>s.state.field(pt,!1)?(s.dispatch({effects:dl.of(!0)}),!0):!1,ih=s=>{let e=s.state.field(pt,!1);return!e||!e.active.some(i=>i.state!=0)?!1:(s.dispatch({effects:Yr.of(null)}),!0)};class nh{constructor(e,i){this.active=e,this.context=i,this.time=Date.now(),this.updates=[],this.done=void 0}}const Zl=50,sh=50,rh=1e3,oh=T.lg.fromClass(class{constructor(s){this.view=s,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.composing=0;for(let e of s.state.field(pt).active)e.state==1&&this.startQuery(e)}update(s){let e=s.state.field(pt);if(!s.selectionSet&&!s.docChanged&&s.startState.field(pt)==e)return;let i=s.transactions.some(r=>(r.selection||r.docChanged)&&!ul(r));for(let r=0;r<this.running.length;r++){let l=this.running[r];if(i||l.updates.length+s.transactions.length>sh&&Date.now()-l.time>rh){for(let c of l.context.abortListeners)try{c()}catch(d){(0,T.OO)(this.view.state,d)}l.context.abortListeners=null,this.running.splice(r--,1)}else l.updates.push(...s.transactions)}if(this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),this.debounceUpdate=e.active.some(r=>r.state==1&&!this.running.some(l=>l.active.source==r.source))?setTimeout(()=>this.startUpdate(),Zl):-1,this.composing!=0)for(let r of s.transactions)ul(r)=="input"?this.composing=2:this.composing==2&&r.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1;let{state:s}=this.view,e=s.field(pt);for(let i of e.active)i.state==1&&!this.running.some(r=>r.active.source==i.source)&&this.startQuery(i)}startQuery(s){let{state:e}=this.view,i=zi(e),r=new jl(e,i,s.explicitPos==i),l=new nh(s,r);this.running.push(l),Promise.resolve(s.source(r)).then(c=>{l.context.aborted||(l.done=c||null,this.scheduleAccept())},c=>{this.view.dispatch({effects:Yr.of(null)}),(0,T.OO)(this.view.state,c)})}scheduleAccept(){this.running.every(s=>s.done!==void 0)?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout(()=>this.accept(),Zl))}accept(){var s;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let e=[],i=this.view.state.facet(ji);for(let r=0;r<this.running.length;r++){let l=this.running[r];if(l.done===void 0)continue;if(this.running.splice(r--,1),l.done){let d=new Ls(l.active.source,l.active.explicitPos,l.done,l.done.from,(s=l.done.to)!==null&&s!==void 0?s:zi(l.updates.length?l.updates[0].startState:this.view.state));for(let y of l.updates)d=d.update(y,i);if(d.hasResult()){e.push(d);continue}}let c=this.view.state.field(pt).active.find(d=>d.source==l.active.source);if(c&&c.state==1)if(l.done==null){let d=new Tt(l.active.source,0);for(let y of l.updates)d=d.update(y,i);d.state!=1&&e.push(d)}else this.startQuery(c)}e.length&&this.view.dispatch({effects:Ql.of(e)})}},{eventHandlers:{blur(){let s=this.view.state.field(pt,!1);s&&s.tooltip&&this.view.state.facet(ji).closeOnBlur&&this.view.dispatch({effects:Yr.of(null)})},compositionstart(){this.composing=1},compositionend(){this.composing==3&&setTimeout(()=>this.view.dispatch({effects:dl.of(!1)}),20),this.composing=0}}}),ea=T.tk.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",listStyle:"none",margin:0,padding:0,"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer",padding:"1px 3px",lineHeight:1.2}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"\xB7\xB7\xB7"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"300px"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'\u0192'"}},".cm-completionIcon-class":{"&:after":{content:"'\u25CB'"}},".cm-completionIcon-interface":{"&:after":{content:"'\u25CC'"}},".cm-completionIcon-variable":{"&:after":{content:"'\u{1D465}'"}},".cm-completionIcon-constant":{"&:after":{content:"'\u{1D436}'"}},".cm-completionIcon-type":{"&:after":{content:"'\u{1D461}'"}},".cm-completionIcon-enum":{"&:after":{content:"'\u222A'"}},".cm-completionIcon-property":{"&:after":{content:"'\u25A1'"}},".cm-completionIcon-keyword":{"&:after":{content:"'\u{1F511}\uFE0E'"}},".cm-completionIcon-namespace":{"&:after":{content:"'\u25A2'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});class lh{constructor(e,i,r,l){this.field=e,this.line=i,this.from=r,this.to=l}}class ml{constructor(e,i,r){this.field=e,this.from=i,this.to=r}map(e){let i=e.mapPos(this.from,-1,MapMode.TrackDel),r=e.mapPos(this.to,1,MapMode.TrackDel);return i==null||r==null?null:new ml(this.field,i,r)}}class gl{constructor(e,i){this.lines=e,this.fieldPositions=i}instantiate(e,i){let r=[],l=[i],c=e.doc.lineAt(i),d=/^\s*/.exec(c.text)[0];for(let k of this.lines){if(r.length){let M=d,E=/^\t*/.exec(k)[0].length;for(let I=0;I<E;I++)M+=e.facet(indentUnit);l.push(i+M.length-E),k=M+k.slice(E)}r.push(k),i+=k.length+1}let y=this.fieldPositions.map(k=>new ml(k.field,l[k.line]+k.from,l[k.line]+k.to));return{text:r,ranges:y}}static parse(e){let i=[],r=[],l=[],c;for(let d of e.split(/\r\n?|\n/)){for(;c=/[#$]\{(?:(\d+)(?::([^}]*))?|([^}]*))\}/.exec(d);){let y=c[1]?+c[1]:null,k=c[2]||c[3]||"",M=-1;for(let E=0;E<i.length;E++)(y!=null?i[E].seq==y:k&&i[E].name==k)&&(M=E);if(M<0){let E=0;for(;E<i.length&&(y==null||i[E].seq!=null&&i[E].seq<y);)E++;i.splice(E,0,{seq:y,name:k}),M=E;for(let I of l)I.field>=M&&I.field++}l.push(new lh(M,r.length,c.index,c.index+k.length)),d=d.slice(0,c.index)+k+d.slice(c.index+c[0].length)}r.push(d)}return new gl(r,l)}}let ah=T.p.widget({widget:new class extends T.l9{toDOM(){let s=document.createElement("span");return s.className="cm-snippetFieldPosition",s}ignoreEvent(){return!1}}}),hh=T.p.mark({class:"cm-snippetField"});class Un{constructor(e,i){this.ranges=e,this.active=i,this.deco=T.p.set(e.map(r=>(r.from==r.to?ah:hh).range(r.from,r.to)))}map(e){let i=[];for(let r of this.ranges){let l=r.map(e);if(!l)return null;i.push(l)}return new Un(i,this.active)}selectionInsideField(e){return e.ranges.every(i=>this.ranges.some(r=>r.field==this.active&&r.from<=i.from&&r.to>=i.to))}}const Es=B.Py.define({map(s,e){return s&&s.map(e)}}),ch=B.Py.define(),Rs=B.QQ.define({create(){return null},update(s,e){for(let i of e.effects){if(i.is(Es))return i.value;if(i.is(ch)&&s)return new Un(s.ranges,i.value)}return s&&e.docChanged&&(s=s.map(e.changes)),s&&e.selection&&!s.selectionInsideField(e.selection)&&(s=null),s},provide:s=>T.tk.decorations.from(s,e=>e?e.deco:T.p.none)});function yl(s,e){return B.jT.create(s.filter(i=>i.field==e).map(i=>B.jT.range(i.from,i.to)))}function fh(s){let e=gl.parse(s);return(i,r,l,c)=>{let{text:d,ranges:y}=e.instantiate(i.state,l),k={changes:{from:l,to:c,insert:Text.of(d)}};if(y.length&&(k.selection=yl(y,0)),y.length>1){let M=new Un(y,0),E=k.effects=[Es.of(M)];i.state.field(Rs,!1)===void 0&&E.push(StateEffect.appendConfig.of([Rs,dh,ph,ea]))}i.dispatch(i.state.update(k))}}function ta(s){return({state:e,dispatch:i})=>{let r=e.field(Rs,!1);if(!r||s<0&&r.active==0)return!1;let l=r.active+s,c=s>0&&!r.ranges.some(d=>d.field==l+s);return i(e.update({selection:yl(r.ranges,l),effects:Es.of(c?null:new Un(r.ranges,l))})),!0}}const uh=[{key:"Tab",run:ta(1),shift:ta(-1)},{key:"Escape",run:({state:s,dispatch:e})=>s.field(Rs,!1)?(e(s.update({effects:Es.of(null)})),!0):!1}],ia=B.r$.define({combine(s){return s.length?s[0]:uh}}),dh=B.Wl.highest(T.$f.compute([ia],s=>s.facet(ia)));function Qh(s,e){return Object.assign(Object.assign({},e),{apply:fh(s)})}const ph=T.tk.domEventHandlers({mousedown(s,e){let i=e.state.field(Rs,!1),r;if(!i||(r=e.posAtCoords({x:s.clientX,y:s.clientY}))==null)return!1;let l=i.ranges.find(c=>c.from<=r&&c.to>=r);return!l||l.field==i.active?!1:(e.dispatch({selection:yl(i.ranges,l.field),effects:Es.of(i.ranges.some(c=>c.field>l.field)?new Un(i.ranges,l.field):null)}),!0)}});function mh(s){let e=s.replace(/[\\[.+*?(){|^$]/g,"\\$&");try{return new RegExp(`[\\p{Alphabetic}\\p{Number}_${e}]+`,"ug")}catch{return new RegExp(`[w${e}]`,"g")}}function na(s,e){return new RegExp(e(s.source),s.unicode?"u":"")}const sa=null;function gh(s){return sa[s]||(sa[s]=new WeakMap)}function ra(s,e,i,r,l){for(let c=s.iterLines(),d=0;!c.next().done;){let{value:y}=c,k;for(e.lastIndex=0;k=e.exec(y);)if(!r[k[0]]&&d+k.index!=l&&(i.push({type:"text",label:k[0]}),r[k[0]]=!0,i.length>=2e3))return;d+=y.length+1}}function oa(s,e,i,r,l){let c=s.length>=1e3,d=c&&e.get(s);if(d)return d;let y=[],k=Object.create(null);if(s.children){let M=0;for(let E of s.children){if(E.length>=1e3)for(let I of oa(E,e,i,r-M,l-M))k[I.label]||(k[I.label]=!0,y.push(I));else ra(E,i,y,k,l-M);M+=E.length+1}}else ra(s,i,y,k,l);return c&&y.length<2e3&&e.set(s,y),y}const Yh=s=>{let e=s.state.languageDataAt("wordChars",s.pos).join(""),i=mh(e),r=s.matchBefore(na(i,d=>d+"$"));if(!r&&!s.explicit)return null;let l=r?r.from:s.pos,c=oa(s.state.doc,gh(e),i,5e4,l);return{from:l,options:c,validFor:na(i,d=>"^"+d)}},eo={brackets:["(","[","{","'",'"'],before:")]}:;>"},dn=B.Py.define({map(s,e){let i=e.mapPos(s,-1,B.gc.TrackAfter);return i??void 0}}),bl=B.Py.define({map(s,e){return e.mapPos(s)}}),wl=new class extends B.uU{};wl.startSide=1,wl.endSide=-1;const la=B.QQ.define({create(){return B.Xs.empty},update(s,e){if(e.selection){let i=e.state.doc.lineAt(e.selection.main.head).from,r=e.startState.doc.lineAt(e.startState.selection.main.head).from;i!=e.changes.mapPos(r,-1)&&(s=B.Xs.empty)}s=s.map(e.changes);for(let i of e.effects)i.is(dn)?s=s.update({add:[wl.range(i.value,i.value+1)]}):i.is(bl)&&(s=s.update({filter:r=>r!=i.value}));return s}});function yh(){return[wh,la]}const xl="()[]{}<>";function aa(s){for(let e=0;e<xl.length;e+=2)if(xl.charCodeAt(e)==s)return xl.charAt(e+1);return(0,B.bg)(s<128?s:s+1)}function ha(s,e){return s.languageDataAt("closeBrackets",e)[0]||eo}const bh=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),wh=T.tk.inputHandler.of((s,e,i,r)=>{if((bh?s.composing:s.compositionStarted)||s.state.readOnly)return!1;let l=s.state.selection.main;if(r.length>2||r.length==2&&(0,B.nZ)((0,B.gm)(r,0))==1||e!=l.from||i!=l.to)return!1;let c=kh(s.state,r);return c?(s.dispatch(c),!0):!1}),xh=[{key:"Backspace",run:({state:s,dispatch:e})=>{if(s.readOnly)return!1;let r=ha(s,s.selection.main.head).brackets||eo.brackets,l=null,c=s.changeByRange(d=>{if(d.empty){let y=vh(s.doc,d.head);for(let k of r)if(k==y&&to(s.doc,d.head)==aa((0,B.gm)(k,0)))return{changes:{from:d.head-k.length,to:d.head+k.length},range:B.jT.cursor(d.head-k.length),userEvent:"delete.backward"}}return{range:l=d}});return l||e(s.update(c,{scrollIntoView:!0})),!l}}];function kh(s,e){let i=ha(s,s.selection.main.head),r=i.brackets||eo.brackets;for(let l of r){let c=aa((0,B.gm)(l,0));if(e==l)return c==l?Ah(s,l,r.indexOf(l+l+l)>-1):Sh(s,l,c,i.before||eo.before);if(e==c&&ca(s,s.selection.main.from))return Ch(s,l,c)}return null}function ca(s,e){let i=!1;return s.field(la).between(0,s.doc.length,r=>{r==e&&(i=!0)}),i}function to(s,e){let i=s.sliceString(e,e+2);return i.slice(0,(0,B.nZ)((0,B.gm)(i,0)))}function vh(s,e){let i=s.sliceString(e-2,e);return(0,B.nZ)((0,B.gm)(i,0))==i.length?i:i.slice(1)}function Sh(s,e,i,r){let l=null,c=s.changeByRange(d=>{if(!d.empty)return{changes:[{insert:e,from:d.from},{insert:i,from:d.to}],effects:dn.of(d.to+e.length),range:B.jT.range(d.anchor+e.length,d.head+e.length)};let y=to(s.doc,d.head);return!y||/\s/.test(y)||r.indexOf(y)>-1?{changes:{insert:e+i,from:d.head},effects:dn.of(d.head+e.length),range:B.jT.cursor(d.head+e.length)}:{range:l=d}});return l?null:s.update(c,{scrollIntoView:!0,userEvent:"input.type"})}function Ch(s,e,i){let r=null,l=s.selection.ranges.map(c=>c.empty&&to(s.doc,c.head)==i?B.jT.cursor(c.head+i.length):r=c);return r?null:s.update({selection:B.jT.create(l,s.selection.mainIndex),scrollIntoView:!0,effects:s.selection.ranges.map(({from:c})=>bl.of(c))})}function Ah(s,e,i){let r=null,l=s.changeByRange(c=>{if(!c.empty)return{changes:[{insert:e,from:c.from},{insert:e,from:c.to}],effects:dn.of(c.to+e.length),range:B.jT.range(c.anchor+e.length,c.head+e.length)};let d=c.head,y=to(s.doc,d);if(y==e){if(fa(s,d))return{changes:{insert:e+e,from:d},effects:dn.of(d+e.length),range:B.jT.cursor(d+e.length)};if(ca(s,d)){let k=i&&s.sliceDoc(d,d+e.length*3)==e+e+e;return{range:B.jT.cursor(d+e.length*(k?3:1)),effects:bl.of(d)}}}else{if(i&&s.sliceDoc(d-2*e.length,d)==e+e&&fa(s,d-2*e.length))return{changes:{insert:e+e+e+e,from:d},effects:dn.of(d+e.length),range:B.jT.cursor(d+e.length)};if(s.charCategorizer(d)(y)!=B.D0.Word){let k=s.sliceDoc(d-1,d);if(k!=e&&s.charCategorizer(d)(k)!=B.D0.Word&&!Mh(s,d,e))return{changes:{insert:e+e,from:d},effects:dn.of(d+e.length),range:B.jT.cursor(d+e.length)}}}return{range:r=c}});return r?null:s.update(l,{scrollIntoView:!0,userEvent:"input.type"})}function fa(s,e){let i=Le(s).resolveInner(e+1);return i.parent&&i.from==e}function Mh(s,e,i){let r=Le(s).resolveInner(e,-1);for(let l=0;l<5;l++){if(s.sliceDoc(r.from,r.from+i.length)==i)return!0;let c=r.to==e&&r.parent;if(!c)break;r=c}return!1}function Th(s={}){return[pt,ji.of(s),oh,Dh,ea]}const ua=[{key:"Ctrl-Space",run:th},{key:"Escape",run:ih},{key:"ArrowDown",run:Zr(!0)},{key:"ArrowUp",run:Zr(!1)},{key:"PageDown",run:Zr(!0,"page")},{key:"PageUp",run:Zr(!1,"page")},{key:"Enter",run:eh}],Dh=B.Wl.highest(T.$f.computeN([ji],s=>s.facet(ji).defaultKeymap?[ua]:[]));function ec(s){let e=s.field(pt,!1);return e&&e.active.some(i=>i.state==1)?"pending":e&&e.active.some(i=>i.state!=0)?"active":null}const da=new WeakMap;function tc(s){var e;let i=(e=s.field(pt,!1))===null||e===void 0?void 0:e.open;if(!i)return[];let r=da.get(i.options);return r||da.set(i.options,r=i.options.map(l=>l.completion)),r}function ic(s){var e;let i=(e=s.field(pt,!1))===null||e===void 0?void 0:e.open;return i?i.options[i.selected].completion:null}function nc(s){var e;let i=(e=s.field(pt,!1))===null||e===void 0?void 0:e.open;return i?i.selected:null}function sc(s){return pl.of(s)}class Oh{constructor(e,i,r){this.from=e,this.to=i,this.diagnostic=r}}class pn{constructor(e,i,r){this.diagnostics=e,this.panel=i,this.selected=r}static init(e,i,r){let l=e,c=r.facet(mn).markerFilter;c&&(l=c(l));let d=T.p.set(l.map(y=>y.from==y.to||y.from==y.to-1&&r.doc.lineAt(y.from).to==y.from?T.p.widget({widget:new Ih(y),diagnostic:y}).range(y.from):T.p.mark({attributes:{class:"cm-lintRange cm-lintRange-"+y.severity},diagnostic:y}).range(y.from,y.to)),!0);return new pn(d,i,Gn(d))}}function Gn(s,e=null,i=0){let r=null;return s.between(i,1e9,(l,c,{spec:d})=>{if(!(e&&d.diagnostic!=e))return r=new Oh(l,c,d.diagnostic),!1}),r}function pa(s,e){return!!(s.effects.some(i=>i.is(io))||s.changes.touchesRange(e.pos))}function ma(s,e){return s.field(Dt,!1)?e:e.concat(B.Py.appendConfig.of([Dt,T.tk.decorations.compute([Dt],i=>{let{selected:r,panel:l}=i.field(Dt);return!r||!l||r.from==r.to?T.p.none:T.p.set([Bh.range(r.from,r.to)])}),(0,T.bF)(Lh,{hideOn:pa}),Nh]))}function Ph(s,e){return{effects:ma(s,[io.of(e)])}}const io=B.Py.define(),kl=B.Py.define(),ga=B.Py.define(),Dt=B.QQ.define({create(){return new pn(T.p.none,null,null)},update(s,e){if(e.docChanged){let i=s.diagnostics.map(e.changes),r=null;if(s.selected){let l=e.changes.mapPos(s.selected.from,1);r=Gn(i,s.selected.diagnostic,l)||Gn(i,null,l)}s=new pn(i,s.panel,r)}for(let i of e.effects)i.is(io)?s=pn.init(i.value,s.panel,e.state):i.is(kl)?s=new pn(s.diagnostics,i.value?no.open:null,s.selected):i.is(ga)&&(s=new pn(s.diagnostics,s.panel,i.value));return s},provide:s=>[T.mH.from(s,e=>e.panel),T.tk.decorations.from(s,e=>e.diagnostics)]});function rc(s){let e=s.field(Dt,!1);return e?e.diagnostics.size:0}const Bh=T.p.mark({class:"cm-lintRange cm-lintRange-active"});function Lh(s,e,i){let{diagnostics:r}=s.state.field(Dt),l=[],c=2e8,d=0;r.between(e-(i<0?1:0),e+(i>0?1:0),(k,M,{spec:E})=>{e>=k&&e<=M&&(k==M||(e>k||i>0)&&(e<M||i<0))&&(l.push(E.diagnostic),c=Math.min(k,c),d=Math.max(M,d))});let y=s.state.facet(mn).tooltipFilter;return y&&(l=y(l)),l.length?{pos:c,end:d,above:s.state.doc.lineAt(c).to<d,create(){return{dom:ya(s,l)}}}:null}function ya(s,e){return a("ul",{class:"cm-tooltip-lint"},e.map(i=>ka(s,i,!1)))}const Eh=s=>{let e=s.state.field(Dt,!1);(!e||!e.panel)&&s.dispatch({effects:ma(s.state,[kl.of(!0)])});let i=(0,T.Sd)(s,no.open);return i&&i.dom.querySelector(".cm-panel-lint ul").focus(),!0},ba=s=>{let e=s.state.field(Dt,!1);return!e||!e.panel?!1:(s.dispatch({effects:kl.of(!1)}),!0)},Rh=[{key:"Mod-Shift-m",run:Eh},{key:"F8",run:s=>{let e=s.state.field(Dt,!1);if(!e)return!1;let i=s.state.selection.main,r=e.diagnostics.iter(i.to+1);return!r.value&&(r=e.diagnostics.iter(0),!r.value||r.from==i.from&&r.to==i.to)?!1:(s.dispatch({selection:{anchor:r.from,head:r.to},scrollIntoView:!0}),!0)}}],wa=T.lg.fromClass(class{constructor(s){this.view=s,this.timeout=-1,this.set=!0;let{delay:e}=s.state.facet(mn);this.lintTime=Date.now()+e,this.run=this.run.bind(this),this.timeout=setTimeout(this.run,e)}run(){let s=Date.now();if(s<this.lintTime-10)setTimeout(this.run,this.lintTime-s);else{this.set=!1;let{state:e}=this.view,{sources:i}=e.facet(mn);Promise.all(i.map(r=>Promise.resolve(r(this.view)))).then(r=>{let l=r.reduce((c,d)=>c.concat(d));this.view.state.doc==e.doc&&this.view.dispatch(Ph(this.view.state,l))},r=>{(0,T.OO)(this.view.state,r)})}}update(s){let e=s.state.facet(mn);(s.docChanged||e!=s.startState.facet(mn))&&(this.lintTime=Date.now()+e.delay,this.set||(this.set=!0,this.timeout=setTimeout(this.run,e.delay)))}force(){this.set&&(this.lintTime=Date.now(),this.run())}destroy(){clearTimeout(this.timeout)}}),mn=B.r$.define({combine(s){return Object.assign({sources:s.map(e=>e.source)},(0,B.BO)(s.map(e=>e.config),{delay:750,markerFilter:null,tooltipFilter:null}))},enables:wa});function lc(s,e={}){return mn.of({source:s,config:e})}function ac(s){let e=s.plugin(wa);e&&e.force()}function xa(s){let e=[];if(s)e:for(let{name:i}of s){for(let r=0;r<i.length;r++){let l=i[r];if(/[a-zA-Z]/.test(l)&&!e.some(c=>c.toLowerCase()==l.toLowerCase())){e.push(l);continue e}}e.push("")}return e}function ka(s,e,i){var r;let l=i?xa(e.actions):[];return a("li",{class:"cm-diagnostic cm-diagnostic-"+e.severity},a("span",{class:"cm-diagnosticText"},e.renderMessage?e.renderMessage():e.message),(r=e.actions)===null||r===void 0?void 0:r.map((c,d)=>{let y=I=>{I.preventDefault();let W=Gn(s.state.field(Dt).diagnostics,e);W&&c.apply(s,W.from,W.to)},{name:k}=c,M=l[d]?k.indexOf(l[d]):-1,E=M<0?k:[k.slice(0,M),a("u",k.slice(M,M+1)),k.slice(M+1)];return a("button",{type:"button",class:"cm-diagnosticAction",onclick:y,onmousedown:y,"aria-label":` Action: ${k}${M<0?"":` (access key "${l[d]})"`}.`},E)}),e.source&&a("div",{class:"cm-diagnosticSource"},e.source))}class Ih extends T.l9{constructor(e){super(),this.diagnostic=e}eq(e){return e.diagnostic==this.diagnostic}toDOM(){return a("span",{class:"cm-lintPoint cm-lintPoint-"+this.diagnostic.severity})}}class va{constructor(e,i){this.diagnostic=i,this.id="item_"+Math.floor(Math.random()*4294967295).toString(16),this.dom=ka(e,i,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class no{constructor(e){this.view=e,this.items=[];let i=l=>{if(l.keyCode==27)ba(this.view),this.view.focus();else if(l.keyCode==38||l.keyCode==33)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(l.keyCode==40||l.keyCode==34)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(l.keyCode==36)this.moveSelection(0);else if(l.keyCode==35)this.moveSelection(this.items.length-1);else if(l.keyCode==13)this.view.focus();else if(l.keyCode>=65&&l.keyCode<=90&&this.selectedIndex>=0){let{diagnostic:c}=this.items[this.selectedIndex],d=xa(c.actions);for(let y=0;y<d.length;y++)if(d[y].toUpperCase().charCodeAt(0)==l.keyCode){let k=Gn(this.view.state.field(Dt).diagnostics,c);k&&c.actions[y].apply(e,k.from,k.to)}}else return;l.preventDefault()},r=l=>{for(let c=0;c<this.items.length;c++)this.items[c].dom.contains(l.target)&&this.moveSelection(c)};this.list=a("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:i,onclick:r}),this.dom=a("div",{class:"cm-panel-lint"},this.list,a("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>ba(this.view)},"\xD7")),this.update()}get selectedIndex(){let e=this.view.state.field(Dt).selected;if(!e)return-1;for(let i=0;i<this.items.length;i++)if(this.items[i].diagnostic==e.diagnostic)return i;return-1}update(){let{diagnostics:e,selected:i}=this.view.state.field(Dt),r=0,l=!1,c=null;for(e.between(0,this.view.state.doc.length,(d,y,{spec:k})=>{let M=-1,E;for(let I=r;I<this.items.length;I++)if(this.items[I].diagnostic==k.diagnostic){M=I;break}M<0?(E=new va(this.view,k.diagnostic),this.items.splice(r,0,E),l=!0):(E=this.items[M],M>r&&(this.items.splice(r,M-r),l=!0)),i&&E.diagnostic==i.diagnostic?E.dom.hasAttribute("aria-selected")||(E.dom.setAttribute("aria-selected","true"),c=E):E.dom.hasAttribute("aria-selected")&&E.dom.removeAttribute("aria-selected"),r++});r<this.items.length&&!(this.items.length==1&&this.items[0].diagnostic.from<0);)l=!0,this.items.pop();this.items.length==0&&(this.items.push(new va(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),l=!0),c?(this.list.setAttribute("aria-activedescendant",c.id),this.view.requestMeasure({key:this,read:()=>({sel:c.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:d,panel:y})=>{d.top<y.top?this.list.scrollTop-=y.top-d.top:d.bottom>y.bottom&&(this.list.scrollTop+=d.bottom-y.bottom)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),l&&this.sync()}sync(){let e=this.list.firstChild;function i(){let r=e;e=r.nextSibling,r.remove()}for(let r of this.items)if(r.dom.parentNode==this.list){for(;e!=r.dom;)i();e=r.dom.nextSibling}else this.list.insertBefore(r.dom,e);for(;e;)i()}moveSelection(e){if(this.selectedIndex<0)return;let i=this.view.state.field(Dt),r=Gn(i.diagnostics,this.items[e].diagnostic);r&&this.view.dispatch({selection:{anchor:r.from,head:r.to},scrollIntoView:!0,effects:ga.of(r)})}static open(e){return new no(e)}}function so(s,e='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${e}>${encodeURIComponent(s)}</svg>')`}function vl(s){return so(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${s}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}const Nh=T.tk.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:vl("#d11")},".cm-lintRange-warning":{backgroundImage:vl("orange")},".cm-lintRange-info":{backgroundImage:vl("#999")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}});class Vh extends T.SJ{constructor(e){super(),this.diagnostics=e,this.severity=e.reduce((i,r)=>{let l=r.severity;return l=="error"||l=="warning"&&i=="info"?l:i},"info")}toDOM(e){let i=document.createElement("div");i.className="cm-lint-marker cm-lint-marker-"+this.severity;let r=this.diagnostics,l=e.state.facet(ro).tooltipFilter;return l&&(r=l(r)),r.length&&(i.onmouseover=()=>Hh(e,i,r)),i}}function Fh(s,e){let i=r=>{let l=e.getBoundingClientRect();if(!(r.clientX>l.left-10&&r.clientX<l.right+10&&r.clientY>l.top-10&&r.clientY<l.bottom+10)){for(let c=r.target;c;c=c.parentNode)if(c.nodeType==1&&c.classList.contains("cm-tooltip-lint"))return;window.removeEventListener("mousemove",i),s.state.field(Ca)&&s.dispatch({effects:Sl.of(null)})}};window.addEventListener("mousemove",i)}function Hh(s,e,i){function r(){let d=s.elementAtHeight(e.getBoundingClientRect().top+5-s.documentTop);s.coordsAtPos(d.from)&&s.dispatch({effects:Sl.of({pos:d.from,above:!1,create(){return{dom:ya(s,i),getCoords:()=>e.getBoundingClientRect()}}})}),e.onmouseout=e.onmousemove=null,Fh(s,e)}let{hoverTime:l}=s.state.facet(ro),c=setTimeout(r,l);e.onmouseout=()=>{clearTimeout(c),e.onmouseout=e.onmousemove=null},e.onmousemove=()=>{clearTimeout(c),c=setTimeout(r,l)}}function Wh(s,e){let i=Object.create(null);for(let l of e){let c=s.lineAt(l.from);(i[c.from]||(i[c.from]=[])).push(l)}let r=[];for(let l in i)r.push(new Vh(i[l]).range(+l));return B.Xs.of(r,!0)}const zh=(0,T.v5)({class:"cm-gutter-lint",markers:s=>s.state.field(Sa)}),Sa=B.QQ.define({create(){return B.Xs.empty},update(s,e){s=s.map(e.changes);let i=e.state.facet(ro).markerFilter;for(let r of e.effects)if(r.is(io)){let l=r.value;i&&(l=i(l||[])),s=Wh(e.state.doc,l.slice(0))}return s}}),Sl=B.Py.define(),Ca=B.QQ.define({create(){return null},update(s,e){return s&&e.docChanged&&(s=pa(e,s)?null:Object.assign(Object.assign({},s),{pos:e.changes.mapPos(s.pos)})),e.effects.reduce((i,r)=>r.is(Sl)?r.value:i,s)},provide:s=>T.hJ.from(s)}),jh=T.tk.baseTheme({".cm-gutter-lint":{width:"1.4em","& .cm-gutterElement":{padding:".2em"}},".cm-lint-marker":{width:"1em",height:"1em"},".cm-lint-marker-info":{content:so('<path fill="#aaf" stroke="#77e" stroke-width="6" stroke-linejoin="round" d="M5 5L35 5L35 35L5 35Z"/>')},".cm-lint-marker-warning":{content:so('<path fill="#fe8" stroke="#fd7" stroke-width="6" stroke-linejoin="round" d="M20 6L37 35L3 35Z"/>')},".cm-lint-marker-error:before":{content:so('<circle cx="20" cy="20" r="15" fill="#f87" stroke="#f43" stroke-width="6"/>')}}),ro=B.r$.define({combine(s){return(0,B.BO)(s,{hoverTime:300,markerFilter:null,tooltipFilter:null})}});function hc(s={}){return[ro.of(s),Sa,zh,jh,Ca]}const $h=[(0,T.Eu)(),(0,T.HQ)(),(0,T.AE)(),cr(),Zn(),(0,T.Uw)(),(0,T.qr)(),B.yy.allowMultipleSelections.of(!0),Ns(),uo(Zs,{fallback:!0}),ir(),yh(),Th(),(0,T.Zs)(),(0,T.S2)(),(0,T.ZO)(),Me(),T.$f.of([...xh,...ol,...Ia,...yr,...Gs,...ua,...Rh])]},78120:function(lo,Ui,Ht){Ht.d(Ui,{BO:function(){return Yi},D0:function(){return be},Gz:function(){return li},IS:function(){return Jn},Py:function(){return Fe},QQ:function(){return Wt},Wl:function(){return Ki},Xs:function(){return nt},YW:function(){return ce},as:function(){return Re},bg:function(){return gt},cp:function(){return Ae},f_:function(){return wi},gc:function(){return me},gm:function(){return Be},jT:function(){return ge},n0:function(){return Xe},nZ:function(){return st},q6:function(){return vt},r$:function(){return Ye},uU:function(){return Ue},xv:function(){return T},yy:function(){return ye}});class T{constructor(){}lineAt(f){if(f<0||f>this.length)throw new RangeError(`Invalid position ${f} in document of length ${this.length}`);return this.lineInner(f,!1,1,0)}line(f){if(f<1||f>this.lines)throw new RangeError(`Invalid line number ${f} in ${this.lines}-line document`);return this.lineInner(f,!0,1,0)}replace(f,p,g){let w=[];return this.decompose(0,f,w,2),g.length&&g.decompose(0,g.length,w,3),this.decompose(p,this.length,w,1),Oe.from(w,this.length-(p-f)+g.length)}append(f){return this.replace(this.length,this.length,f)}slice(f,p=this.length){let g=[];return this.decompose(f,p,g,0),Oe.from(g,p-f)}eq(f){if(f==this)return!0;if(f.length!=this.length||f.lines!=this.lines)return!1;let p=this.scanIdentical(f,1),g=this.length-this.scanIdentical(f,-1),w=new Te(this),v=new Te(f);for(let S=p,O=p;;){if(w.next(S),v.next(S),S=0,w.lineBreak!=v.lineBreak||w.done!=v.done||w.value!=v.value)return!1;if(O+=w.value.length,w.done||O>=g)return!0}}iter(f=1){return new Te(this,f)}iterRange(f,p=this.length){return new ei(this,f,p)}iterLines(f,p){let g;if(f==null)g=this.iter();else{p==null&&(p=this.lines+1);let w=this.line(f).from;g=this.iterRange(w,Math.max(w,p==this.lines+1?this.length:p<=1?0:this.line(p-1).to))}return new ie(g)}toString(){return this.sliceString(0)}toJSON(){let f=[];return this.flatten(f),f}static of(f){if(f.length==0)throw new RangeError("A document must have at least one line");return f.length==1&&!f[0]?T.empty:f.length<=32?new B(f):Oe.from(B.split(f,[]))}}class B extends T{constructor(f,p=Kt(f)){super(),this.text=f,this.length=p}get lines(){return this.text.length}get children(){return null}lineInner(f,p,g,w){for(let v=0;;v++){let S=this.text[v],O=w+S.length;if((p?g:O)>=f)return new Pe(w,O,g,S);w=O+1,g++}}decompose(f,p,g,w){let v=f<=0&&p>=this.length?this:new B(te(this.text,f,p),Math.min(p,this.length)-Math.max(0,f));if(w&1){let S=g.pop(),O=ze(v.text,S.text.slice(),0,v.length);if(O.length<=32)g.push(new B(O,S.length+v.length));else{let L=O.length>>1;g.push(new B(O.slice(0,L)),new B(O.slice(L)))}}else g.push(v)}replace(f,p,g){if(!(g instanceof B))return super.replace(f,p,g);let w=ze(this.text,ze(g.text,te(this.text,0,f)),p),v=this.length+g.length-(p-f);return w.length<=32?new B(w,v):Oe.from(B.split(w,[]),v)}sliceString(f,p=this.length,g=`
`){let w="";for(let v=0,S=0;v<=p&&S<this.text.length;S++){let O=this.text[S],L=v+O.length;v>f&&S&&(w+=g),f<L&&p>v&&(w+=O.slice(Math.max(0,f-v),p-v)),v=L+1}return w}flatten(f){for(let p of this.text)f.push(p)}scanIdentical(){return 0}static split(f,p){let g=[],w=-1;for(let v of f)g.push(v),w+=v.length+1,g.length==32&&(p.push(new B(g,w)),g=[],w=-1);return w>-1&&p.push(new B(g,w)),p}}class Oe extends T{constructor(f,p){super(),this.children=f,this.length=p,this.lines=0;for(let g of f)this.lines+=g.lines}lineInner(f,p,g,w){for(let v=0;;v++){let S=this.children[v],O=w+S.length,L=g+S.lines-1;if((p?L:O)>=f)return S.lineInner(f,p,g,w);w=O+1,g=L+1}}decompose(f,p,g,w){for(let v=0,S=0;S<=p&&v<this.children.length;v++){let O=this.children[v],L=S+O.length;if(f<=L&&p>=S){let R=w&((S<=f?1:0)|(L>=p?2:0));S>=f&&L<=p&&!R?g.push(O):O.decompose(f-S,p-S,g,R)}S=L+1}}replace(f,p,g){if(g.lines<this.lines)for(let w=0,v=0;w<this.children.length;w++){let S=this.children[w],O=v+S.length;if(f>=v&&p<=O){let L=S.replace(f-v,p-v,g),R=this.lines-S.lines+L.lines;if(L.lines<R>>4&&L.lines>R>>6){let H=this.children.slice();return H[w]=L,new Oe(H,this.length-(p-f)+g.length)}return super.replace(v,O,L)}v=O+1}return super.replace(f,p,g)}sliceString(f,p=this.length,g=`
`){let w="";for(let v=0,S=0;v<this.children.length&&S<=p;v++){let O=this.children[v],L=S+O.length;S>f&&v&&(w+=g),f<L&&p>S&&(w+=O.sliceString(f-S,p-S,g)),S=L+1}return w}flatten(f){for(let p of this.children)p.flatten(f)}scanIdentical(f,p){if(!(f instanceof Oe))return 0;let g=0,[w,v,S,O]=p>0?[0,0,this.children.length,f.children.length]:[this.children.length-1,f.children.length-1,-1,-1];for(;;w+=p,v+=p){if(w==S||v==O)return g;let L=this.children[w],R=f.children[v];if(L!=R)return g+L.scanIdentical(R,p);g+=L.length+1}}static from(f,p=f.reduce((g,w)=>g+w.length+1,-1)){let g=0;for(let j of f)g+=j.lines;if(g<32){let j=[];for(let ve of f)ve.flatten(j);return new B(j,p)}let w=Math.max(32,g>>5),v=w<<1,S=w>>1,O=[],L=0,R=-1,H=[];function z(j){let ve;if(j.lines>v&&j instanceof Oe)for(let At of j.children)z(At);else j.lines>S&&(L>S||!L)?(G(),O.push(j)):j instanceof B&&L&&(ve=H[H.length-1])instanceof B&&j.lines+ve.lines<=32?(L+=j.lines,R+=j.length+1,H[H.length-1]=new B(ve.text.concat(j.text),ve.length+1+j.length)):(L+j.lines>w&&G(),L+=j.lines,R+=j.length+1,H.push(j))}function G(){L!=0&&(O.push(H.length==1?H[0]:Oe.from(H,R)),R=-1,L=H.length=0)}for(let j of f)z(j);return G(),O.length==1?O[0]:new Oe(O,p)}}T.empty=new B([""],0);function Kt(C){let f=-1;for(let p of C)f+=p.length+1;return f}function ze(C,f,p=0,g=1e9){for(let w=0,v=0,S=!0;v<C.length&&w<=g;v++){let O=C[v],L=w+O.length;L>=p&&(L>g&&(O=O.slice(0,g-w)),w<p&&(O=O.slice(p-w)),S?(f[f.length-1]+=O,S=!1):f.push(O)),w=L+1}return f}function te(C,f,p){return ze(C,[""],f,p)}class Te{constructor(f,p=1){this.dir=p,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[f],this.offsets=[p>0?1:(f instanceof B?f.text.length:f.children.length)<<1]}nextInner(f,p){for(this.done=this.lineBreak=!1;;){let g=this.nodes.length-1,w=this.nodes[g],v=this.offsets[g],S=v>>1,O=w instanceof B?w.text.length:w.children.length;if(S==(p>0?O:0)){if(g==0)return this.done=!0,this.value="",this;p>0&&this.offsets[g-1]++,this.nodes.pop(),this.offsets.pop()}else if((v&1)==(p>0?0:1)){if(this.offsets[g]+=p,f==0)return this.lineBreak=!0,this.value=`
`,this;f--}else if(w instanceof B){let L=w.text[S+(p<0?-1:0)];if(this.offsets[g]+=p,L.length>Math.max(0,f))return this.value=f==0?L:p>0?L.slice(f):L.slice(0,L.length-f),this;f-=L.length}else{let L=w.children[S+(p<0?-1:0)];f>L.length?(f-=L.length,this.offsets[g]+=p):(p<0&&this.offsets[g]--,this.nodes.push(L),this.offsets.push(p>0?1:(L instanceof B?L.text.length:L.children.length)<<1))}}}next(f=0){return f<0&&(this.nextInner(-f,-this.dir),f=this.value.length),this.nextInner(f,this.dir)}}class ei{constructor(f,p,g){this.value="",this.done=!1,this.cursor=new Te(f,p>g?-1:1),this.pos=p>g?f.length:0,this.from=Math.min(p,g),this.to=Math.max(p,g)}nextInner(f,p){if(p<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;f+=Math.max(0,p<0?this.pos-this.to:this.from-this.pos);let g=p<0?this.pos-this.from:this.to-this.pos;f>g&&(f=g),g-=f;let{value:w}=this.cursor.next(f);return this.pos+=(w.length+f)*p,this.value=w.length<=g?w:p<0?w.slice(w.length-g):w.slice(0,g),this.done=!this.value,this}next(f=0){return f<0?f=Math.max(f,this.from-this.pos):f>0&&(f=Math.min(f,this.to-this.pos)),this.nextInner(f,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}}class ie{constructor(f){this.inner=f,this.afterBreak=!0,this.value="",this.done=!1}next(f=0){let{done:p,lineBreak:g,value:w}=this.inner.next(f);return p?(this.done=!0,this.value=""):g?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=w,this.afterBreak=!1),this}get lineBreak(){return!1}}typeof Symbol<"u"&&(T.prototype[Symbol.iterator]=function(){return this.iter()},Te.prototype[Symbol.iterator]=ei.prototype[Symbol.iterator]=ie.prototype[Symbol.iterator]=function(){return this});class Pe{constructor(f,p,g,w){this.from=f,this.to=p,this.number=g,this.text=w}get length(){return this.to-this.from}}let he="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(C=>C?parseInt(C,36):1);for(let C=1;C<he.length;C++)he[C]+=he[C-1];function je(C){for(let f=1;f<he.length;f+=2)if(he[f]>C)return he[f-1]<=C;return!1}function Z(C){return C>=127462&&C<=127487}const Y=8205;function Ae(C,f,p=!0,g=!0){return(p?ke:Pt)(C,f,g)}function ke(C,f,p){if(f==C.length)return f;f&&mt(C.charCodeAt(f))&&tt(C.charCodeAt(f-1))&&f--;let g=Be(C,f);for(f+=st(g);f<C.length;){let w=Be(C,f);if(g==Y||w==Y||p&&je(w))f+=st(w),g=w;else if(Z(w)){let v=0,S=f-2;for(;S>=0&&Z(Be(C,S));)v++,S-=2;if(v%2==0)break;f+=2}else break}return f}function Pt(C,f,p){for(;f>0;){let g=ke(C,f-2,p);if(g<f)return g;f--}return 0}function mt(C){return C>=56320&&C<57344}function tt(C){return C>=55296&&C<56320}function Be(C,f){let p=C.charCodeAt(f);if(!tt(p)||f+1==C.length)return p;let g=C.charCodeAt(f+1);return mt(g)?(p-55296<<10)+(g-56320)+65536:p}function gt(C){return C<=65535?String.fromCharCode(C):(C-=65536,String.fromCharCode((C>>10)+55296,(C&1023)+56320))}function st(C){return C<65536?1:2}const Bt=/\r\n?|\n/;var me=function(C){return C[C.Simple=0]="Simple",C[C.TrackDel=1]="TrackDel",C[C.TrackBefore=2]="TrackBefore",C[C.TrackAfter=3]="TrackAfter",C}(me||(me={}));class Xe{constructor(f){this.sections=f}get length(){let f=0;for(let p=0;p<this.sections.length;p+=2)f+=this.sections[p];return f}get newLength(){let f=0;for(let p=0;p<this.sections.length;p+=2){let g=this.sections[p+1];f+=g<0?this.sections[p]:g}return f}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(f){for(let p=0,g=0,w=0;p<this.sections.length;){let v=this.sections[p++],S=this.sections[p++];S<0?(f(g,w,v),w+=v):w+=S,g+=v}}iterChangedRanges(f,p=!1){ti(this,f,p)}get invertedDesc(){let f=[];for(let p=0;p<this.sections.length;){let g=this.sections[p++],w=this.sections[p++];w<0?f.push(g,w):f.push(w,g)}return new Xe(f)}composeDesc(f){return this.empty?f:f.empty?this:$e(this,f)}mapDesc(f,p=!1){return f.empty?this:ii(this,f,p)}mapPos(f,p=-1,g=me.Simple){let w=0,v=0;for(let S=0;S<this.sections.length;){let O=this.sections[S++],L=this.sections[S++],R=w+O;if(L<0){if(R>f)return v+(f-w);v+=O}else{if(g!=me.Simple&&R>=f&&(g==me.TrackDel&&w<f&&R>f||g==me.TrackBefore&&w<f||g==me.TrackAfter&&R>f))return null;if(R>f||R==f&&p<0&&!O)return f==w||p<0?v:v+L;v+=L}w=R}if(f>w)throw new RangeError(`Position ${f} is out of range for changeset of length ${w}`);return v}touchesRange(f,p=f){for(let g=0,w=0;g<this.sections.length&&w<=p;){let v=this.sections[g++],S=this.sections[g++],O=w+v;if(S>=0&&w<=p&&O>=f)return w<f&&O>p?"cover":!0;w=O}return!1}toString(){let f="";for(let p=0;p<this.sections.length;){let g=this.sections[p++],w=this.sections[p++];f+=(f?" ":"")+g+(w>=0?":"+w:"")}return f}toJSON(){return this.sections}static fromJSON(f){if(!Array.isArray(f)||f.length%2||f.some(p=>typeof p!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new Xe(f)}static create(f){return new Xe(f)}}class Re extends Xe{constructor(f,p){super(f),this.inserted=p}apply(f){if(this.length!=f.length)throw new RangeError("Applying change set to a document with the wrong length");return ti(this,(p,g,w,v,S)=>f=f.replace(w,w+(g-p),S),!1),f}mapDesc(f,p=!1){return ii(this,f,p,!0)}invert(f){let p=this.sections.slice(),g=[];for(let w=0,v=0;w<p.length;w+=2){let S=p[w],O=p[w+1];if(O>=0){p[w]=O,p[w+1]=S;let L=w>>1;for(;g.length<L;)g.push(T.empty);g.push(S?f.slice(v,v+S):T.empty)}v+=S}return new Re(p,g)}compose(f){return this.empty?f:f.empty?this:$e(this,f,!0)}map(f,p=!1){return f.empty?this:ii(this,f,p,!0)}iterChanges(f,p=!1){ti(this,f,p)}get desc(){return Xe.create(this.sections)}filter(f){let p=[],g=[],w=[],v=new Qe(this);e:for(let S=0,O=0;;){let L=S==f.length?1e9:f[S++];for(;O<L||O==L&&v.len==0;){if(v.done)break e;let H=Math.min(v.len,L-O);Ve(w,H,-1);let z=v.ins==-1?-1:v.off==0?v.ins:0;Ve(p,H,z),z>0&&at(g,p,v.text),v.forward(H),O+=H}let R=f[S++];for(;O<R;){if(v.done)break e;let H=Math.min(v.len,R-O);Ve(p,H,-1),Ve(w,H,v.ins==-1?-1:v.off==0?v.ins:0),v.forward(H),O+=H}}return{changes:new Re(p,g),filtered:Xe.create(w)}}toJSON(){let f=[];for(let p=0;p<this.sections.length;p+=2){let g=this.sections[p],w=this.sections[p+1];w<0?f.push(g):w==0?f.push([g]):f.push([g].concat(this.inserted[p>>1].toJSON()))}return f}static of(f,p,g){let w=[],v=[],S=0,O=null;function L(H=!1){if(!H&&!w.length)return;S<p&&Ve(w,p-S,-1);let z=new Re(w,v);O=O?O.compose(z.map(O)):z,w=[],v=[],S=0}function R(H){if(Array.isArray(H))for(let z of H)R(z);else if(H instanceof Re){if(H.length!=p)throw new RangeError(`Mismatched change set length (got ${H.length}, expected ${p})`);L(),O=O?O.compose(H.map(O)):H}else{let{from:z,to:G=z,insert:j}=H;if(z>G||z<0||G>p)throw new RangeError(`Invalid change range ${z} to ${G} (in doc of length ${p})`);let ve=j?typeof j=="string"?T.of(j.split(g||Bt)):j:T.empty,At=ve.length;if(z==G&&At==0)return;z<S&&L(),z>S&&Ve(w,z-S,-1),Ve(w,G-z,At),at(v,w,ve),S=G}}return R(f),L(!O),O}static empty(f){return new Re(f?[f,-1]:[],[])}static fromJSON(f){if(!Array.isArray(f))throw new RangeError("Invalid JSON representation of ChangeSet");let p=[],g=[];for(let w=0;w<f.length;w++){let v=f[w];if(typeof v=="number")p.push(v,-1);else{if(!Array.isArray(v)||typeof v[0]!="number"||v.some((S,O)=>O&&typeof S!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(v.length==1)p.push(v[0],0);else{for(;g.length<w;)g.push(T.empty);g[w]=T.of(v.slice(1)),p.push(v[0],g[w].length)}}}return new Re(p,g)}static createSet(f,p){return new Re(f,p)}}function Ve(C,f,p,g=!1){if(f==0&&p<=0)return;let w=C.length-2;w>=0&&p<=0&&p==C[w+1]?C[w]+=f:f==0&&C[w]==0?C[w+1]+=p:g?(C[w]+=f,C[w+1]+=p):C.push(f,p)}function at(C,f,p){if(p.length==0)return;let g=f.length-2>>1;if(g<C.length)C[C.length-1]=C[C.length-1].append(p);else{for(;C.length<g;)C.push(T.empty);C.push(p)}}function ti(C,f,p){let g=C.inserted;for(let w=0,v=0,S=0;S<C.sections.length;){let O=C.sections[S++],L=C.sections[S++];if(L<0)w+=O,v+=O;else{let R=w,H=v,z=T.empty;for(;R+=O,H+=L,L&&g&&(z=z.append(g[S-2>>1])),!(p||S==C.sections.length||C.sections[S+1]<0);)O=C.sections[S++],L=C.sections[S++];f(w,R,v,H,z),w=R,v=H}}}function ii(C,f,p,g=!1){let w=[],v=g?[]:null,S=new Qe(C),O=new Qe(f);for(let L=0,R=0;;)if(S.ins==-1)L+=S.len,S.next();else if(O.ins==-1&&R<L){let H=Math.min(O.len,L-R);O.forward(H),Ve(w,H,-1),R+=H}else if(O.ins>=0&&(S.done||R<L||R==L&&(O.len<S.len||O.len==S.len&&!p))){for(Ve(w,O.ins,-1);L>R&&!S.done&&L+S.len<R+O.len;)L+=S.len,S.next();R+=O.len,O.next()}else if(S.ins>=0){let H=0,z=L+S.len;for(;;)if(O.ins>=0&&R>L&&R+O.len<z)H+=O.ins,R+=O.len,O.next();else if(O.ins==-1&&R<z){let G=Math.min(O.len,z-R);H+=G,O.forward(G),R+=G}else break;Ve(w,H,S.ins),v&&at(v,w,S.text),L=z,S.next()}else{if(S.done&&O.done)return v?Re.createSet(w,v):Xe.create(w);throw new Error("Mismatched change set lengths")}}function $e(C,f,p=!1){let g=[],w=p?[]:null,v=new Qe(C),S=new Qe(f);for(let O=!1;;){if(v.done&&S.done)return w?Re.createSet(g,w):Xe.create(g);if(v.ins==0)Ve(g,v.len,0,O),v.next();else if(S.len==0&&!S.done)Ve(g,0,S.ins,O),w&&at(w,g,S.text),S.next();else{if(v.done||S.done)throw new Error("Mismatched change set lengths");{let L=Math.min(v.len2,S.len),R=g.length;if(v.ins==-1){let H=S.ins==-1?-1:S.off?0:S.ins;Ve(g,L,H,O),w&&H&&at(w,g,S.text)}else S.ins==-1?(Ve(g,v.off?0:v.len,L,O),w&&at(w,g,v.textBit(L))):(Ve(g,v.off?0:v.len,S.off?0:S.ins,O),w&&!S.off&&at(w,g,S.text));O=(v.ins>L||S.ins>=0&&S.len>L)&&(O||g.length>R),v.forward2(L),S.forward(L)}}}}class Qe{constructor(f){this.set=f,this.i=0,this.next()}next(){let{sections:f}=this.set;this.i<f.length?(this.len=f[this.i++],this.ins=f[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:f}=this.set,p=this.i-2>>1;return p>=f.length?T.empty:f[p]}textBit(f){let{inserted:p}=this.set,g=this.i-2>>1;return g>=p.length&&!f?T.empty:p[g].slice(this.off,f==null?void 0:this.off+f)}forward(f){f==this.len?this.next():(this.len-=f,this.off+=f)}forward2(f){this.ins==-1?this.forward(f):f==this.ins?this.next():(this.ins-=f,this.off+=f)}}class de{constructor(f,p,g){this.from=f,this.to=p,this.flags=g}get anchor(){return this.flags&16?this.to:this.from}get head(){return this.flags&16?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&4?-1:this.flags&8?1:0}get bidiLevel(){let f=this.flags&3;return f==3?null:f}get goalColumn(){let f=this.flags>>5;return f==33554431?void 0:f}map(f,p=-1){let g,w;return this.empty?g=w=f.mapPos(this.from,p):(g=f.mapPos(this.from,1),w=f.mapPos(this.to,-1)),g==this.from&&w==this.to?this:new de(g,w,this.flags)}extend(f,p=f){if(f<=this.anchor&&p>=this.anchor)return ge.range(f,p);let g=Math.abs(f-this.anchor)>Math.abs(p-this.anchor)?f:p;return ge.range(this.anchor,g)}eq(f){return this.anchor==f.anchor&&this.head==f.head}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(f){if(!f||typeof f.anchor!="number"||typeof f.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return ge.range(f.anchor,f.head)}static create(f,p,g){return new de(f,p,g)}}class ge{constructor(f,p){this.ranges=f,this.mainIndex=p}map(f,p=-1){return f.empty?this:ge.create(this.ranges.map(g=>g.map(f,p)),this.mainIndex)}eq(f){if(this.ranges.length!=f.ranges.length||this.mainIndex!=f.mainIndex)return!1;for(let p=0;p<this.ranges.length;p++)if(!this.ranges[p].eq(f.ranges[p]))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new ge([this.main],0)}addRange(f,p=!0){return ge.create([f].concat(this.ranges),p?0:this.mainIndex+1)}replaceRange(f,p=this.mainIndex){let g=this.ranges.slice();return g[p]=f,ge.create(g,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(f=>f.toJSON()),main:this.mainIndex}}static fromJSON(f){if(!f||!Array.isArray(f.ranges)||typeof f.main!="number"||f.main>=f.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new ge(f.ranges.map(p=>de.fromJSON(p)),f.main)}static single(f,p=f){return new ge([ge.range(f,p)],0)}static create(f,p=0){if(f.length==0)throw new RangeError("A selection needs at least one range");for(let g=0,w=0;w<f.length;w++){let v=f[w];if(v.empty?v.from<=g:v.from<g)return ge.normalized(f.slice(),p);g=v.to}return new ge(f,p)}static cursor(f,p=0,g,w){return de.create(f,f,(p==0?0:p<0?4:8)|(g==null?3:Math.min(2,g))|(w??33554431)<<5)}static range(f,p,g){let w=(g??33554431)<<5;return p<f?de.create(p,f,16|w|8):de.create(f,p,w|(p>f?4:0))}static normalized(f,p=0){let g=f[p];f.sort((w,v)=>w.from-v.from),p=f.indexOf(g);for(let w=1;w<f.length;w++){let v=f[w],S=f[w-1];if(v.empty?v.from<=S.to:v.from<S.to){let O=S.from,L=Math.max(v.to,S.to);w<=p&&p--,f.splice(--w,2,v.anchor>v.head?ge.range(L,O):ge.range(O,L))}}return new ge(f,p)}}function yn(C,f){for(let p of C.ranges)if(p.to>f)throw new RangeError("Selection points outside of document")}let gi=0;class Ye{constructor(f,p,g,w,v){this.combine=f,this.compareInput=p,this.compare=g,this.isStatic=w,this.extensions=v,this.id=gi++,this.default=f([])}static define(f={}){return new Ye(f.combine||(p=>p),f.compareInput||((p,g)=>p===g),f.compare||(f.combine?(p,g)=>p===g:qe),!!f.static,f.enables)}of(f){return new ni([],this,0,f)}compute(f,p){if(this.isStatic)throw new Error("Can't compute a static facet");return new ni(f,this,1,p)}computeN(f,p){if(this.isStatic)throw new Error("Can't compute a static facet");return new ni(f,this,2,p)}from(f,p){return p||(p=g=>g),this.compute([f],g=>p(g.field(f)))}}function qe(C,f){return C==f||C.length==f.length&&C.every((p,g)=>p===f[g])}class ni{constructor(f,p,g,w){this.dependencies=f,this.facet=p,this.type=g,this.value=w,this.id=gi++}dynamicSlot(f){var p;let g=this.value,w=this.facet.compareInput,v=this.id,S=f[v]>>1,O=this.type==2,L=!1,R=!1,H=[];for(let z of this.dependencies)z=="doc"?L=!0:z=="selection"?R=!0:((p=f[z.id])!==null&&p!==void 0?p:1)&1||H.push(f[z.id]);return{create(z){return z.values[S]=g(z),1},update(z,G){if(L&&G.docChanged||R&&(G.docChanged||G.selection)||yi(z,H)){let j=g(z);if(O?!Pi(j,z.values[S],w):!w(j,z.values[S]))return z.values[S]=j,1}return 0},reconfigure:(z,G)=>{let j=g(z),ve=G.config.address[v];if(ve!=null){let At=yt(G,ve);if(this.dependencies.every(Ee=>Ee instanceof Ye?G.facet(Ee)===z.facet(Ee):Ee instanceof Wt?G.field(Ee,!1)==z.field(Ee,!1):!0)||(O?Pi(j,At,w):w(j,At)))return z.values[S]=At,0}return z.values[S]=j,1}}}}function Pi(C,f,p){if(C.length!=f.length)return!1;for(let g=0;g<C.length;g++)if(!p(C[g],f[g]))return!1;return!0}function yi(C,f){let p=!1;for(let g of f)zt(C,g)&1&&(p=!0);return p}function Gi(C,f,p){let g=p.map(L=>C[L.id]),w=p.map(L=>L.type),v=g.filter(L=>!(L&1)),S=C[f.id]>>1;function O(L){let R=[];for(let H=0;H<g.length;H++){let z=yt(L,g[H]);if(w[H]==2)for(let G of z)R.push(G);else R.push(z)}return f.combine(R)}return{create(L){for(let R of g)zt(L,R);return L.values[S]=O(L),1},update(L,R){if(!yi(L,v))return 0;let H=O(L);return f.compare(H,L.values[S])?0:(L.values[S]=H,1)},reconfigure(L,R){let H=yi(L,g),z=R.config.facets[f.id],G=R.facet(f);if(z&&!H&&qe(p,z))return L.values[S]=G,0;let j=O(L);return f.compare(j,G)?(L.values[S]=G,0):(L.values[S]=j,1)}}}const si=Ye.define({static:!0});class Wt{constructor(f,p,g,w,v){this.id=f,this.createF=p,this.updateF=g,this.compareF=w,this.spec=v,this.provides=void 0}static define(f){let p=new Wt(gi++,f.create,f.update,f.compare||((g,w)=>g===w),f);return f.provide&&(p.provides=f.provide(p)),p}create(f){let p=f.facet(si).find(g=>g.field==this);return(p?.create||this.createF)(f)}slot(f){let p=f[this.id]>>1;return{create:g=>(g.values[p]=this.create(g),1),update:(g,w)=>{let v=g.values[p],S=this.updateF(v,w);return this.compareF(v,S)?0:(g.values[p]=S,1)},reconfigure:(g,w)=>w.config.address[this.id]!=null?(g.values[p]=w.field(this),0):(g.values[p]=this.create(g),1)}}init(f){return[this,si.of({field:this,create:f})]}get extension(){return this}}const Lt={lowest:4,low:3,default:2,high:1,highest:0};function ri(C){return f=>new _i(f,C)}const Ki={highest:ri(Lt.highest),high:ri(Lt.high),default:ri(Lt.default),low:ri(Lt.low),lowest:ri(Lt.lowest)};class _i{constructor(f,p){this.inner=f,this.prec=p}}class U{of(f){return new Ji(this,f)}reconfigure(f){return U.reconfigure.of({compartment:this,extension:f})}get(f){return f.config.compartments.get(this)}}class Ji{constructor(f,p){this.compartment=f,this.inner=p}}class it{constructor(f,p,g,w,v,S){for(this.base=f,this.compartments=p,this.dynamicSlots=g,this.address=w,this.staticValues=v,this.facets=S,this.statusTemplate=[];this.statusTemplate.length<g.length;)this.statusTemplate.push(0)}staticFacet(f){let p=this.address[f.id];return p==null?f.default:this.staticValues[p>>1]}static resolve(f,p,g){let w=[],v=Object.create(null),S=new Map;for(let G of kt(f,p,S))G instanceof Wt?w.push(G):(v[G.facet.id]||(v[G.facet.id]=[])).push(G);let O=Object.create(null),L=[],R=[];for(let G of w)O[G.id]=R.length<<1,R.push(j=>G.slot(j));let H=g?.config.facets;for(let G in v){let j=v[G],ve=j[0].facet,At=H&&H[G]||[];if(j.every(Ee=>Ee.type==0))if(O[ve.id]=L.length<<1|1,qe(At,j))L.push(g.facet(ve));else{let Ee=ve.combine(j.map(en=>en.value));L.push(g&&ve.compare(Ee,g.facet(ve))?g.facet(ve):Ee)}else{for(let Ee of j)Ee.type==0?(O[Ee.id]=L.length<<1|1,L.push(Ee.value)):(O[Ee.id]=R.length<<1,R.push(en=>Ee.dynamicSlot(en)));O[ve.id]=R.length<<1,R.push(Ee=>Gi(Ee,ve,j))}}let z=R.map(G=>G(O));return new it(f,S,z,O,L,v)}}function kt(C,f,p){let g=[[],[],[],[],[]],w=new Map;function v(S,O){let L=w.get(S);if(L!=null){if(L<=O)return;let R=g[L].indexOf(S);R>-1&&g[L].splice(R,1),S instanceof Ji&&p.delete(S.compartment)}if(w.set(S,O),Array.isArray(S))for(let R of S)v(R,O);else if(S instanceof Ji){if(p.has(S.compartment))throw new RangeError("Duplicate use of compartment in extensions");let R=f.get(S.compartment)||S.inner;p.set(S.compartment,R),v(R,O)}else if(S instanceof _i)v(S.inner,S.prec);else if(S instanceof Wt)g[O].push(S),S.provides&&v(S.provides,O);else if(S instanceof ni)g[O].push(S),S.facet.extensions&&v(S.facet.extensions,O);else{let R=S.extension;if(!R)throw new Error(`Unrecognized extension value in extension set (${S}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);v(R,O)}}return v(C,Lt.default),g.reduce((S,O)=>S.concat(O))}function zt(C,f){if(f&1)return 2;let p=f>>1,g=C.status[p];if(g==4)throw new Error("Cyclic dependency between fields and/or facets");if(g&2)return g;C.status[p]=4;let w=C.computeSlot(C,C.config.dynamicSlots[p]);return C.status[p]=2|w}function yt(C,f){return f&1?C.config.staticValues[f>>1]:C.values[f>>1]}const Bi=Ye.define(),Li=Ye.define({combine:C=>C.some(f=>f),static:!0}),Ei=Ye.define({combine:C=>C.length?C[0]:void 0,static:!0}),_t=Ye.define(),bn=Ye.define(),Xi=Ye.define(),$=Ye.define({combine:C=>C.length?C[0]:!1});class vt{constructor(f,p){this.type=f,this.value=p}static define(){return new St}}class St{of(f){return new vt(this,f)}}class Ri{constructor(f){this.map=f}of(f){return new Fe(this,f)}}class Fe{constructor(f,p){this.type=f,this.value=p}map(f){let p=this.type.map(this.value,f);return p===void 0?void 0:p==this.value?this:new Fe(this.type,p)}is(f){return this.type==f}static define(f={}){return new Ri(f.map||(p=>p))}static mapEffects(f,p){if(!f.length)return f;let g=[];for(let w of f){let v=w.map(p);v&&g.push(v)}return g}}Fe.reconfigure=Fe.define(),Fe.appendConfig=Fe.define();class ce{constructor(f,p,g,w,v,S){this.startState=f,this.changes=p,this.selection=g,this.effects=w,this.annotations=v,this.scrollIntoView=S,this._doc=null,this._state=null,g&&yn(g,p.newLength),v.some(O=>O.type==ce.time)||(this.annotations=v.concat(ce.time.of(Date.now())))}static create(f,p,g,w,v,S){return new ce(f,p,g,w,v,S)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(f){for(let p of this.annotations)if(p.type==f)return p.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(f){let p=this.annotation(ce.userEvent);return!!(p&&(p==f||p.length>f.length&&p.slice(0,f.length)==f&&p[f.length]=="."))}}ce.time=vt.define(),ce.userEvent=vt.define(),ce.addToHistory=vt.define(),ce.remote=vt.define();function fe(C,f){let p=[];for(let g=0,w=0;;){let v,S;if(g<C.length&&(w==f.length||f[w]>=C[g]))v=C[g++],S=C[g++];else if(w<f.length)v=f[w++],S=f[w++];else return p;!p.length||p[p.length-1]<v?p.push(v,S):p[p.length-1]<S&&(p[p.length-1]=S)}}function oe(C,f,p){var g;let w,v,S;return p?(w=f.changes,v=Re.empty(f.changes.length),S=C.changes.compose(f.changes)):(w=f.changes.map(C.changes),v=C.changes.mapDesc(f.changes,!0),S=C.changes.compose(w)),{changes:S,selection:f.selection?f.selection.map(v):(g=C.selection)===null||g===void 0?void 0:g.map(w),effects:Fe.mapEffects(C.effects,w).concat(Fe.mapEffects(f.effects,v)),annotations:C.annotations.length?C.annotations.concat(f.annotations):f.annotations,scrollIntoView:C.scrollIntoView||f.scrollIntoView}}function Ze(C,f,p){let g=f.selection,w=ct(f.annotations);return f.userEvent&&(w=w.concat(ce.userEvent.of(f.userEvent))),{changes:f.changes instanceof Re?f.changes:Re.of(f.changes||[],p,C.facet(Ei)),selection:g&&(g instanceof ge?g:ge.single(g.anchor,g.head)),effects:ct(f.effects),annotations:w,scrollIntoView:!!f.scrollIntoView}}function ht(C,f,p){let g=Ze(C,f.length?f[0]:{},C.doc.length);f.length&&f[0].filter===!1&&(p=!1);for(let v=1;v<f.length;v++){f[v].filter===!1&&(p=!1);let S=!!f[v].sequential;g=oe(g,Ze(C,f[v],S?g.changes.newLength:C.doc.length),S)}let w=ce.create(C,g.changes,g.selection,g.effects,g.annotations,g.scrollIntoView);return bt(p?Ge(w):w)}function Ge(C){let f=C.startState,p=!0;for(let w of f.facet(_t)){let v=w(C);if(v===!1){p=!1;break}Array.isArray(v)&&(p=p===!0?v:fe(p,v))}if(p!==!0){let w,v;if(p===!1)v=C.changes.invertedDesc,w=Re.empty(f.doc.length);else{let S=C.changes.filter(p);w=S.changes,v=S.filtered.invertedDesc}C=ce.create(f,w,C.selection&&C.selection.map(v),Fe.mapEffects(C.effects,v),C.annotations,C.scrollIntoView)}let g=f.facet(bn);for(let w=g.length-1;w>=0;w--){let v=g[w](C);v instanceof ce?C=v:Array.isArray(v)&&v.length==1&&v[0]instanceof ce?C=v[0]:C=ht(f,ct(v),!1)}return C}function bt(C){let f=C.startState,p=f.facet(Xi),g=C;for(let w=p.length-1;w>=0;w--){let v=p[w](C);v&&Object.keys(v).length&&(g=oe(C,Ze(f,v,C.changes.newLength),!0))}return g==C?C:ce.create(f,C.changes,C.selection,g.effects,g.annotations,g.scrollIntoView)}const Qi=[];function ct(C){return C==null?Qi:Array.isArray(C)?C:[C]}var be=function(C){return C[C.Word=0]="Word",C[C.Space=1]="Space",C[C.Other=2]="Other",C}(be||(be={}));const q=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let Ii;try{Ii=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function bi(C){if(Ii)return Ii.test(C);for(let f=0;f<C.length;f++){let p=C[f];if(/\w/.test(p)||p>"\x80"&&(p.toUpperCase()!=p.toLowerCase()||q.test(p)))return!0}return!1}function Ni(C){return f=>{if(!/\S/.test(f))return be.Space;if(bi(f))return be.Word;for(let p=0;p<C.length;p++)if(f.indexOf(C[p])>-1)return be.Word;return be.Other}}class ye{constructor(f,p,g,w,v,S){this.config=f,this.doc=p,this.selection=g,this.values=w,this.status=f.statusTemplate.slice(),this.computeSlot=v,S&&(S._state=this);for(let O=0;O<this.config.dynamicSlots.length;O++)zt(this,O<<1);this.computeSlot=null}field(f,p=!0){let g=this.config.address[f.id];if(g==null){if(p)throw new RangeError("Field is not present in this state");return}return zt(this,g),yt(this,g)}update(...f){return ht(this,f,!0)}applyTransaction(f){let p=this.config,{base:g,compartments:w}=p;for(let S of f.effects)S.is(U.reconfigure)?(p&&(w=new Map,p.compartments.forEach((O,L)=>w.set(L,O)),p=null),w.set(S.value.compartment,S.value.extension)):S.is(Fe.reconfigure)?(p=null,g=S.value):S.is(Fe.appendConfig)&&(p=null,g=ct(g).concat(S.value));let v;p?v=f.startState.values.slice():(p=it.resolve(g,w,this),v=new ye(p,this.doc,this.selection,p.dynamicSlots.map(()=>null),(O,L)=>L.reconfigure(O,this),null).values),new ye(p,f.newDoc,f.newSelection,v,(S,O)=>O.update(S,f),f)}replaceSelection(f){return typeof f=="string"&&(f=this.toText(f)),this.changeByRange(p=>({changes:{from:p.from,to:p.to,insert:f},range:ge.cursor(p.from+f.length)}))}changeByRange(f){let p=this.selection,g=f(p.ranges[0]),w=this.changes(g.changes),v=[g.range],S=ct(g.effects);for(let O=1;O<p.ranges.length;O++){let L=f(p.ranges[O]),R=this.changes(L.changes),H=R.map(w);for(let G=0;G<O;G++)v[G]=v[G].map(H);let z=w.mapDesc(R,!0);v.push(L.range.map(z)),w=w.compose(H),S=Fe.mapEffects(S,H).concat(Fe.mapEffects(ct(L.effects),z))}return{changes:w,selection:ge.create(v,p.mainIndex),effects:S}}changes(f=[]){return f instanceof Re?f:Re.of(f,this.doc.length,this.facet(ye.lineSeparator))}toText(f){return T.of(f.split(this.facet(ye.lineSeparator)||Bt))}sliceDoc(f=0,p=this.doc.length){return this.doc.sliceString(f,p,this.lineBreak)}facet(f){let p=this.config.address[f.id];return p==null?f.default:(zt(this,p),yt(this,p))}toJSON(f){let p={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(f)for(let g in f){let w=f[g];w instanceof Wt&&(p[g]=w.spec.toJSON(this.field(f[g]),this))}return p}static fromJSON(f,p={},g){if(!f||typeof f.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let w=[];if(g)for(let v in g){let S=g[v],O=f[v];w.push(S.init(L=>S.spec.fromJSON(O,L)))}return ye.create({doc:f.doc,selection:ge.fromJSON(f.selection),extensions:p.extensions?w.concat([p.extensions]):w})}static create(f={}){let p=it.resolve(f.extensions||[],new Map),g=f.doc instanceof T?f.doc:T.of((f.doc||"").split(p.staticFacet(ye.lineSeparator)||Bt)),w=f.selection?f.selection instanceof ge?f.selection:ge.single(f.selection.anchor,f.selection.head):ge.single(0);return yn(w,g.length),p.staticFacet(Li)||(w=w.asSingle()),new ye(p,g,w,p.dynamicSlots.map(()=>null),(v,S)=>S.create(v),null)}get tabSize(){return this.facet(ye.tabSize)}get lineBreak(){return this.facet(ye.lineSeparator)||`
`}get readOnly(){return this.facet($)}phrase(f,...p){for(let g of this.facet(ye.phrases))if(Object.prototype.hasOwnProperty.call(g,f)){f=g[f];break}return p.length&&(f=f.replace(/\$(\$|\d*)/g,(g,w)=>{if(w=="$")return"$";let v=+(w||1);return v>p.length?g:p[v-1]})),f}languageDataAt(f,p,g=-1){let w=[];for(let v of this.facet(Bi))for(let S of v(this,p,g))Object.prototype.hasOwnProperty.call(S,f)&&w.push(S[f]);return w}charCategorizer(f){return Ni(this.languageDataAt("wordChars",f).join(""))}wordAt(f){let{text:p,from:g,length:w}=this.doc.lineAt(f),v=this.charCategorizer(f),S=f-g,O=f-g;for(;S>0;){let L=Ae(p,S,!1);if(v(p.slice(L,S))!=be.Word)break;S=L}for(;O<w;){let L=Ae(p,O);if(v(p.slice(O,L))!=be.Word)break;O=L}return S==O?null:ge.range(S+g,O+g)}}ye.allowMultipleSelections=Li,ye.tabSize=Ye.define({combine:C=>C.length?C[0]:4}),ye.lineSeparator=Ei,ye.readOnly=$,ye.phrases=Ye.define({compare(C,f){let p=Object.keys(C),g=Object.keys(f);return p.length==g.length&&p.every(w=>C[w]==f[w])}}),ye.languageData=Bi,ye.changeFilter=_t,ye.transactionFilter=bn,ye.transactionExtender=Xi,U.reconfigure=Fe.define();function Yi(C,f,p={}){let g={};for(let w of C)for(let v of Object.keys(w)){let S=w[v],O=g[v];if(O===void 0)g[v]=S;else if(!(O===S||S===void 0))if(Object.hasOwnProperty.call(p,v))g[v]=p[v](O,S);else throw new Error("Config merge conflict for field "+v)}for(let w in f)g[w]===void 0&&(g[w]=f[w]);return g}class Ue{eq(f){return this==f}range(f,p=f){return Jt.create(f,p,this)}}Ue.prototype.startSide=Ue.prototype.endSide=0,Ue.prototype.point=!1,Ue.prototype.mapMode=me.TrackDel;class Jt{constructor(f,p,g){this.from=f,this.to=p,this.value=g}static create(f,p,g){return new Jt(f,p,g)}}function Xt(C,f){return C.from-f.from||C.value.startSide-f.value.startSide}class Le{constructor(f,p,g,w){this.from=f,this.to=p,this.value=g,this.maxPoint=w}get length(){return this.to[this.to.length-1]}findIndex(f,p,g,w=0){let v=g?this.to:this.from;for(let S=w,O=v.length;;){if(S==O)return S;let L=S+O>>1,R=v[L]-f||(g?this.value[L].endSide:this.value[L].startSide)-p;if(L==S)return R>=0?S:O;R>=0?O=L:S=L+1}}between(f,p,g,w){for(let v=this.findIndex(p,-1e9,!0),S=this.findIndex(g,1e9,!1,v);v<S;v++)if(w(this.from[v]+f,this.to[v]+f,this.value[v])===!1)return!1}map(f,p){let g=[],w=[],v=[],S=-1,O=-1;for(let L=0;L<this.value.length;L++){let R=this.value[L],H=this.from[L]+f,z=this.to[L]+f,G,j;if(H==z){let ve=p.mapPos(H,R.startSide,R.mapMode);if(ve==null||(G=j=ve,R.startSide!=R.endSide&&(j=p.mapPos(H,R.endSide),j<G)))continue}else if(G=p.mapPos(H,R.startSide),j=p.mapPos(z,R.endSide),G>j||G==j&&R.startSide>0&&R.endSide<=0)continue;(j-G||R.endSide-R.startSide)<0||(S<0&&(S=G),R.point&&(O=Math.max(O,j-G)),g.push(R),w.push(G-S),v.push(j-S))}return{mapped:g.length?new Le(w,v,g,O):null,pos:S}}}class nt{constructor(f,p,g,w){this.chunkPos=f,this.chunk=p,this.nextLayer=g,this.maxPoint=w}static create(f,p,g,w){return new nt(f,p,g,w)}get length(){let f=this.chunk.length-1;return f<0?0:Math.max(this.chunkEnd(f),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let f=this.nextLayer.size;for(let p of this.chunk)f+=p.value.length;return f}chunkEnd(f){return this.chunkPos[f]+this.chunk[f].length}update(f){let{add:p=[],sort:g=!1,filterFrom:w=0,filterTo:v=this.length}=f,S=f.filter;if(p.length==0&&!S)return this;if(g&&(p=p.slice().sort(Xt)),this.isEmpty)return p.length?nt.of(p):this;let O=new oi(this,null,-1).goto(0),L=0,R=[],H=new wi;for(;O.value||L<p.length;)if(L<p.length&&(O.from-p[L].from||O.startSide-p[L].value.startSide)>=0){let z=p[L++];H.addInner(z.from,z.to,z.value)||R.push(z)}else O.rangeIndex==1&&O.chunkIndex<this.chunk.length&&(L==p.length||this.chunkEnd(O.chunkIndex)<p[L].from)&&(!S||w>this.chunkEnd(O.chunkIndex)||v<this.chunkPos[O.chunkIndex])&&H.addChunk(this.chunkPos[O.chunkIndex],this.chunk[O.chunkIndex])?O.nextChunk():((!S||w>O.to||v<O.from||S(O.from,O.to,O.value))&&(H.addInner(O.from,O.to,O.value)||R.push(Jt.create(O.from,O.to,O.value))),O.next());return H.finishInner(this.nextLayer.isEmpty&&!R.length?nt.empty:this.nextLayer.update({add:R,filter:S,filterFrom:w,filterTo:v}))}map(f){if(f.empty||this.isEmpty)return this;let p=[],g=[],w=-1;for(let S=0;S<this.chunk.length;S++){let O=this.chunkPos[S],L=this.chunk[S],R=f.touchesRange(O,O+L.length);if(R===!1)w=Math.max(w,L.maxPoint),p.push(L),g.push(f.mapPos(O));else if(R===!0){let{mapped:H,pos:z}=L.map(O,f);H&&(w=Math.max(w,H.maxPoint),p.push(H),g.push(z))}}let v=this.nextLayer.map(f);return p.length==0?v:new nt(g,p,v||nt.empty,w)}between(f,p,g){if(!this.isEmpty){for(let w=0;w<this.chunk.length;w++){let v=this.chunkPos[w],S=this.chunk[w];if(p>=v&&f<=v+S.length&&S.between(v,f-v,p-v,g)===!1)return}this.nextLayer.between(f,p,g)}}iter(f=0){return Rt.from([this]).goto(f)}get isEmpty(){return this.nextLayer==this}static iter(f,p=0){return Rt.from(f).goto(p)}static compare(f,p,g,w,v=-1){let S=f.filter(z=>z.maxPoint>0||!z.isEmpty&&z.maxPoint>=v),O=p.filter(z=>z.maxPoint>0||!z.isEmpty&&z.maxPoint>=v),L=Et(S,O,g),R=new Ie(S,L,v),H=new Ie(O,L,v);g.iterGaps((z,G,j)=>It(R,z,H,G,j,w)),g.empty&&g.length==0&&It(R,0,H,0,0,w)}static eq(f,p,g=0,w){w==null&&(w=1e9);let v=f.filter(H=>!H.isEmpty&&p.indexOf(H)<0),S=p.filter(H=>!H.isEmpty&&f.indexOf(H)<0);if(v.length!=S.length)return!1;if(!v.length)return!0;let O=Et(v,S),L=new Ie(v,O,0).goto(g),R=new Ie(S,O,0).goto(g);for(;;){if(L.to!=R.to||!xi(L.active,R.active)||L.point&&(!R.point||!L.point.eq(R.point)))return!1;if(L.to>w)return!0;L.next(),R.next()}}static spans(f,p,g,w,v=-1){let S=new Ie(f,null,v).goto(p),O=p,L=S.openStart;for(;;){let R=Math.min(S.to,g);if(S.point?(w.point(O,R,S.point,S.activeForPoint(S.to),L,S.pointRank),L=S.openEnd(R)+(S.to>R?1:0)):R>O&&(w.span(O,R,S.active,L),L=S.openEnd(R)),S.to>g)break;O=S.to,S.next()}return L}static of(f,p=!1){let g=new wi;for(let w of f instanceof Jt?[f]:p?Zi(f):f)g.add(w.from,w.to,w.value);return g.finish()}}nt.empty=new nt([],[],null,-1);function Zi(C){if(C.length>1)for(let f=C[0],p=1;p<C.length;p++){let g=C[p];if(Xt(f,g)>0)return C.slice().sort(Xt);f=g}return C}nt.empty.nextLayer=nt.empty;class wi{constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}finishChunk(f){this.chunks.push(new Le(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,f&&(this.from=[],this.to=[],this.value=[])}add(f,p,g){this.addInner(f,p,g)||(this.nextLayer||(this.nextLayer=new wi)).add(f,p,g)}addInner(f,p,g){let w=f-this.lastTo||g.startSide-this.last.endSide;if(w<=0&&(f-this.lastFrom||g.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return w<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=f),this.from.push(f-this.chunkStart),this.to.push(p-this.chunkStart),this.last=g,this.lastFrom=f,this.lastTo=p,this.value.push(g),g.point&&(this.maxPoint=Math.max(this.maxPoint,p-f)),!0)}addChunk(f,p){if((f-this.lastTo||p.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,p.maxPoint),this.chunks.push(p),this.chunkPos.push(f);let g=p.value.length-1;return this.last=p.value[g],this.lastFrom=p.from[g]+f,this.lastTo=p.to[g]+f,!0}finish(){return this.finishInner(nt.empty)}finishInner(f){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return f;let p=nt.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(f):f,this.setMaxPoint);return this.from=null,p}}function Et(C,f,p){let g=new Map;for(let v of C)for(let S=0;S<v.chunk.length;S++)v.chunk[S].maxPoint<=0&&g.set(v.chunk[S],v.chunkPos[S]);let w=new Set;for(let v of f)for(let S=0;S<v.chunk.length;S++){let O=g.get(v.chunk[S]);O!=null&&(p?p.mapPos(O):O)==v.chunkPos[S]&&!p?.touchesRange(O,O+v.chunk[S].length)&&w.add(v.chunk[S])}return w}class oi{constructor(f,p,g,w=0){this.layer=f,this.skip=p,this.minPoint=g,this.rank=w}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(f,p=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(f,p,!1),this}gotoInner(f,p,g){for(;this.chunkIndex<this.layer.chunk.length;){let w=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(w)||this.layer.chunkEnd(this.chunkIndex)<f||w.maxPoint<this.minPoint))break;this.chunkIndex++,g=!1}if(this.chunkIndex<this.layer.chunk.length){let w=this.layer.chunk[this.chunkIndex].findIndex(f-this.layer.chunkPos[this.chunkIndex],p,!0);(!g||this.rangeIndex<w)&&this.setRangeIndex(w)}this.next()}forward(f,p){(this.to-f||this.endSide-p)<0&&this.gotoInner(f,p,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let f=this.layer.chunkPos[this.chunkIndex],p=this.layer.chunk[this.chunkIndex],g=f+p.from[this.rangeIndex];if(this.from=g,this.to=f+p.to[this.rangeIndex],this.value=p.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(f){if(f==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=f}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(f){return this.from-f.from||this.startSide-f.startSide||this.rank-f.rank||this.to-f.to||this.endSide-f.endSide}}class Rt{constructor(f){this.heap=f}static from(f,p=null,g=-1){let w=[];for(let v=0;v<f.length;v++)for(let S=f[v];!S.isEmpty;S=S.nextLayer)S.maxPoint>=g&&w.push(new oi(S,p,g,v));return w.length==1?w[0]:new Rt(w)}get startSide(){return this.value?this.value.startSide:0}goto(f,p=-1e9){for(let g of this.heap)g.goto(f,p);for(let g=this.heap.length>>1;g>=0;g--)ft(this.heap,g);return this.next(),this}forward(f,p){for(let g of this.heap)g.forward(f,p);for(let g=this.heap.length>>1;g>=0;g--)ft(this.heap,g);(this.to-f||this.value.endSide-p)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let f=this.heap[0];this.from=f.from,this.to=f.to,this.value=f.value,this.rank=f.rank,f.value&&f.next(),ft(this.heap,0)}}}function ft(C,f){for(let p=C[f];;){let g=(f<<1)+1;if(g>=C.length)break;let w=C[g];if(g+1<C.length&&w.compare(C[g+1])>=0&&(w=C[g+1],g++),p.compare(w)<0)break;C[g]=p,C[f]=w,f=g}}class Ie{constructor(f,p,g){this.minPoint=g,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=Rt.from(f,p,g)}goto(f,p=-1e9){return this.cursor.goto(f,p),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=f,this.endSide=p,this.openStart=-1,this.next(),this}forward(f,p){for(;this.minActive>-1&&(this.activeTo[this.minActive]-f||this.active[this.minActive].endSide-p)<0;)this.removeActive(this.minActive);this.cursor.forward(f,p)}removeActive(f){jt(this.active,f),jt(this.activeTo,f),jt(this.activeRank,f),this.minActive=Ct(this.active,this.activeTo)}addActive(f){let p=0,{value:g,to:w,rank:v}=this.cursor;for(;p<this.activeRank.length&&this.activeRank[p]<=v;)p++;Nt(this.active,p,g),Nt(this.activeTo,p,w),Nt(this.activeRank,p,v),f&&Nt(f,p,this.cursor.from),this.minActive=Ct(this.active,this.activeTo)}next(){let f=this.to,p=this.point;this.point=null;let g=this.openStart<0?[]:null,w=0;for(;;){let v=this.minActive;if(v>-1&&(this.activeTo[v]-this.cursor.from||this.active[v].endSide-this.cursor.startSide)<0){if(this.activeTo[v]>f){this.to=this.activeTo[v],this.endSide=this.active[v].endSide;break}this.removeActive(v),g&&jt(g,v)}else if(this.cursor.value)if(this.cursor.from>f){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let S=this.cursor.value;if(!S.point)this.addActive(g),this.cursor.next();else if(p&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=S,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=S.endSide,this.cursor.from<f&&(w=1),this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(g){let v=0;for(;v<g.length&&g[v]<f;)v++;this.openStart=v+w}}activeForPoint(f){if(!this.active.length)return this.active;let p=[];for(let g=this.active.length-1;g>=0&&!(this.activeRank[g]<this.pointRank);g--)(this.activeTo[g]>f||this.activeTo[g]==f&&this.active[g].endSide>=this.point.endSide)&&p.push(this.active[g]);return p.reverse()}openEnd(f){let p=0;for(let g=this.activeTo.length-1;g>=0&&this.activeTo[g]>f;g--)p++;return p}}function It(C,f,p,g,w,v){C.goto(f),p.goto(g);let S=g+w,O=g,L=g-f;for(;;){let R=C.to+L-p.to||C.endSide-p.endSide,H=R<0?C.to+L:p.to,z=Math.min(H,S);if(C.point||p.point?C.point&&p.point&&(C.point==p.point||C.point.eq(p.point))&&xi(C.activeForPoint(C.to+L),p.activeForPoint(p.to))||v.comparePoint(O,z,C.point,p.point):z>O&&!xi(C.active,p.active)&&v.compareRange(O,z,C.active,p.active),H>S)break;O=H,R<=0&&C.next(),R>=0&&p.next()}}function xi(C,f){if(C.length!=f.length)return!1;for(let p=0;p<C.length;p++)if(C[p]!=f[p]&&!C[p].eq(f[p]))return!1;return!0}function jt(C,f){for(let p=f,g=C.length-1;p<g;p++)C[p]=C[p+1];C.pop()}function Nt(C,f,p){for(let g=C.length-1;g>=f;g--)C[g+1]=C[g];C[f]=p}function Ct(C,f){let p=-1,g=1e9;for(let w=0;w<f.length;w++)(f[w]-g||C[w].endSide-C[p].endSide)<0&&(p=w,g=f[w]);return p}function Jn(C,f,p=C.length){let g=0;for(let w=0;w<p;)C.charCodeAt(w)==9?(g+=f-g%f,w++):(g++,w=Ae(C,w));return g}function li(C,f,p,g){for(let w=0,v=0;;){if(v>=f)return w;if(w==C.length)break;v+=C.charCodeAt(w)==9?p-v%p:1,w=Ae(C,w)}return g===!0?-1:C.length}},75533:function(lo,Ui,Ht){Ht.d(Ui,{p:function(){return oe},Nm:function(){return p},tk:function(){return xe},SJ:function(){return ci},lg:function(){return Ie},l9:function(){return ce},S2:function(){return Uo},Uw:function(){return br},qr:function(){return En},Sd:function(){return Vr},gB:function(){return Jo},v5:function(){return Fr},ZO:function(){return Dr},HQ:function(){return ol},AE:function(){return Mr},bF:function(){return _o},$f:function(){return gr},Eu:function(){return qr},OO:function(){return Et},Zs:function(){return Nl},$1:function(){return Hi},mH:function(){return As},hJ:function(){return ks}});for(var T=Ht(78120),B=Ht(28699),Oe={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Kt={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},ze=typeof navigator<"u"&&/Mac/.test(navigator.platform),te=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),Te=0;Te<10;Te++)Oe[48+Te]=Oe[96+Te]=String(Te);for(var Te=1;Te<=24;Te++)Oe[Te+111]="F"+Te;for(var Te=65;Te<=90;Te++)Oe[Te]=String.fromCharCode(Te+32),Kt[Te]=String.fromCharCode(Te);for(var ei in Oe)Kt.hasOwnProperty(ei)||(Kt[ei]=Oe[ei]);function ie(a){var t=ze&&a.metaKey&&a.shiftKey&&!a.ctrlKey&&!a.altKey||te&&a.shiftKey&&a.key&&a.key.length==1||a.key=="Unidentified",n=!t&&a.key||(a.shiftKey?Kt:Oe)[a.keyCode]||a.key||"Unidentified";return n=="Esc"&&(n="Escape"),n=="Del"&&(n="Delete"),n=="Left"&&(n="ArrowLeft"),n=="Up"&&(n="ArrowUp"),n=="Right"&&(n="ArrowRight"),n=="Down"&&(n="ArrowDown"),n}function Pe(a){let t;return a.nodeType==11?t=a.getSelection?a:a.ownerDocument:t=a,t.getSelection()}function he(a,t){return t?a==t||a.contains(t.nodeType!=1?t.parentNode:t):!1}function je(){let a=document.activeElement;for(;a&&a.shadowRoot;)a=a.shadowRoot.activeElement;return a}function Z(a,t){if(!t.anchorNode)return!1;try{return he(a,t.anchorNode)}catch{return!1}}function Y(a){return a.nodeType==3?Ve(a,0,a.nodeValue.length).getClientRects():a.nodeType==1?a.getClientRects():[]}function Ae(a,t,n,o){return n?Pt(a,t,n,o,-1)||Pt(a,t,n,o,1):!1}function ke(a){for(var t=0;;t++)if(a=a.previousSibling,!a)return t}function Pt(a,t,n,o,h){for(;;){if(a==n&&t==o)return!0;if(t==(h<0?0:mt(a))){if(a.nodeName=="DIV")return!1;let u=a.parentNode;if(!u||u.nodeType!=1)return!1;t=ke(a)+(h<0?0:1),a=u}else if(a.nodeType==1){if(a=a.childNodes[t+(h<0?-1:0)],a.nodeType==1&&a.contentEditable=="false")return!1;t=h<0?mt(a):0}else return!1}}function mt(a){return a.nodeType==3?a.nodeValue.length:a.childNodes.length}const tt={left:0,right:0,top:0,bottom:0};function Be(a,t){let n=t?a.left:a.right;return{left:n,right:n,top:a.top,bottom:a.bottom}}function gt(a){return{left:0,right:a.innerWidth,top:0,bottom:a.innerHeight}}function st(a,t,n,o,h,u,m,b){let x=a.ownerDocument,A=x.defaultView;for(let D=a;D;)if(D.nodeType==1){let P,V=D==x.body;if(V)P=gt(A);else{if(D.scrollHeight<=D.clientHeight&&D.scrollWidth<=D.clientWidth){D=D.parentNode;continue}let _=D.getBoundingClientRect();P={left:_.left,right:_.left+D.clientWidth,top:_.top,bottom:_.top+D.clientHeight}}let N=0,F=0;if(h=="nearest")t.top<P.top?(F=-(P.top-t.top+m),n>0&&t.bottom>P.bottom+F&&(F=t.bottom-P.bottom+F+m)):t.bottom>P.bottom&&(F=t.bottom-P.bottom+m,n<0&&t.top-F<P.top&&(F=-(P.top+F-t.top+m)));else{let _=t.bottom-t.top,J=P.bottom-P.top;F=(h=="center"&&_<=J?t.top+_/2-J/2:h=="start"||h=="center"&&n<0?t.top-m:t.bottom-J+m)-P.top}if(o=="nearest"?t.left<P.left?(N=-(P.left-t.left+u),n>0&&t.right>P.right+N&&(N=t.right-P.right+N+u)):t.right>P.right&&(N=t.right-P.right+u,n<0&&t.left<P.left+N&&(N=-(P.left+N-t.left+u))):N=(o=="center"?t.left+(t.right-t.left)/2-(P.right-P.left)/2:o=="start"==b?t.left-u:t.right-(P.right-P.left)+u)-P.left,N||F)if(V)A.scrollBy(N,F);else{if(F){let _=D.scrollTop;D.scrollTop+=F,F=D.scrollTop-_}if(N){let _=D.scrollLeft;D.scrollLeft+=N,N=D.scrollLeft-_}t={left:t.left-N,top:t.top-F,right:t.right-N,bottom:t.bottom-F}}if(V)break;D=D.assignedSlot||D.parentNode,o=h="nearest"}else if(D.nodeType==11)D=D.host;else break}class Bt{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){this.set(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)}set(t,n,o,h){this.anchorNode=t,this.anchorOffset=n,this.focusNode=o,this.focusOffset=h}}let me=null;function Xe(a){if(a.setActive)return a.setActive();if(me)return a.focus(me);let t=[];for(let n=a;n&&(t.push(n,n.scrollTop,n.scrollLeft),n!=n.ownerDocument);n=n.parentNode);if(a.focus(me==null?{get preventScroll(){return me={preventScroll:!0},!0}}:void 0),!me){me=!1;for(let n=0;n<t.length;){let o=t[n++],h=t[n++],u=t[n++];o.scrollTop!=h&&(o.scrollTop=h),o.scrollLeft!=u&&(o.scrollLeft=u)}}}let Re;function Ve(a,t,n=t){let o=Re||(Re=document.createRange());return o.setEnd(a,n),o.setStart(a,t),o}function at(a,t,n){let o={key:t,code:t,keyCode:n,which:n,cancelable:!0},h=new KeyboardEvent("keydown",o);h.synthetic=!0,a.dispatchEvent(h);let u=new KeyboardEvent("keyup",o);return u.synthetic=!0,a.dispatchEvent(u),h.defaultPrevented||u.defaultPrevented}function ti(a){for(;a;){if(a&&(a.nodeType==9||a.nodeType==11&&a.host))return a;a=a.assignedSlot||a.parentNode}return null}function ii(a){for(;a.attributes.length;)a.removeAttributeNode(a.attributes[0])}class $e{constructor(t,n,o=!0){this.node=t,this.offset=n,this.precise=o}static before(t,n){return new $e(t.parentNode,ke(t),n)}static after(t,n){return new $e(t.parentNode,ke(t)+1,n)}}const Qe=[];class de{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let n=this.posAtStart;for(let o of this.children){if(o==t)return n;n+=o.length+o.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}coordsAt(t,n){return null}sync(t){if(this.dirty&2){let n=this.dom,o=null,h;for(let u of this.children){if(u.dirty){if(!u.dom&&(h=o?o.nextSibling:n.firstChild)){let m=de.get(h);(!m||!m.parent&&m.constructor==u.constructor)&&u.reuseDOM(h)}u.sync(t),u.dirty=0}if(h=o?o.nextSibling:n.firstChild,t&&!t.written&&t.node==n&&h!=u.dom&&(t.written=!0),u.dom.parentNode==n)for(;h&&h!=u.dom;)h=ge(h);else n.insertBefore(u.dom,h);o=u.dom}for(h=o?o.nextSibling:n.firstChild,h&&t&&t.node==n&&(t.written=!0);h;)h=ge(h)}else if(this.dirty&1)for(let n of this.children)n.dirty&&(n.sync(t),n.dirty=0)}reuseDOM(t){}localPosFromDOM(t,n){let o;if(t==this.dom)o=this.dom.childNodes[n];else{let h=mt(t)==0?0:n==0?-1:1;for(;;){let u=t.parentNode;if(u==this.dom)break;h==0&&u.firstChild!=u.lastChild&&(t==u.firstChild?h=-1:h=1),t=u}h<0?o=t:o=t.nextSibling}if(o==this.dom.firstChild)return 0;for(;o&&!de.get(o);)o=o.nextSibling;if(!o)return this.length;for(let h=0,u=0;;h++){let m=this.children[h];if(m.dom==o)return u;u+=m.length+m.breakAfter}}domBoundsAround(t,n,o=0){let h=-1,u=-1,m=-1,b=-1;for(let x=0,A=o,D=o;x<this.children.length;x++){let P=this.children[x],V=A+P.length;if(A<t&&V>n)return P.domBoundsAround(t,n,A);if(V>=t&&h==-1&&(h=x,u=A),A>n&&P.dom.parentNode==this.dom){m=x,b=D;break}D=V,A=V+P.breakAfter}return{from:u,to:b<0?o+this.length:b,startDOM:(h?this.children[h-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:m<this.children.length&&m>=0?this.children[m].dom:null}}markDirty(t=!1){this.dirty|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let n=this.parent;n;n=n.parent){if(t&&(n.dirty|=2),n.dirty&1)return;n.dirty|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.dirty&&this.markParentsDirty(!0))}setDOM(t){this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this}get rootView(){for(let t=this;;){let n=t.parent;if(!n)return t;t=n}}replaceChildren(t,n,o=Qe){this.markDirty();for(let h=t;h<n;h++){let u=this.children[h];u.parent==this&&u.destroy()}this.children.splice(t,n-t,...o);for(let h=0;h<o.length;h++)o[h].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new yn(this.children,t,this.children.length)}childPos(t,n=1){return this.childCursor().findPos(t,n)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+(t=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}merge(t,n,o,h,u,m){return!1}become(t){return!1}getSide(){return 0}destroy(){this.parent=null}}de.prototype.breakAfter=0;function ge(a){let t=a.nextSibling;return a.parentNode.removeChild(a),t}class yn{constructor(t,n,o){this.children=t,this.pos=n,this.i=o,this.off=0}findPos(t,n=1){for(;;){if(t>this.pos||t==this.pos&&(n>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let o=this.children[--this.i];this.pos-=o.length+o.breakAfter}}}function gi(a,t,n,o,h,u,m,b,x){let{children:A}=a,D=A.length?A[t]:null,P=u.length?u[u.length-1]:null,V=P?P.breakAfter:m;if(!(t==o&&D&&!m&&!V&&u.length<2&&D.merge(n,h,u.length?P:null,n==0,b,x))){if(o<A.length){let N=A[o];N&&h<N.length?(t==o&&(N=N.split(h),h=0),!V&&P&&N.merge(0,h,P,!0,0,x)?u[u.length-1]=N:(h&&N.merge(0,h,null,!1,0,x),u.push(N))):N?.breakAfter&&(P?P.breakAfter=1:m=1),o++}for(D&&(D.breakAfter=m,n>0&&(!m&&u.length&&D.merge(n,D.length,u[0],!1,b,0)?D.breakAfter=u.shift().breakAfter:(n<D.length||D.children.length&&D.children[D.children.length-1].length==0)&&D.merge(n,D.length,null,!1,b,0),t++));t<o&&u.length;)if(A[o-1].become(u[u.length-1]))o--,u.pop(),x=u.length?0:b;else if(A[t].become(u[0]))t++,u.shift(),b=u.length?0:x;else break;!u.length&&t&&o<A.length&&!A[t-1].breakAfter&&A[o].merge(0,0,A[t-1],!1,b,x)&&t--,(t<o||u.length)&&a.replaceChildren(t,o,u)}}function Ye(a,t,n,o,h,u){let m=a.childCursor(),{i:b,off:x}=m.findPos(n,1),{i:A,off:D}=m.findPos(t,-1),P=t-n;for(let V of o)P+=V.length;a.length+=P,gi(a,A,D,b,x,o,0,h,u)}let qe=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},ni=typeof document<"u"?document:{documentElement:{style:{}}};const Pi=/Edge\/(\d+)/.exec(qe.userAgent),yi=/MSIE \d/.test(qe.userAgent),Gi=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(qe.userAgent),si=!!(yi||Gi||Pi),Wt=!si&&/gecko\/(\d+)/i.test(qe.userAgent),Lt=!si&&/Chrome\/(\d+)/.exec(qe.userAgent),ri="webkitFontSmoothing"in ni.documentElement.style,Ki=!si&&/Apple Computer/.test(qe.vendor),_i=Ki&&(/Mobile\/\w+/.test(qe.userAgent)||qe.maxTouchPoints>2);var U={mac:_i||/Mac/.test(qe.platform),windows:/Win/.test(qe.platform),linux:/Linux|X11/.test(qe.platform),ie:si,ie_version:yi?ni.documentMode||6:Gi?+Gi[1]:Pi?+Pi[1]:0,gecko:Wt,gecko_version:Wt?+(/Firefox\/(\d+)/.exec(qe.userAgent)||[0,0])[1]:0,chrome:!!Lt,chrome_version:Lt?+Lt[1]:0,ios:_i,android:/Android\b/.test(qe.userAgent),webkit:ri,safari:Ki,webkit_version:ri?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:ni.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};const Ji=256;class it extends de{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){t.nodeType==3&&this.createDOM(t)}merge(t,n,o){return o&&(!(o instanceof it)||this.length-(n-t)+o.length>Ji)?!1:(this.text=this.text.slice(0,t)+(o?o.text:"")+this.text.slice(n),this.markDirty(),!0)}split(t){let n=new it(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),n}localPosFromDOM(t,n){return t==this.dom?n:n?this.text.length:0}domAtPos(t){return new $e(this.dom,t)}domBoundsAround(t,n,o){return{from:o,to:o+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,n){return zt(this.dom,t,n)}}class kt extends de{constructor(t,n=[],o=0){super(),this.mark=t,this.children=n,this.length=o;for(let h of n)h.setParent(this)}setAttrs(t){if(ii(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let n in this.mark.attrs)t.setAttribute(n,this.mark.attrs[n]);return t}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.dirty|=6)}sync(t){this.dom?this.dirty&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t)}merge(t,n,o,h,u,m){return o&&(!(o instanceof kt&&o.mark.eq(this.mark))||t&&u<=0||n<this.length&&m<=0)?!1:(Ye(this,t,n,o?o.children:[],u-1,m-1),this.markDirty(),!0)}split(t){let n=[],o=0,h=-1,u=0;for(let b of this.children){let x=o+b.length;x>t&&n.push(o<t?b.split(t-o):b),h<0&&o>=t&&(h=u),o=x,u++}let m=this.length-t;return this.length=t,h>-1&&(this.children.length=h,this.markDirty()),new kt(this.mark,n,m)}domAtPos(t){return Xi(this.dom,this.children,t)}coordsAt(t,n){return vt(this,t,n)}}function zt(a,t,n){let o=a.nodeValue.length;t>o&&(t=o);let h=t,u=t,m=0;t==0&&n<0||t==o&&n>=0?U.chrome||U.gecko||(t?(h--,m=1):u<o&&(u++,m=-1)):n<0?h--:u<o&&u++;let b=Ve(a,h,u).getClientRects();if(!b.length)return tt;let x=b[(m?m<0:n>=0)?0:b.length-1];return U.safari&&!m&&x.width==0&&(x=Array.prototype.find.call(b,A=>A.width)||x),m?Be(x,m<0):x||null}class yt extends de{constructor(t,n,o){super(),this.widget=t,this.length=n,this.side=o,this.prevWidget=null}static create(t,n,o){return new(t.customView||yt)(t,n,o)}split(t){let n=yt.create(this.widget,this.length-t,this.side);return this.length-=t,n}sync(){(!this.dom||!this.widget.updateDOM(this.dom))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(t,n,o,h,u,m){return o&&(!(o instanceof yt)||!this.widget.compare(o.widget)||t>0&&u<=0||n<this.length&&m<=0)?!1:(this.length=t+(o?o.length:0)+(this.length-n),!0)}become(t){return t.length==this.length&&t instanceof yt&&t.side==this.side&&this.widget.constructor==t.widget.constructor?(this.widget.eq(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,!0):!1}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(this.length==0)return T.xv.empty;let t=this;for(;t.parent;)t=t.parent;let n=t.editorView,o=n&&n.state.doc,h=this.posAtStart;return o?o.slice(h,h+this.length):T.xv.empty}domAtPos(t){return t==0?$e.before(this.dom):$e.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,n){let o=this.dom.getClientRects(),h=null;if(!o.length)return tt;for(let u=t>0?o.length-1:0;h=o[u],!(t>0?u==0:u==o.length-1||h.top<h.bottom);u+=t>0?-1:1);return t==0&&n>0||t==this.length&&n<=0?h:Be(h,t==0)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Bi extends yt{domAtPos(t){let{topView:n,text:o}=this.widget;return n?Li(t,0,n,o,(h,u)=>h.domAtPos(u),h=>new $e(o,Math.min(h,o.nodeValue.length))):new $e(o,Math.min(t,o.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(t,n){let{topView:o,text:h}=this.widget;return o?Ei(t,n,o,h):Math.min(n,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(t,n){let{topView:o,text:h}=this.widget;return o?Li(t,n,o,h,(u,m,b)=>u.coordsAt(m,b),(u,m)=>zt(h,u,m)):zt(h,t,n)}destroy(){var t;super.destroy(),(t=this.widget.topView)===null||t===void 0||t.destroy()}get isEditable(){return!0}}function Li(a,t,n,o,h,u){if(n instanceof kt){for(let m of n.children){let b=he(m.dom,o),x=b?o.nodeValue.length:m.length;if(a<x||a==x&&m.getSide()<=0)return b?Li(a,t,m,o,h,u):h(m,a,t);a-=x}return h(n,n.length,-1)}else return n.dom==o?u(a,t):h(n,a,t)}function Ei(a,t,n,o){if(n instanceof kt)for(let h of n.children){let u=0,m=he(h.dom,o);if(he(h.dom,a))return u+(m?Ei(a,t,h,o):h.localPosFromDOM(a,t));u+=m?o.nodeValue.length:h.length}else if(n.dom==o)return Math.min(t,o.nodeValue.length);return n.localPosFromDOM(a,t)}class _t extends de{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof _t&&t.side==this.side}split(){return new _t(this.side)}sync(){if(!this.dom){let t=document.createElement("img");t.className="cm-widgetBuffer",t.setAttribute("aria-hidden","true"),this.setDOM(t)}}getSide(){return this.side}domAtPos(t){return $e.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){let n=this.dom.getBoundingClientRect(),o=bn(this,this.side>0?-1:1);return o&&o.top<n.bottom&&o.bottom>n.top?{left:n.left,right:n.right,top:o.top,bottom:o.bottom}:n}get overrideDOMText(){return T.xv.empty}}it.prototype.children=yt.prototype.children=_t.prototype.children=Qe;function bn(a,t){let n=a.parent,o=n?n.children.indexOf(a):-1;for(;n&&o>=0;)if(t<0?o>0:o<n.children.length){let h=n.children[o+t];if(h instanceof it){let u=h.coordsAt(t<0?h.length:0,t);if(u)return u}o+=t}else if(n instanceof kt&&n.parent)o=n.parent.children.indexOf(n)+(t<0?0:1),n=n.parent;else{let h=n.dom.lastChild;if(h&&h.nodeName=="BR")return h.getClientRects()[0];break}}function Xi(a,t,n){let o=0;for(let h=0;o<t.length;o++){let u=t[o],m=h+u.length;if(!(m==h&&u.getSide()<=0)){if(n>h&&n<m&&u.dom.parentNode==a)return u.domAtPos(n-h);if(n<=h)break;h=m}}for(;o>0;o--){let h=t[o-1].dom;if(h.parentNode==a)return $e.after(h)}return new $e(a,0)}function $(a,t,n){let o,{children:h}=a;n>0&&t instanceof kt&&h.length&&(o=h[h.length-1])instanceof kt&&o.mark.eq(t.mark)?$(o,t.children[0],n-1):(h.push(t),t.setParent(a)),a.length+=t.length}function vt(a,t,n){for(let u=0,m=0;m<a.children.length;m++){let b=a.children[m],x=u+b.length,A;if((n<=0||x==a.length||b.getSide()>0?x>=t:x>t)&&(t<x||m+1==a.children.length||(A=a.children[m+1]).length||A.getSide()>0)){let D=0;if(x==u){if(b.getSide()<=0)continue;D=n=-b.getSide()}let P=b.coordsAt(Math.max(0,t-u),n);return D&&P?Be(P,n<0):P}u=x}let o=a.dom.lastChild;if(!o)return a.dom.getBoundingClientRect();let h=Y(o);return h[h.length-1]||null}function St(a,t){for(let n in a)n=="class"&&t.class?t.class+=" "+a.class:n=="style"&&t.style?t.style+=";"+a.style:t[n]=a[n];return t}function Ri(a,t){if(a==t)return!0;if(!a||!t)return!1;let n=Object.keys(a),o=Object.keys(t);if(n.length!=o.length)return!1;for(let h of n)if(o.indexOf(h)==-1||a[h]!==t[h])return!1;return!0}function Fe(a,t,n){let o=null;if(t)for(let h in t)n&&h in n||a.removeAttribute(o=h);if(n)for(let h in n)t&&t[h]==n[h]||a.setAttribute(o=h,n[h]);return!!o}class ce{eq(t){return!1}updateDOM(t){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}ignoreEvent(t){return!0}get customView(){return null}destroy(t){}}var fe=function(a){return a[a.Text=0]="Text",a[a.WidgetBefore=1]="WidgetBefore",a[a.WidgetAfter=2]="WidgetAfter",a[a.WidgetRange=3]="WidgetRange",a}(fe||(fe={}));class oe extends T.uU{constructor(t,n,o,h){super(),this.startSide=t,this.endSide=n,this.widget=o,this.spec=h}get heightRelevant(){return!1}static mark(t){return new Ze(t)}static widget(t){let n=t.side||0,o=!!t.block;return n+=o?n>0?3e8:-4e8:n>0?1e8:-1e8,new Ge(t,n,n,o,t.widget||null,!1)}static replace(t){let n=!!t.block,o,h;if(t.isBlockGap)o=-5e8,h=4e8;else{let{start:u,end:m}=bt(t,n);o=(u?n?-3e8:-1:5e8)-1,h=(m?n?2e8:1:-6e8)+1}return new Ge(t,o,h,n,t.widget||null,!0)}static line(t){return new ht(t)}static set(t,n=!1){return T.Xs.of(t,n)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}}oe.none=T.Xs.empty;class Ze extends oe{constructor(t){let{start:n,end:o}=bt(t);super(n?-1:5e8,o?1:-6e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){return this==t||t instanceof Ze&&this.tagName==t.tagName&&this.class==t.class&&Ri(this.attrs,t.attrs)}range(t,n=t){if(t>=n)throw new RangeError("Mark decorations may not be empty");return super.range(t,n)}}Ze.prototype.point=!1;class ht extends oe{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof ht&&Ri(this.spec.attributes,t.spec.attributes)}range(t,n=t){if(n!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,n)}}ht.prototype.mapMode=T.gc.TrackBefore,ht.prototype.point=!0;class Ge extends oe{constructor(t,n,o,h,u,m){super(n,o,u,t),this.block=h,this.isReplace=m,this.mapMode=h?n<=0?T.gc.TrackBefore:T.gc.TrackAfter:T.gc.TrackDel}get type(){return this.startSide<this.endSide?fe.WidgetRange:this.startSide<=0?fe.WidgetBefore:fe.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(t){return t instanceof Ge&&Qi(this.widget,t.widget)&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide}range(t,n=t){if(this.isReplace&&(t>n||t==n&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&n!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,n)}}Ge.prototype.point=!0;function bt(a,t=!1){let{inclusiveStart:n,inclusiveEnd:o}=a;return n==null&&(n=a.inclusive),o==null&&(o=a.inclusive),{start:n??t,end:o??t}}function Qi(a,t){return a==t||!!(a&&t&&a.compare(t))}function ct(a,t,n,o=0){let h=n.length-1;h>=0&&n[h]+o>=a?n[h]=Math.max(n[h],t):n.push(a,t)}class be extends de{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,n,o,h,u,m){if(o){if(!(o instanceof be))return!1;this.dom||o.transferDOM(this)}return h&&this.setDeco(o?o.attrs:null),Ye(this,t,n,o?o.children:[],u,m),!0}split(t){let n=new be;if(n.breakAfter=this.breakAfter,this.length==0)return n;let{i:o,off:h}=this.childPos(t);h&&(n.append(this.children[o].split(h),0),this.children[o].merge(h,this.children[o].length,null,!1,0,0),o++);for(let u=o;u<this.children.length;u++)n.append(this.children[u],0);for(;o>0&&this.children[o-1].length==0;)this.children[--o].destroy();return this.children.length=o,this.markDirty(),this.length=t,n}transferDOM(t){this.dom&&(this.markDirty(),t.setDOM(this.dom),t.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){Ri(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,n){$(this,t,n)}addLineDeco(t){let n=t.spec.attributes,o=t.spec.class;n&&(this.attrs=St(n,this.attrs||{})),o&&(this.attrs=St({class:o},this.attrs||{}))}domAtPos(t){return Xi(this.dom,this.children,t)}reuseDOM(t){t.nodeName=="DIV"&&(this.setDOM(t),this.dirty|=6)}sync(t){var n;this.dom?this.dirty&4&&(ii(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(Fe(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t);let o=this.dom.lastChild;for(;o&&de.get(o)instanceof kt;)o=o.lastChild;if(!o||!this.length||o.nodeName!="BR"&&((n=de.get(o))===null||n===void 0?void 0:n.isEditable)==!1&&(!U.ios||!this.children.some(h=>h instanceof it))){let h=document.createElement("BR");h.cmIgnore=!0,this.dom.appendChild(h)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let t=0;for(let n of this.children){if(!(n instanceof it))return null;let o=Y(n.dom);if(o.length!=1)return null;t+=o[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length}}coordsAt(t,n){return vt(this,t,n)}become(t){return!1}get type(){return fe.Text}static find(t,n){for(let o=0,h=0;o<t.children.length;o++){let u=t.children[o],m=h+u.length;if(m>=n){if(u instanceof be)return u;if(m>n)break}h=m+u.breakAfter}return null}}class q extends de{constructor(t,n,o){super(),this.widget=t,this.length=n,this.type=o,this.breakAfter=0,this.prevWidget=null}merge(t,n,o,h,u,m){return o&&(!(o instanceof q)||!this.widget.compare(o.widget)||t>0&&u<=0||n<this.length&&m<=0)?!1:(this.length=t+(o?o.length:0)+(this.length-n),!0)}domAtPos(t){return t==0?$e.before(this.dom):$e.after(this.dom,t==this.length)}split(t){let n=this.length-t;this.length=t;let o=new q(this.widget,n,this.type);return o.breakAfter=this.breakAfter,o}get children(){return Qe}sync(){(!this.dom||!this.widget.updateDOM(this.dom))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):T.xv.empty}domBoundsAround(){return null}become(t){return t instanceof q&&t.type==this.type&&t.widget.constructor==this.widget.constructor?(t.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.breakAfter=t.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Ii{constructor(t,n,o,h){this.doc=t,this.pos=n,this.end=o,this.disallowBlockEffectsFor=h,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=n}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!t.breakAfter&&!(t instanceof q&&t.type==fe.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new be),this.atCursorPos=!0),this.curLine}flushBuffer(t){this.pendingBuffer&&(this.curLine.append(bi(new _t(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer([]),this.curLine=null,this.content.push(t)}finish(t){t?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(t,n,o){for(;t>0;){if(this.textOff==this.text.length){let{value:u,lineBreak:m,done:b}=this.cursor.next(this.skip);if(this.skip=0,b)throw new Error("Ran out of text content when drawing inline views");if(m){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,t--;continue}else this.text=u,this.textOff=0}let h=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(n.slice(0,o)),this.getLine().append(bi(new it(this.text.slice(this.textOff,this.textOff+h)),n),o),this.atCursorPos=!0,this.textOff+=h,t-=h,o=0}}span(t,n,o,h){this.buildText(n-t,o,h),this.pos=n,this.openStart<0&&(this.openStart=h)}point(t,n,o,h,u,m){if(this.disallowBlockEffectsFor[m]&&o instanceof Ge){if(o.block)throw new RangeError("Block decorations may not be specified via plugins");if(n>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let b=n-t;if(o instanceof Ge)if(o.block){let{type:x}=o;x==fe.WidgetAfter&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new q(o.widget||new Ni("div"),b,x))}else{let x=yt.create(o.widget||new Ni("span"),b,o.startSide),A=this.atCursorPos&&!x.isEditable&&u<=h.length&&(t<n||o.startSide>0),D=!x.isEditable&&(t<n||o.startSide<=0),P=this.getLine();this.pendingBuffer==2&&!A&&(this.pendingBuffer=0),this.flushBuffer(h),A&&(P.append(bi(new _t(1),h),u),u=h.length+Math.max(0,u-h.length)),P.append(bi(x,h),u),this.atCursorPos=D,this.pendingBuffer=D?t<n?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(o);b&&(this.textOff+b<=this.text.length?this.textOff+=b:(this.skip+=b-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=n),this.openStart<0&&(this.openStart=u)}static build(t,n,o,h,u){let m=new Ii(t,n,o,u);return m.openEnd=T.Xs.spans(h,n,o,m),m.openStart<0&&(m.openStart=m.openEnd),m.finish(m.openEnd),m}}function bi(a,t){for(let n of t)a=new kt(n,[a],a.length);return a}class Ni extends ce{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}}const ye=T.r$.define(),Yi=T.r$.define(),Ue=T.r$.define(),Jt=T.r$.define(),Xt=T.r$.define(),Le=T.r$.define(),nt=T.r$.define({combine:a=>a.some(t=>t)});class Zi{constructor(t,n="nearest",o="nearest",h=5,u=5){this.range=t,this.y=n,this.x=o,this.yMargin=h,this.xMargin=u}map(t){return t.empty?this:new Zi(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin)}}const wi=T.Py.define({map:(a,t)=>a.map(t)});function Et(a,t,n){let o=a.facet(Jt);o.length?o[0](t):window.onerror?window.onerror(String(t),n,void 0,void 0,t):n?console.error(n+":",t):console.error(t)}const oi=T.r$.define({combine:a=>a.length?a[0]:!0});let Rt=0;const ft=T.r$.define();class Ie{constructor(t,n,o,h){this.id=t,this.create=n,this.domEventHandlers=o,this.extension=h(this)}static define(t,n){const{eventHandlers:o,provide:h,decorations:u}=n||{};return new Ie(Rt++,t,o,m=>{let b=[ft.of(m)];return u&&b.push(Nt.of(x=>{let A=x.plugin(m);return A?u(A):oe.none})),h&&b.push(h(m)),b})}static fromClass(t,n){return Ie.define(o=>new t(o),n)}}class It{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}update(t){if(this.value){if(this.mustUpdate){let n=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(n)}catch(o){if(Et(n.state,o,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(t)}catch(n){Et(t.state,n,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var n;if(!((n=this.value)===null||n===void 0)&&n.destroy)try{this.value.destroy()}catch(o){Et(t.state,o,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const xi=T.r$.define(),jt=T.r$.define(),Nt=T.r$.define(),Ct=T.r$.define(),Jn=T.r$.define(),li=T.r$.define();class C{constructor(t,n,o,h){this.fromA=t,this.toA=n,this.fromB=o,this.toB=h}join(t){return new C(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let n=t.length,o=this;for(;n>0;n--){let h=t[n-1];if(!(h.fromA>o.toA)){if(h.toA<o.fromA)break;o=o.join(h),t.splice(n-1,1)}}return t.splice(n,0,o),t}static extendWithRanges(t,n){if(n.length==0)return t;let o=[];for(let h=0,u=0,m=0,b=0;;h++){let x=h==t.length?null:t[h],A=m-b,D=x?x.fromB:1e9;for(;u<n.length&&n[u]<D;){let P=n[u],V=n[u+1],N=Math.max(b,P),F=Math.min(D,V);if(N<=F&&new C(N+A,F+A,N,F).addToSet(o),V>D)break;u+=2}if(!x)return o;new C(x.fromA,x.toA,x.fromB,x.toB).addToSet(o),m=x.toA,b=x.toB}}}class f{constructor(t,n,o){this.view=t,this.state=n,this.transactions=o,this.flags=0,this.startState=t.state,this.changes=T.as.empty(this.startState.doc.length);for(let m of o)this.changes=this.changes.compose(m.changes);let h=[];this.changes.iterChangedRanges((m,b,x,A)=>h.push(new C(m,b,x,A))),this.changedRanges=h;let u=t.hasFocus;u!=t.inputState.notifiedFocused&&(t.inputState.notifiedFocused=u,this.flags|=1)}static create(t,n,o){return new f(t,n,o)}get viewportChanged(){return(this.flags&4)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&10)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(t=>t.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}var p=function(a){return a[a.LTR=0]="LTR",a[a.RTL=1]="RTL",a}(p||(p={}));const g=p.LTR,w=p.RTL;function v(a){let t=[];for(let n=0;n<a.length;n++)t.push(1<<+a[n]);return t}const S=v("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),O=v("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),L=Object.create(null),R=[];for(let a of["()","[]","{}"]){let t=a.charCodeAt(0),n=a.charCodeAt(1);L[t]=n,L[n]=-t}function H(a){return a<=247?S[a]:1424<=a&&a<=1524?2:1536<=a&&a<=1785?O[a-1536]:1774<=a&&a<=2220?4:8192<=a&&a<=8203||a==8204?256:1}const z=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;class G{constructor(t,n,o){this.from=t,this.to=n,this.level=o}get dir(){return this.level%2?w:g}side(t,n){return this.dir==n==t?this.to:this.from}static find(t,n,o,h){let u=-1;for(let m=0;m<t.length;m++){let b=t[m];if(b.from<=n&&b.to>=n){if(b.level==o)return m;(u<0||(h!=0?h<0?b.from<n:b.to>n:t[u].level>b.level))&&(u=m)}}if(u<0)throw new RangeError("Index out of range");return u}}const j=[];function ve(a,t){let n=a.length,o=t==g?1:2,h=t==g?2:1;if(!a||o==1&&!z.test(a))return At(n);for(let m=0,b=o,x=o;m<n;m++){let A=H(a.charCodeAt(m));A==512?A=b:A==8&&x==4&&(A=16),j[m]=A==4?2:A,A&7&&(x=A),b=A}for(let m=0,b=o,x=o;m<n;m++){let A=j[m];if(A==128)m<n-1&&b==j[m+1]&&b&24?A=j[m]=b:j[m]=256;else if(A==64){let D=m+1;for(;D<n&&j[D]==64;)D++;let P=m&&b==8||D<n&&j[D]==8?x==1?1:8:256;for(let V=m;V<D;V++)j[V]=P;m=D-1}else A==8&&x==1&&(j[m]=1);b=A,A&7&&(x=A)}for(let m=0,b=0,x=0,A,D,P;m<n;m++)if(D=L[A=a.charCodeAt(m)])if(D<0){for(let V=b-3;V>=0;V-=3)if(R[V+1]==-D){let N=R[V+2],F=N&2?o:N&4?N&1?h:o:0;F&&(j[m]=j[R[V]]=F),b=V;break}}else{if(R.length==189)break;R[b++]=m,R[b++]=A,R[b++]=x}else if((P=j[m])==2||P==1){let V=P==o;x=V?0:1;for(let N=b-3;N>=0;N-=3){let F=R[N+2];if(F&2)break;if(V)R[N+2]|=2;else{if(F&4)break;R[N+2]|=4}}}for(let m=0;m<n;m++)if(j[m]==256){let b=m+1;for(;b<n&&j[b]==256;)b++;let x=(m?j[m-1]:o)==1,A=(b<n?j[b]:o)==1,D=x==A?x?1:2:o;for(let P=m;P<b;P++)j[P]=D;m=b-1}let u=[];if(o==1)for(let m=0;m<n;){let b=m,x=j[m++]!=1;for(;m<n&&x==(j[m]!=1);)m++;if(x)for(let A=m;A>b;){let D=A,P=j[--A]!=2;for(;A>b&&P==(j[A-1]!=2);)A--;u.push(new G(A,D,P?2:1))}else u.push(new G(b,m,0))}else for(let m=0;m<n;){let b=m,x=j[m++]==2;for(;m<n&&x==(j[m]==2);)m++;u.push(new G(b,m,x?1:2))}return u}function At(a){return[new G(0,a,0)]}let Ee="";function en(a,t,n,o,h){var u;let m=o.head-a.from,b=-1;if(m==0){if(!h||!a.length)return null;t[0].level!=n&&(m=t[0].side(!1,n),b=0)}else if(m==a.length){if(h)return null;let V=t[t.length-1];V.level!=n&&(m=V.side(!0,n),b=t.length-1)}b<0&&(b=G.find(t,m,(u=o.bidiLevel)!==null&&u!==void 0?u:-1,o.assoc));let x=t[b];m==x.side(h,n)&&(x=t[b+=h?1:-1],m=x.side(!h,n));let A=h==(x.dir==n),D=(0,T.cp)(a.text,m,A);if(Ee=a.text.slice(Math.min(m,D),Math.max(m,D)),D!=x.side(h,n))return T.jT.cursor(D+a.from,A?-1:1,x.level);let P=b==(h?t.length-1:0)?null:t[b+(h?1:-1)];return!P&&x.level!=n?T.jT.cursor(h?a.to:a.from,h?-1:1,n):P&&P.level<x.level?T.jT.cursor(P.side(!h,n)+a.from,h?1:-1,P.level):T.jT.cursor(D+a.from,h?-1:1,x.level)}const ki="\uFFFF";class Is{constructor(t,n){this.points=t,this.text="",this.lineSeparator=n.facet(T.yy.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+=ki}readRange(t,n){if(!t)return this;let o=t.parentNode;for(let h=t;;){this.findPointBefore(o,h),this.readNode(h);let u=h.nextSibling;if(u==n)break;let m=de.get(h),b=de.get(u);(m&&b?m.breakAfter:(m?m.breakAfter:Ns(h))||Ns(u)&&(h.nodeName!="BR"||h.cmIgnore))&&this.lineBreak(),h=u}return this.findPointBefore(o,n),this}readTextNode(t){let n=t.nodeValue;for(let o of this.points)o.node==t&&(o.pos=this.text.length+Math.min(o.offset,n.length));for(let o=0,h=this.lineSeparator?null:/\r\n?|\n/g;;){let u=-1,m=1,b;if(this.lineSeparator?(u=n.indexOf(this.lineSeparator,o),m=this.lineSeparator.length):(b=h.exec(n))&&(u=b.index,m=b[0].length),this.append(n.slice(o,u<0?n.length:u)),u<0)break;if(this.lineBreak(),m>1)for(let x of this.points)x.node==t&&x.pos>this.text.length&&(x.pos-=m-1);o=u+m}}readNode(t){if(t.cmIgnore)return;let n=de.get(t),o=n&&n.overrideDOMText;if(o!=null){this.findPointInside(t,o.length);for(let h=o.iter();!h.next().done;)h.lineBreak?this.lineBreak():this.append(h.value)}else t.nodeType==3?this.readTextNode(t):t.nodeName=="BR"?t.nextSibling&&this.lineBreak():t.nodeType==1&&this.readRange(t.firstChild,null)}findPointBefore(t,n){for(let o of this.points)o.node==t&&t.childNodes[o.offset]==n&&(o.pos=this.text.length)}findPointInside(t,n){for(let o of this.points)(t.nodeType==3?o.node==t:t.contains(o.node))&&(o.pos=this.text.length+Math.min(n,o.offset))}}function Ns(a){return a.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(a.nodeName)}class Vs{constructor(t,n){this.node=t,this.offset=n,this.pos=-1}}class Fs extends de{constructor(t){super(),this.view=t,this.compositionDeco=oe.none,this.decorations=[],this.dynamicDecorationMap=[],this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new be],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new C(0,0,0,t.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(t){let n=t.changedRanges;this.minWidth>0&&n.length&&(n.every(({fromA:m,toA:b})=>b<this.minWidthFrom||m>this.minWidthTo)?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=oe.none:(t.transactions.length||this.dirty)&&(this.compositionDeco=wn(this.view,t.changes)),(U.ie||U.chrome)&&!this.compositionDeco.size&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let o=this.decorations,h=this.updateDeco(),u=ai(o,h,t.changes);return n=C.extendWithRanges(n,u),this.dirty==0&&n.length==0?!1:(this.updateInner(n,t.startState.doc.length),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,n){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,n);let{observer:o}=this.view;o.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let u=U.chrome||U.ios?{node:o.selectionRange.focusNode,written:!1}:void 0;this.sync(u),this.dirty=0,u&&(u.written||o.selectionRange.focusNode!=u.node)&&(this.forceSelection=!0),this.dom.style.height=""});let h=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let u of this.children)u instanceof q&&u.widget instanceof Hs&&h.push(u.dom);o.updateGaps(h)}updateChildren(t,n){let o=this.childCursor(n);for(let h=t.length-1;;h--){let u=h>=0?t[h]:null;if(!u)break;let{fromA:m,toA:b,fromB:x,toB:A}=u,{content:D,breakAtStart:P,openStart:V,openEnd:N}=Ii.build(this.view.state.doc,x,A,this.decorations,this.dynamicDecorationMap),{i:F,off:_}=o.findPos(b,1),{i:J,off:X}=o.findPos(m,-1);gi(this,J,X,F,_,D,P,V,N)}}updateSelection(t=!1,n=!1){if(t&&this.view.observer.readSelectionRange(),!(n||this.mayControlSelection())||U.ios&&this.view.inputState.rapidCompositionStart)return;let o=this.forceSelection;this.forceSelection=!1;let h=this.view.state.selection.main,u=this.domAtPos(h.anchor),m=h.empty?u:this.domAtPos(h.head);if(U.gecko&&h.empty&&Cl(u)){let x=document.createTextNode("");this.view.observer.ignore(()=>u.node.insertBefore(x,u.node.childNodes[u.offset]||null)),u=m=new $e(x,0),o=!0}let b=this.view.observer.selectionRange;(o||!b.focusNode||!Ae(u.node,u.offset,b.anchorNode,b.anchorOffset)||!Ae(m.node,m.offset,b.focusNode,b.focusOffset))&&(this.view.observer.ignore(()=>{U.android&&U.chrome&&this.dom.contains(b.focusNode)&&Al(b.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let x=Pe(this.root);if(h.empty){if(U.gecko){let A=nn(u.node,u.offset);if(A&&A!=3){let D=tn(u.node,u.offset,A==1?1:-1);D&&(u=new $e(D,A==1?0:D.nodeValue.length))}}x.collapse(u.node,u.offset),h.bidiLevel!=null&&b.cursorBidiLevel!=null&&(b.cursorBidiLevel=h.bidiLevel)}else if(x.extend)x.collapse(u.node,u.offset),x.extend(m.node,m.offset);else{let A=document.createRange();h.anchor>h.head&&([u,m]=[m,u]),A.setEnd(m.node,m.offset),A.setStart(u.node,u.offset),x.removeAllRanges(),x.addRange(A)}}),this.view.observer.setSelectionRange(u,m)),this.impreciseAnchor=u.precise?null:new $e(b.anchorNode,b.anchorOffset),this.impreciseHead=m.precise?null:new $e(b.focusNode,b.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let t=this.view.state.selection.main,n=Pe(this.root);if(!t.empty||!t.assoc||!n.modify)return;let o=be.find(this,t.head);if(!o)return;let h=o.posAtStart;if(t.head==h||t.head==h+o.length)return;let u=this.coordsAt(t.head,-1),m=this.coordsAt(t.head,1);if(!u||!m||u.bottom>m.top)return;let b=this.domAtPos(t.head+t.assoc);n.collapse(b.node,b.offset),n.modify("move",t.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(oi)?this.root.activeElement==this.dom:Z(this.dom,this.view.observer.selectionRange)}nearest(t){for(let n=t;n;){let o=de.get(n);if(o&&o.rootView==this)return o;n=n.parentNode}return null}posFromDOM(t,n){let o=this.nearest(t);if(!o)throw new RangeError("Trying to find position for a DOM position outside of the document");return o.localPosFromDOM(t,n)+o.posAtStart}domAtPos(t){let{i:n,off:o}=this.childCursor().findPos(t,-1);for(;n<this.children.length-1;){let h=this.children[n];if(o<h.length||h instanceof be)break;n++,o=0}return this.children[n].domAtPos(o)}coordsAt(t,n){for(let o=this.length,h=this.children.length-1;;h--){let u=this.children[h],m=o-u.breakAfter-u.length;if(t>m||t==m&&u.type!=fe.WidgetBefore&&u.type!=fe.WidgetAfter&&(!h||n==2||this.children[h-1].breakAfter||this.children[h-1].type==fe.WidgetBefore&&n>-2))return u.coordsAt(t-m,n);o=m}}measureVisibleLineHeights(t){let n=[],{from:o,to:h}=t,u=this.view.contentDOM.clientWidth,m=u>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,b=-1,x=this.view.textDirection==p.LTR;for(let A=0,D=0;D<this.children.length;D++){let P=this.children[D],V=A+P.length;if(V>h)break;if(A>=o){let N=P.dom.getBoundingClientRect();if(n.push(N.height),m){let F=P.dom.lastChild,_=F?Y(F):[];if(_.length){let J=_[_.length-1],X=x?J.right-N.left:N.right-J.left;X>b&&(b=X,this.minWidth=u,this.minWidthFrom=A,this.minWidthTo=V)}}}A=V+P.breakAfter}return n}textDirectionAt(t){let{i:n}=this.childPos(t,1);return getComputedStyle(this.children[n].dom).direction=="rtl"?p.RTL:p.LTR}measureTextSize(){for(let h of this.children)if(h instanceof be){let u=h.measureTextSize();if(u)return u}let t=document.createElement("div"),n,o;return t.className="cm-line",t.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(t);let h=Y(t.firstChild)[0];n=t.getBoundingClientRect().height,o=h?h.width/27:7,t.remove()}),{lineHeight:n,charWidth:o}}childCursor(t=this.length){let n=this.children.length;return n&&(t-=this.children[--n].length),new yn(this.children,t,n)}computeBlockGapDeco(){let t=[],n=this.view.viewState;for(let o=0,h=0;;h++){let u=h==n.viewports.length?null:n.viewports[h],m=u?u.from-1:this.length;if(m>o){let b=n.lineBlockAt(m).bottom-n.lineBlockAt(o).top;t.push(oe.replace({widget:new Hs(b),block:!0,inclusive:!0,isBlockGap:!0}).range(o,m))}if(!u)break;o=u.to+1}return oe.set(t)}updateDeco(){let t=this.view.state.facet(Nt).map((n,o)=>(this.dynamicDecorationMap[o]=typeof n=="function")?n(this.view):n);for(let n=t.length;n<t.length+3;n++)this.dynamicDecorationMap[n]=!1;return this.decorations=[...t,this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(t){let{range:n}=t,o=this.coordsAt(n.head,n.empty?n.assoc:n.head>n.anchor?-1:1),h;if(!o)return;!n.empty&&(h=this.coordsAt(n.anchor,n.anchor>n.head?-1:1))&&(o={left:Math.min(o.left,h.left),top:Math.min(o.top,h.top),right:Math.max(o.right,h.right),bottom:Math.max(o.bottom,h.bottom)});let u=0,m=0,b=0,x=0;for(let D of this.view.state.facet(Jn).map(P=>P(this.view)))if(D){let{left:P,right:V,top:N,bottom:F}=D;P!=null&&(u=Math.max(u,P)),V!=null&&(m=Math.max(m,V)),N!=null&&(b=Math.max(b,N)),F!=null&&(x=Math.max(x,F))}let A={left:o.left-u,top:o.top-b,right:o.right+m,bottom:o.bottom+x};st(this.view.scrollDOM,A,n.head<n.anchor?-1:1,t.x,t.y,t.xMargin,t.yMargin,this.view.textDirection==p.LTR)}}function Cl(a){return a.node.nodeType==1&&a.node.firstChild&&(a.offset==0||a.node.childNodes[a.offset-1].contentEditable=="false")&&(a.offset==a.node.childNodes.length||a.node.childNodes[a.offset].contentEditable=="false")}class Hs extends ce{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function Ws(a){let t=a.observer.selectionRange,n=t.focusNode&&tn(t.focusNode,t.focusOffset,0);if(!n)return null;let o=a.docView.nearest(n);if(!o)return null;if(o instanceof be){let h=n;for(;h.parentNode!=o.dom;)h=h.parentNode;let u=h.previousSibling;for(;u&&!de.get(u);)u=u.previousSibling;let m=u?de.get(u).posAtEnd:o.posAtStart;return{from:m,to:m,node:h,text:n}}else{for(;;){let{parent:u}=o;if(!u)return null;if(u instanceof be)break;o=u}let h=o.posAtStart;return{from:h,to:h+o.length,node:o.dom,text:n}}}function wn(a,t){let n=Ws(a);if(!n)return oe.none;let{from:o,to:h,node:u,text:m}=n,b=t.mapPos(o,1),x=Math.max(b,t.mapPos(h,-1)),{state:A}=a,D=u.nodeType==3?u.nodeValue:new Is([],A).readRange(u.firstChild,null).text;if(x-b<D.length)if(A.doc.sliceString(b,Math.min(A.doc.length,b+D.length),ki)==D)x=b+D.length;else if(A.doc.sliceString(Math.max(0,x-D.length),x,ki)==D)b=x-D.length;else return oe.none;else if(A.doc.sliceString(b,x,ki)!=D)return oe.none;let P=de.get(u);return P instanceof Bi?P=P.widget.topView:P&&(P.parent=null),oe.set(oe.replace({widget:new zs(u,m,P),inclusive:!0}).range(b,x))}class zs extends ce{constructor(t,n,o){super(),this.top=t,this.text=n,this.topView=o}eq(t){return this.top==t.top&&this.text==t.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return Bi}}function tn(a,t,n){for(;;){if(a.nodeType==3)return a;if(a.nodeType==1&&t>0&&n<=0)a=a.childNodes[t-1],t=mt(a);else if(a.nodeType==1&&t<a.childNodes.length&&n>=0)a=a.childNodes[t],t=0;else return null}}function nn(a,t){return a.nodeType!=1?0:(t&&a.childNodes[t-1].contentEditable=="false"?1:0)|(t<a.childNodes.length&&a.childNodes[t].contentEditable=="false"?2:0)}class js{constructor(){this.changes=[]}compareRange(t,n){ct(t,n,this.changes)}comparePoint(t,n){ct(t,n,this.changes)}}function ai(a,t,n){let o=new js;return T.Xs.compare(a,t,n,o),o.changes}function Al(a,t){for(let n=a;n&&n!=t;n=n.assignedSlot||n.parentNode)if(n.nodeType==1&&n.contentEditable=="false")return!0;return!1}function xn(a,t,n=1){let o=a.charCategorizer(t),h=a.doc.lineAt(t),u=t-h.from;if(h.length==0)return T.jT.cursor(t);u==0?n=1:u==h.length&&(n=-1);let m=u,b=u;n<0?m=(0,T.cp)(h.text,u,!1):b=(0,T.cp)(h.text,u);let x=o(h.text.slice(m,b));for(;m>0;){let A=(0,T.cp)(h.text,m,!1);if(o(h.text.slice(A,m))!=x)break;m=A}for(;b<h.length;){let A=(0,T.cp)(h.text,b);if(o(h.text.slice(b,A))!=x)break;b=A}return T.jT.range(m+h.from,b+h.from)}function ao(a,t){return t.left>a?t.left-a:Math.max(0,a-t.right)}function $s(a,t){return t.top>a?t.top-a:Math.max(0,a-t.bottom)}function Xn(a,t){return a.top<t.bottom-1&&a.bottom>t.top+1}function qs(a,t){return t<a.top?{top:t,left:a.left,right:a.right,bottom:a.bottom}:a}function Qn(a,t){return t>a.bottom?{top:a.top,left:a.left,right:a.right,bottom:t}:a}function Us(a,t,n){let o,h,u,m,b,x,A,D;for(let N=a.firstChild;N;N=N.nextSibling){let F=Y(N);for(let _=0;_<F.length;_++){let J=F[_];h&&Xn(h,J)&&(J=qs(Qn(J,h.bottom),h.top));let X=ao(t,J),Me=$s(n,J);if(X==0&&Me==0)return N.nodeType==3?ho(N,t,n):Us(N,t,n);(!o||m>Me||m==Me&&u>X)&&(o=N,h=J,u=X,m=Me),X==0?n>J.bottom&&(!A||A.bottom<J.bottom)?(b=N,A=J):n<J.top&&(!D||D.top>J.top)&&(x=N,D=J):A&&Xn(A,J)?A=Qn(A,J.bottom):D&&Xn(D,J)&&(D=qs(D,J.top))}}if(A&&A.bottom>=n?(o=b,h=A):D&&D.top<=n&&(o=x,h=D),!o)return{node:a,offset:0};let P=Math.max(h.left,Math.min(h.right,t));if(o.nodeType==3)return ho(o,P,n);if(!u&&o.contentEditable=="true")return Us(o,P,n);let V=Array.prototype.indexOf.call(a.childNodes,o)+(t>=(h.left+h.right)/2?1:0);return{node:a,offset:V}}function ho(a,t,n){let o=a.nodeValue.length,h=-1,u=1e9,m=0;for(let b=0;b<o;b++){let x=Ve(a,b,b+1).getClientRects();for(let A=0;A<x.length;A++){let D=x[A];if(D.top==D.bottom)continue;m||(m=t-D.left);let P=(D.top>n?D.top-n:n-D.bottom)-1;if(D.left-1<=t&&D.right+1>=t&&P<u){let V=t>=(D.left+D.right)/2,N=V;if((U.chrome||U.gecko)&&Ve(a,b).getBoundingClientRect().left==D.right&&(N=!V),P<=0)return{node:a,offset:b+(N?1:0)};h=b+(N?1:0),u=P}}}return{node:a,offset:h>-1?h:m>0?a.nodeValue.length:0}}function Gs(a,{x:t,y:n},o,h=-1){var u;let m=a.contentDOM.getBoundingClientRect(),b=m.top+a.viewState.paddingTop,x,{docHeight:A}=a.viewState,D=n-b;if(D<0)return 0;if(D>A)return a.state.doc.length;for(let X=a.defaultLineHeight/2,Me=!1;x=a.elementAtHeight(D),x.type!=fe.Text;)for(;D=h>0?x.bottom+X:x.top-X,!(D>=0&&D<=A);){if(Me)return o?null:0;Me=!0,h=-h}n=b+D;let P=x.from;if(P<a.viewport.from)return a.viewport.from==0?0:o?null:Ks(a,m,x,t,n);if(P>a.viewport.to)return a.viewport.to==a.state.doc.length?a.state.doc.length:o?null:Ks(a,m,x,t,n);let V=a.dom.ownerDocument,N=a.root.elementFromPoint?a.root:V,F=N.elementFromPoint(t,n);F&&!a.contentDOM.contains(F)&&(F=null),F||(t=Math.max(m.left+1,Math.min(m.right-1,t)),F=N.elementFromPoint(t,n),F&&!a.contentDOM.contains(F)&&(F=null));let _,J=-1;if(F&&((u=a.docView.nearest(F))===null||u===void 0?void 0:u.isEditable)!=!1){if(V.caretPositionFromPoint){let X=V.caretPositionFromPoint(t,n);X&&({offsetNode:_,offset:J}=X)}else if(V.caretRangeFromPoint){let X=V.caretRangeFromPoint(t,n);X&&({startContainer:_,startOffset:J}=X,U.safari&&_s(_,J,t)&&(_=void 0))}}if(!_||!a.docView.dom.contains(_)){let X=be.find(a.docView,P);if(!X)return D>x.top+x.height/2?x.to:x.from;({node:_,offset:J}=Us(X.dom,t,n))}return a.docView.posFromDOM(_,J)}function Ks(a,t,n,o,h){let u=Math.round((o-t.left)*a.defaultCharacterWidth);if(a.lineWrapping&&n.height>a.defaultLineHeight*1.5){let b=Math.floor((h-n.top)/a.defaultLineHeight);u+=b*a.viewState.heightOracle.lineLength}let m=a.state.sliceDoc(n.from,n.to);return n.from+(0,T.Gz)(m,u,a.state.tabSize)}function _s(a,t,n){let o;if(a.nodeType!=3||t!=(o=a.nodeValue.length))return!1;for(let h=a.nextSibling;h;h=h.nextSibling)if(h.nodeType!=1||h.nodeName!="BR")return!1;return Ve(a,o-1,o).getBoundingClientRect().left>n}function Js(a,t,n,o){let h=a.state.doc.lineAt(t.head),u=!o||!a.lineWrapping?null:a.coordsAtPos(t.assoc<0&&t.head>h.from?t.head-1:t.head);if(u){let x=a.dom.getBoundingClientRect(),A=a.textDirectionAt(h.from),D=a.posAtCoords({x:n==(A==p.LTR)?x.right-1:x.left+1,y:(u.top+u.bottom)/2});if(D!=null)return T.jT.cursor(D,n?-1:1)}let m=be.find(a.docView,t.head),b=m?n?m.posAtEnd:m.posAtStart:n?h.to:h.from;return T.jT.cursor(b,n?-1:1)}function Xs(a,t,n,o){let h=a.state.doc.lineAt(t.head),u=a.bidiSpans(h),m=a.textDirectionAt(h.from);for(let b=t,x=null;;){let A=en(h,u,m,b,n),D=Ee;if(!A){if(h.number==(n?a.state.doc.lines:1))return b;D=`
`,h=a.state.doc.line(h.number+(n?1:-1)),u=a.bidiSpans(h),A=T.jT.cursor(n?h.from:h.to)}if(x){if(!x(D))return b}else{if(!o)return A;x=o(D)}b=A}}function co(a,t,n){let o=a.state.charCategorizer(t),h=o(n);return u=>{let m=o(u);return h==T.D0.Space&&(h=m),h==m}}function Yn(a,t,n,o){let h=t.head,u=n?1:-1;if(h==(n?a.state.doc.length:0))return T.jT.cursor(h,t.assoc);let m=t.goalColumn,b,x=a.contentDOM.getBoundingClientRect(),A=a.coordsAtPos(h),D=a.documentTop;if(A)m==null&&(m=A.left-x.left),b=u<0?A.top:A.bottom;else{let N=a.viewState.lineBlockAt(h);m==null&&(m=Math.min(x.right-x.left,a.defaultCharacterWidth*(h-N.from))),b=(u<0?N.top:N.bottom)+D}let P=x.left+m,V=o??a.defaultLineHeight>>1;for(let N=0;;N+=10){let F=b+(V+N)*u,_=Gs(a,{x:P,y:F},!1,u);if(F<x.top||F>x.bottom||(u<0?_<h:_>h))return T.jT.cursor(_,t.assoc,void 0,m)}}function Zn(a,t,n){let o=a.state.facet(Ct).map(h=>h(a));for(;;){let h=!1;for(let u of o)u.between(n.from-1,n.from+1,(m,b,x)=>{n.from>m&&n.from<b&&(n=t.from>n.from?T.jT.cursor(m,1):T.jT.cursor(b,-1),h=!0)});if(!h)return n}}class fo{constructor(t){this.lastKeyCode=0,this.lastKeyTime=0,this.chromeScrollHack=-1,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let n in Ke){let o=Ke[n];t.contentDOM.addEventListener(n,h=>{!Ys(t,h)||this.ignoreDuringComposition(h)||n=="keydown"&&this.keydown(t,h)||(this.mustFlushObserver(h)&&t.observer.forceFlush(),this.runCustomHandlers(n,t,h)?h.preventDefault():o(t,h))}),this.registeredEvents.push(n)}U.chrome&&U.chrome_version>=102&&t.scrollDOM.addEventListener("wheel",()=>{this.chromeScrollHack<0?t.contentDOM.style.pointerEvents="none":window.clearTimeout(this.chromeScrollHack),this.chromeScrollHack=setTimeout(()=>{this.chromeScrollHack=-1,t.contentDOM.style.pointerEvents=""},100)},{passive:!0}),this.notifiedFocused=t.hasFocus,U.safari&&t.contentDOM.addEventListener("input",()=>null)}setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}ensureHandlers(t,n){var o;let h;this.customHandlers=[];for(let u of n)if(h=(o=u.update(t).spec)===null||o===void 0?void 0:o.domEventHandlers){this.customHandlers.push({plugin:u.value,handlers:h});for(let m in h)this.registeredEvents.indexOf(m)<0&&m!="scroll"&&(this.registeredEvents.push(m),t.contentDOM.addEventListener(m,b=>{Ys(t,b)&&this.runCustomHandlers(m,t,b)&&b.preventDefault()}))}}runCustomHandlers(t,n,o){for(let h of this.customHandlers){let u=h.handlers[t];if(u)try{if(u.call(h.plugin,o,n)||o.defaultPrevented)return!0}catch(m){Et(n.state,m)}}return!1}runScrollHandlers(t,n){for(let o of this.customHandlers){let h=o.handlers.scroll;if(h)try{h.call(o.plugin,n,t)}catch(u){Et(t.state,u)}}}keydown(t,n){if(this.lastKeyCode=n.keyCode,this.lastKeyTime=Date.now(),n.keyCode==9&&Date.now()<this.lastEscPress+2e3)return!0;if(U.android&&U.chrome&&!n.synthetic&&(n.keyCode==13||n.keyCode==8))return t.observer.delayAndroidKey(n.key,n.keyCode),!0;let o;return U.ios&&(o=sn.find(h=>h.keyCode==n.keyCode))&&!(n.ctrlKey||n.altKey||n.metaKey)&&!n.synthetic?(this.pendingIOSKey=o,setTimeout(()=>this.flushIOSKey(t),250),!0):!1}flushIOSKey(t){let n=this.pendingIOSKey;return n?(this.pendingIOSKey=void 0,at(t.contentDOM,n.key,n.keyCode)):!1}ignoreDuringComposition(t){return/^key/.test(t.type)?this.composing>0?!0:U.safari&&Date.now()-this.compositionEndedAt<100?(this.compositionEndedAt=0,!0):!1:!1}mustFlushObserver(t){return t.type=="keydown"&&t.keyCode!=229||t.type=="compositionend"&&!U.ios}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.mouseSelection&&this.mouseSelection.update(t),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const sn=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],kn=[16,17,18,20,91,92,224,225];class Qs{constructor(t,n,o,h){this.view=t,this.style=o,this.mustSelect=h,this.lastEvent=n;let u=t.contentDOM.ownerDocument;u.addEventListener("mousemove",this.move=this.move.bind(this)),u.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=n.shiftKey,this.multiple=t.state.facet(T.yy.allowMultipleSelections)&&vn(t,n),this.dragMove=uo(t,n),this.dragging=Ml(t,n)&&ns(n)==1?null:!1,this.dragging===!1&&(n.preventDefault(),this.select(n))}move(t){if(t.buttons==0)return this.destroy();this.dragging===!1&&this.select(this.lastEvent=t)}up(t){this.dragging==null&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(t){let n=this.style.get(t,this.extend,this.multiple);(this.mustSelect||!n.eq(this.view.state.selection)||n.main.assoc!=this.view.state.selection.main.assoc)&&this.view.dispatch({selection:n,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(t){t.docChanged&&this.dragging&&(this.dragging=this.dragging.map(t.changes)),this.style.update(t)&&setTimeout(()=>this.select(this.lastEvent),20)}}function vn(a,t){let n=a.state.facet(ye);return n.length?n[0](t):U.mac?t.metaKey:t.ctrlKey}function uo(a,t){let n=a.state.facet(Yi);return n.length?n[0](t):U.mac?!t.altKey:!t.ctrlKey}function Ml(a,t){let{main:n}=a.state.selection;if(n.empty)return!1;let o=Pe(a.root);if(o.rangeCount==0)return!0;let h=o.getRangeAt(0).getClientRects();for(let u=0;u<h.length;u++){let m=h[u];if(m.left<=t.clientX&&m.right>=t.clientX&&m.top<=t.clientY&&m.bottom>=t.clientY)return!0}return!1}function Ys(a,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let n=t.target,o;n!=a.contentDOM;n=n.parentNode)if(!n||n.nodeType==11||(o=de.get(n))&&o.ignoreEvent(t))return!1;return!0}const Ke=Object.create(null),Zs=U.ie&&U.ie_version<15||U.ios&&U.webkit_version<604;function po(a){let t=a.dom.parentNode;if(!t)return;let n=t.appendChild(document.createElement("textarea"));n.style.cssText="position: fixed; left: -10000px; top: 10px",n.focus(),setTimeout(()=>{a.focus(),n.remove(),es(a,n.value)},50)}function es(a,t){let{state:n}=a,o,h=1,u=n.toText(t),m=u.lines==n.selection.ranges.length;if(rs!=null&&n.selection.ranges.every(x=>x.empty)&&rs==u.toString()){let x=-1;o=n.changeByRange(A=>{let D=n.doc.lineAt(A.from);if(D.from==x)return{range:A};x=D.from;let P=n.toText((m?u.line(h++).text:t)+n.lineBreak);return{changes:{from:D.from,insert:P},range:T.jT.cursor(A.from+P.length)}})}else m?o=n.changeByRange(x=>{let A=u.line(h++);return{changes:{from:x.from,to:x.to,insert:A.text},range:T.jT.cursor(x.from+A.length)}}):o=n.replaceSelection(u);a.dispatch(o,{userEvent:"input.paste",scrollIntoView:!0})}Ke.keydown=(a,t)=>{a.inputState.setSelectionOrigin("select"),t.keyCode==27?a.inputState.lastEscPress=Date.now():kn.indexOf(t.keyCode)<0&&(a.inputState.lastEscPress=0)};let ts=0;Ke.touchstart=(a,t)=>{ts=Date.now(),a.inputState.setSelectionOrigin("select.pointer")},Ke.touchmove=a=>{a.inputState.setSelectionOrigin("select.pointer")},Ke.mousedown=(a,t)=>{if(a.observer.flush(),ts>Date.now()-2e3&&ns(t)==1)return;let n=null;for(let o of a.state.facet(Ue))if(n=o(a,t),n)break;if(!n&&t.button==0&&(n=bo(a,t)),n){let o=a.root.activeElement!=a.contentDOM;o&&a.observer.ignore(()=>Xe(a.contentDOM)),a.inputState.startMouseSelection(new Qs(a,t,n,o))}};function is(a,t,n,o){if(o==1)return T.jT.cursor(t,n);if(o==2)return xn(a.state,t,n);{let h=be.find(a.docView,t),u=a.state.doc.lineAt(h?h.posAtEnd:t),m=h?h.posAtStart:u.from,b=h?h.posAtEnd:u.to;return b<a.state.doc.length&&b==u.to&&b++,T.jT.range(m,b)}}let er=(a,t)=>a>=t.top&&a<=t.bottom,tr=(a,t,n)=>er(t,n)&&a>=n.left&&a<=n.right;function mo(a,t,n,o){let h=be.find(a.docView,t);if(!h)return 1;let u=t-h.posAtStart;if(u==0)return 1;if(u==h.length)return-1;let m=h.coordsAt(u,-1);if(m&&tr(n,o,m))return-1;let b=h.coordsAt(u,1);return b&&tr(n,o,b)?1:m&&er(o,m)?-1:1}function go(a,t){let n=a.posAtCoords({x:t.clientX,y:t.clientY},!1);return{pos:n,bias:mo(a,n,t.clientX,t.clientY)}}const yo=U.ie&&U.ie_version<=11;let ir=null,Sn=0,Vt=0;function ns(a){if(!yo)return a.detail;let t=ir,n=Vt;return ir=a,Vt=Date.now(),Sn=!t||n>Date.now()-400&&Math.abs(t.clientX-a.clientX)<2&&Math.abs(t.clientY-a.clientY)<2?(Sn+1)%3:1}function bo(a,t){let n=go(a,t),o=ns(t),h=a.state.selection,u=n,m=t;return{update(b){b.docChanged&&(n&&(n.pos=b.changes.mapPos(n.pos)),h=h.map(b.changes),m=null)},get(b,x,A){let D;if(m&&b.clientX==m.clientX&&b.clientY==m.clientY?D=u:(D=u=go(a,b),m=b),!D||!n)return h;let P=is(a,D.pos,D.bias,o);if(n.pos!=D.pos&&!x){let V=is(a,n.pos,n.bias,o),N=Math.min(V.from,P.from),F=Math.max(V.to,P.to);P=N<P.from?T.jT.range(N,F):T.jT.range(F,N)}return x?h.replaceRange(h.main.extend(P.from,P.to)):A?h.addRange(P):T.jT.create([P])}}}Ke.dragstart=(a,t)=>{let{selection:{main:n}}=a.state,{mouseSelection:o}=a.inputState;o&&(o.dragging=n),t.dataTransfer&&(t.dataTransfer.setData("Text",a.state.sliceDoc(n.from,n.to)),t.dataTransfer.effectAllowed="copyMove")};function ss(a,t,n,o){if(!n)return;let h=a.posAtCoords({x:t.clientX,y:t.clientY},!1);t.preventDefault();let{mouseSelection:u}=a.inputState,m=o&&u&&u.dragging&&u.dragMove?{from:u.dragging.from,to:u.dragging.to}:null,b={from:h,insert:n},x=a.state.changes(m?[m,b]:b);a.focus(),a.dispatch({changes:x,selection:{anchor:x.mapPos(h,-1),head:x.mapPos(h,1)},userEvent:m?"move.drop":"input.drop"})}Ke.drop=(a,t)=>{if(!t.dataTransfer)return;if(a.state.readOnly)return t.preventDefault();let n=t.dataTransfer.files;if(n&&n.length){t.preventDefault();let o=Array(n.length),h=0,u=()=>{++h==n.length&&ss(a,t,o.filter(m=>m!=null).join(a.state.lineBreak),!1)};for(let m=0;m<n.length;m++){let b=new FileReader;b.onerror=u,b.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(b.result)||(o[m]=b.result),u()},b.readAsText(n[m])}}else ss(a,t,t.dataTransfer.getData("Text"),!0)},Ke.paste=(a,t)=>{if(a.state.readOnly)return t.preventDefault();a.observer.flush();let n=Zs?null:t.clipboardData;n?(es(a,n.getData("text/plain")),t.preventDefault()):po(a)};function nr(a,t){let n=a.dom.parentNode;if(!n)return;let o=n.appendChild(document.createElement("textarea"));o.style.cssText="position: fixed; left: -10000px; top: 10px",o.value=t,o.focus(),o.selectionEnd=t.length,o.selectionStart=0,setTimeout(()=>{o.remove(),a.focus()},50)}function wo(a){let t=[],n=[],o=!1;for(let h of a.selection.ranges)h.empty||(t.push(a.sliceDoc(h.from,h.to)),n.push(h));if(!t.length){let h=-1;for(let{from:u}of a.selection.ranges){let m=a.doc.lineAt(u);m.number>h&&(t.push(m.text),n.push({from:m.from,to:Math.min(a.doc.length,m.to+1)})),h=m.number}o=!0}return{text:t.join(a.lineBreak),ranges:n,linewise:o}}let rs=null;Ke.copy=Ke.cut=(a,t)=>{let{text:n,ranges:o,linewise:h}=wo(a.state);if(!n&&!h)return;rs=h?n:null;let u=Zs?null:t.clipboardData;u?(t.preventDefault(),u.clearData(),u.setData("text/plain",n)):nr(a,n),t.type=="cut"&&!a.state.readOnly&&a.dispatch({changes:o,scrollIntoView:!0,userEvent:"delete.cut"})};function os(a){setTimeout(()=>{a.hasFocus!=a.inputState.notifiedFocused&&a.update([])},10)}Ke.focus=os,Ke.blur=a=>{a.observer.clearSelectionRange(),os(a)};function Cn(a,t){if(a.docView.compositionDeco.size){a.inputState.rapidCompositionStart=t;try{a.update([])}finally{a.inputState.rapidCompositionStart=!1}}}Ke.compositionstart=Ke.compositionupdate=a=>{a.inputState.compositionFirstChange==null&&(a.inputState.compositionFirstChange=!0),a.inputState.composing<0&&(a.inputState.composing=0,a.docView.compositionDeco.size&&(a.observer.flush(),Cn(a,!0)))},Ke.compositionend=a=>{a.inputState.composing=-1,a.inputState.compositionEndedAt=Date.now(),a.inputState.compositionFirstChange=null,setTimeout(()=>{a.inputState.composing<0&&Cn(a,!1)},50)},Ke.contextmenu=a=>{a.inputState.lastContextMenu=Date.now()},Ke.beforeinput=(a,t)=>{var n;let o;if(U.chrome&&U.android&&(o=sn.find(h=>h.inputType==t.inputType))&&(a.observer.delayAndroidKey(o.key,o.keyCode),o.key=="Backspace"||o.key=="Delete")){let h=((n=window.visualViewport)===null||n===void 0?void 0:n.height)||0;setTimeout(()=>{var u;(((u=window.visualViewport)===null||u===void 0?void 0:u.height)||0)>h+10&&a.hasFocus&&(a.contentDOM.blur(),a.focus())},100)}};const ls=["pre-wrap","normal","pre-line","break-spaces"];class sr{constructor(){this.doc=T.xv.empty,this.lineWrapping=!1,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(t,n){let o=this.doc.lineAt(n).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(o+=Math.ceil((n-t-o*this.lineLength*.5)/this.lineLength)),this.lineHeight*o}heightForLine(t){return this.lineWrapping?(1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForWrapping(t){return ls.indexOf(t)>-1!=this.lineWrapping}mustRefreshForHeights(t){let n=!1;for(let o=0;o<t.length;o++){let h=t[o];h<0?o++:this.heightSamples[Math.floor(h*10)]||(n=!0,this.heightSamples[Math.floor(h*10)]=!0)}return n}refresh(t,n,o,h,u){let m=ls.indexOf(t)>-1,b=Math.round(n)!=Math.round(this.lineHeight)||this.lineWrapping!=m;if(this.lineWrapping=m,this.lineHeight=n,this.charWidth=o,this.lineLength=h,b){this.heightSamples={};for(let x=0;x<u.length;x++){let A=u[x];A<0?x++:this.heightSamples[Math.floor(A*10)]=!0}}return b}}class rr{constructor(t,n){this.from=t,this.heights=n,this.index=0}get more(){return this.index<this.heights.length}}class Qt{constructor(t,n,o,h,u){this.from=t,this.length=n,this.top=o,this.height=h,this.type=u}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(t){let n=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(t.type)?t.type:[t]);return new Qt(this.from,this.length+t.length,this.top,this.height+t.height,n)}}var we=function(a){return a[a.ByPos=0]="ByPos",a[a.ByHeight=1]="ByHeight",a[a.ByPosNoHeight=2]="ByPosNoHeight",a}(we||(we={}));const hi=.001;class rt{constructor(t,n,o=2){this.length=t,this.height=n,this.flags=o}get outdated(){return(this.flags&2)>0}set outdated(t){this.flags=(t?2:0)|this.flags&-3}setHeight(t,n){this.height!=n&&(Math.abs(this.height-n)>hi&&(t.heightChanged=!0),this.height=n)}replace(t,n,o){return rt.of(o)}decomposeLeft(t,n){n.push(this)}decomposeRight(t,n){n.push(this)}applyChanges(t,n,o,h){let u=this;for(let m=h.length-1;m>=0;m--){let{fromA:b,toA:x,fromB:A,toB:D}=h[m],P=u.lineAt(b,we.ByPosNoHeight,n,0,0),V=P.to>=x?P:u.lineAt(x,we.ByPosNoHeight,n,0,0);for(D+=V.to-x,x=V.to;m>0&&P.from<=h[m-1].toA;)b=h[m-1].fromA,A=h[m-1].fromB,m--,b<P.from&&(P=u.lineAt(b,we.ByPosNoHeight,n,0,0));A+=P.from-b,b=P.from;let N=hs.build(o,t,A,D);u=u.replace(b,x,N)}return u.updateHeight(o,0)}static empty(){return new ut(0,0)}static of(t){if(t.length==1)return t[0];let n=0,o=t.length,h=0,u=0;for(;;)if(n==o)if(h>u*2){let b=t[n-1];b.break?t.splice(--n,1,b.left,null,b.right):t.splice(--n,1,b.left,b.right),o+=1+b.break,h-=b.size}else if(u>h*2){let b=t[o];b.break?t.splice(o,1,b.left,null,b.right):t.splice(o,1,b.left,b.right),o+=2+b.break,u-=b.size}else break;else if(h<u){let b=t[n++];b&&(h+=b.size)}else{let b=t[--o];b&&(u+=b.size)}let m=0;return t[n-1]==null?(m=1,n--):t[n]==null&&(m=1,o++),new xo(rt.of(t.slice(0,n)),m,rt.of(t.slice(o)))}}rt.prototype.size=1;class as extends rt{constructor(t,n,o){super(t,n),this.type=o}blockAt(t,n,o,h){return new Qt(h,this.length,o,this.height,this.type)}lineAt(t,n,o,h,u){return this.blockAt(0,o,h,u)}forEachLine(t,n,o,h,u,m){t<=u+this.length&&n>=u&&m(this.blockAt(0,o,h,u))}updateHeight(t,n=0,o=!1,h){return h&&h.from<=n&&h.more&&this.setHeight(t,h.heights[h.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class ut extends as{constructor(t,n){super(t,n,fe.Text),this.collapsed=0,this.widgetHeight=0}replace(t,n,o){let h=o[0];return o.length==1&&(h instanceof ut||h instanceof _e&&h.flags&4)&&Math.abs(this.length-h.length)<10?(h instanceof _e?h=new ut(h.length,this.height):h.height=this.height,this.outdated||(h.outdated=!1),h):rt.of(o)}updateHeight(t,n=0,o=!1,h){return h&&h.from<=n&&h.more?this.setHeight(t,h.heights[h.index++]):(o||this.outdated)&&this.setHeight(t,Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class _e extends rt{constructor(t){super(t,0)}lines(t,n){let o=t.lineAt(n).number,h=t.lineAt(n+this.length).number;return{firstLine:o,lastLine:h,lineHeight:this.height/(h-o+1)}}blockAt(t,n,o,h){let{firstLine:u,lastLine:m,lineHeight:b}=this.lines(n,h),x=Math.max(0,Math.min(m-u,Math.floor((t-o)/b))),{from:A,length:D}=n.line(u+x);return new Qt(A,D,o+b*x,b,fe.Text)}lineAt(t,n,o,h,u){if(n==we.ByHeight)return this.blockAt(t,o,h,u);if(n==we.ByPosNoHeight){let{from:P,to:V}=o.lineAt(t);return new Qt(P,V-P,0,0,fe.Text)}let{firstLine:m,lineHeight:b}=this.lines(o,u),{from:x,length:A,number:D}=o.lineAt(t);return new Qt(x,A,h+b*(D-m),b,fe.Text)}forEachLine(t,n,o,h,u,m){let{firstLine:b,lineHeight:x}=this.lines(o,u);for(let A=Math.max(t,u),D=Math.min(u+this.length,n);A<=D;){let P=o.lineAt(A);A==t&&(h+=x*(P.number-b)),m(new Qt(P.from,P.length,h,x,fe.Text)),h+=x,A=P.to+1}}replace(t,n,o){let h=this.length-n;if(h>0){let u=o[o.length-1];u instanceof _e?o[o.length-1]=new _e(u.length+h):o.push(null,new _e(h-1))}if(t>0){let u=o[0];u instanceof _e?o[0]=new _e(t+u.length):o.unshift(new _e(t-1),null)}return rt.of(o)}decomposeLeft(t,n){n.push(new _e(t-1),null)}decomposeRight(t,n){n.push(null,new _e(this.length-t-1))}updateHeight(t,n=0,o=!1,h){let u=n+this.length;if(h&&h.from<=n+this.length&&h.more){let m=[],b=Math.max(n,h.from),x=-1,A=t.heightChanged;for(h.from>n&&m.push(new _e(h.from-n-1).updateHeight(t,n));b<=u&&h.more;){let P=t.doc.lineAt(b).length;m.length&&m.push(null);let V=h.heights[h.index++];x==-1?x=V:Math.abs(V-x)>=hi&&(x=-2);let N=new ut(P,V);N.outdated=!1,m.push(N),b+=P+1}b<=u&&m.push(null,new _e(u-b).updateHeight(t,b));let D=rt.of(m);return t.heightChanged=A||x<0||Math.abs(D.height-this.height)>=hi||Math.abs(x-this.lines(t.doc,n).lineHeight)>=hi,D}else(o||this.outdated)&&(this.setHeight(t,t.heightForGap(n,n+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class xo extends rt{constructor(t,n,o){super(t.length+n+o.length,t.height+o.height,n|(t.outdated||o.outdated?2:0)),this.left=t,this.right=o,this.size=t.size+o.size}get break(){return this.flags&1}blockAt(t,n,o,h){let u=o+this.left.height;return t<u?this.left.blockAt(t,n,o,h):this.right.blockAt(t,n,u,h+this.left.length+this.break)}lineAt(t,n,o,h,u){let m=h+this.left.height,b=u+this.left.length+this.break,x=n==we.ByHeight?t<m:t<b,A=x?this.left.lineAt(t,n,o,h,u):this.right.lineAt(t,n,o,m,b);if(this.break||(x?A.to<b:A.from>b))return A;let D=n==we.ByPosNoHeight?we.ByPosNoHeight:we.ByPos;return x?A.join(this.right.lineAt(b,D,o,m,b)):this.left.lineAt(b,D,o,h,u).join(A)}forEachLine(t,n,o,h,u,m){let b=h+this.left.height,x=u+this.left.length+this.break;if(this.break)t<x&&this.left.forEachLine(t,n,o,h,u,m),n>=x&&this.right.forEachLine(t,n,o,b,x,m);else{let A=this.lineAt(x,we.ByPos,o,h,u);t<A.from&&this.left.forEachLine(t,A.from-1,o,h,u,m),A.to>=t&&A.from<=n&&m(A),n>A.to&&this.right.forEachLine(A.to+1,n,o,b,x,m)}}replace(t,n,o){let h=this.left.length+this.break;if(n<h)return this.balanced(this.left.replace(t,n,o),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-h,n-h,o));let u=[];t>0&&this.decomposeLeft(t,u);let m=u.length;for(let b of o)u.push(b);if(t>0&&An(u,m-1),n<this.length){let b=u.length;this.decomposeRight(n,u),An(u,b)}return rt.of(u)}decomposeLeft(t,n){let o=this.left.length;if(t<=o)return this.left.decomposeLeft(t,n);n.push(this.left),this.break&&(o++,t>=o&&n.push(null)),t>o&&this.right.decomposeLeft(t-o,n)}decomposeRight(t,n){let o=this.left.length,h=o+this.break;if(t>=h)return this.right.decomposeRight(t-h,n);t<o&&this.left.decomposeRight(t,n),this.break&&t<h&&n.push(null),n.push(this.right)}balanced(t,n){return t.size>2*n.size||n.size>2*t.size?rt.of(this.break?[t,null,n]:[t,n]):(this.left=t,this.right=n,this.height=t.height+n.height,this.outdated=t.outdated||n.outdated,this.size=t.size+n.size,this.length=t.length+this.break+n.length,this)}updateHeight(t,n=0,o=!1,h){let{left:u,right:m}=this,b=n+u.length+this.break,x=null;return h&&h.from<=n+u.length&&h.more?x=u=u.updateHeight(t,n,o,h):u.updateHeight(t,n,o),h&&h.from<=b+m.length&&h.more?x=m=m.updateHeight(t,b,o,h):m.updateHeight(t,b,o),x?this.balanced(u,m):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function An(a,t){let n,o;a[t]==null&&(n=a[t-1])instanceof _e&&(o=a[t+1])instanceof _e&&a.splice(t-1,3,new _e(n.length+1+o.length))}const or=5;class hs{constructor(t,n){this.pos=t,this.oracle=n,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,n){if(this.lineStart>-1){let o=Math.min(n,this.lineEnd),h=this.nodes[this.nodes.length-1];h instanceof ut?h.length+=o-this.pos:(o>this.pos||!this.isCovered)&&this.nodes.push(new ut(o-this.pos,-1)),this.writtenTo=o,n>o&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=n}point(t,n,o){if(t<n||o.heightRelevant){let h=o.widget?o.widget.estimatedHeight:0;h<0&&(h=this.oracle.lineHeight);let u=n-t;o.block?this.addBlock(new as(u,h,o.type)):(u||h>=or)&&this.addLineDeco(h,u)}else n>t&&this.span(t,n);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:n}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=n,this.writtenTo<t&&((this.writtenTo<t-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new ut(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,n){let o=new _e(n-t);return this.oracle.doc.lineAt(t).to==n&&(o.flags|=4),o}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof ut)return t;let n=new ut(0,-1);return this.nodes.push(n),n}addBlock(t){this.enterLine(),t.type==fe.WidgetAfter&&!this.isCovered&&this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,t.type!=fe.WidgetBefore&&(this.covering=t)}addLineDeco(t,n){let o=this.ensureLine();o.length+=n,o.collapsed+=n,o.widgetHeight=Math.max(o.widgetHeight,t),this.writtenTo=this.pos=this.pos+n}finish(t){let n=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(n instanceof ut)&&!this.isCovered?this.nodes.push(new ut(0,-1)):(this.writtenTo<this.pos||n==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let o=t;for(let h of this.nodes)h instanceof ut&&h.updateHeight(this.oracle,o),o+=h?h.length:1;return this.nodes}static build(t,n,o,h){let u=new hs(o,t);return T.Xs.spans(n,o,h,u,0),u.finish(o)}}function ko(a,t,n){let o=new cs;return T.Xs.compare(a,t,n,o,0),o.changes}class cs{constructor(){this.changes=[]}compareRange(){}comparePoint(t,n,o,h){(t<n||o&&o.heightRelevant||h&&h.heightRelevant)&&ct(t,n,this.changes,5)}}function vo(a,t){let n=a.getBoundingClientRect(),o=Math.max(0,n.left),h=Math.min(innerWidth,n.right),u=Math.max(0,n.top),m=Math.min(innerHeight,n.bottom),b=a.ownerDocument.body;for(let x=a.parentNode;x&&x!=b;)if(x.nodeType==1){let A=x,D=window.getComputedStyle(A);if((A.scrollHeight>A.clientHeight||A.scrollWidth>A.clientWidth)&&D.overflow!="visible"){let P=A.getBoundingClientRect();o=Math.max(o,P.left),h=Math.min(h,P.right),u=Math.max(u,P.top),m=Math.min(m,P.bottom)}x=D.position=="absolute"||D.position=="fixed"?A.offsetParent:A.parentNode}else if(x.nodeType==11)x=x.host;else break;return{left:o-n.left,right:Math.max(o,h)-n.left,top:u-(n.top+t),bottom:Math.max(u,m)-(n.top+t)}}function Tl(a,t){let n=a.getBoundingClientRect();return{left:0,right:n.right-n.left,top:t,bottom:n.bottom-(n.top+t)}}class lr{constructor(t,n,o){this.from=t,this.to=n,this.size=o}static same(t,n){if(t.length!=n.length)return!1;for(let o=0;o<t.length;o++){let h=t[o],u=n[o];if(h.from!=u.from||h.to!=u.to||h.size!=u.size)return!1}return!0}draw(t){return oe.replace({widget:new So(this.size,t)}).range(this.from,this.to)}}class So extends ce{constructor(t,n){super(),this.size=t,this.vertical=n}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}}class Co{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new sr,this.scaler=us,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=p.RTL,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.stateDeco=t.facet(Nt).filter(n=>typeof n!="function"),this.heightMap=rt.empty().applyChanges(this.stateDeco,T.xv.empty,this.heightOracle.setDoc(t.doc),[new C(0,0,0,t.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=oe.set(this.lineGaps.map(n=>n.draw(!1))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:n}=this.state.selection;for(let o=0;o<=1;o++){let h=o?n.head:n.anchor;if(!t.some(({from:u,to:m})=>h>=u&&h<=m)){let{from:u,to:m}=this.lineBlockAt(h);t.push(new fs(u,m))}}this.viewports=t.sort((o,h)=>o.from-h.from),this.scaler=this.heightMap.height<=7e6?us:new To(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,t=>{this.viewportLines.push(this.scaler.scale==1?t:vi(t,this.scaler))})}update(t,n=null){this.state=t.state;let o=this.stateDeco;this.stateDeco=this.state.facet(Nt).filter(A=>typeof A!="function");let h=t.changedRanges,u=C.extendWithRanges(h,ko(o,this.stateDeco,t?t.changes:T.as.empty(this.state.doc.length))),m=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(this.stateDeco,t.startState.doc,this.heightOracle.setDoc(this.state.doc),u),this.heightMap.height!=m&&(t.flags|=2);let b=u.length?this.mapViewport(this.viewport,t.changes):this.viewport;(n&&(n.range.head<b.from||n.range.head>b.to)||!this.viewportIsAppropriate(b))&&(b=this.getViewport(0,n));let x=!t.changes.empty||t.flags&2||b.from!=this.viewport.from||b.to!=this.viewport.to;this.viewport=b,this.updateForViewport(),x&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(),n&&(this.scrollTarget=n),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(t){let n=t.contentDOM,o=window.getComputedStyle(n),h=this.heightOracle,u=o.whiteSpace;this.defaultTextDirection=o.direction=="rtl"?p.RTL:p.LTR;let m=this.heightOracle.mustRefreshForWrapping(u),b=m||this.mustMeasureContent||this.contentDOMHeight!=n.clientHeight;this.contentDOMHeight=n.clientHeight,this.mustMeasureContent=!1;let x=0,A=0,D=parseInt(o.paddingTop)||0,P=parseInt(o.paddingBottom)||0;(this.paddingTop!=D||this.paddingBottom!=P)&&(this.paddingTop=D,this.paddingBottom=P,x|=10),this.editorWidth!=t.scrollDOM.clientWidth&&(h.lineWrapping&&(b=!0),this.editorWidth=t.scrollDOM.clientWidth,x|=8);let V=(this.printing?Tl:vo)(n,this.paddingTop),N=V.top-this.pixelViewport.top,F=V.bottom-this.pixelViewport.bottom;this.pixelViewport=V;let _=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(_!=this.inView&&(this.inView=_,_&&(b=!0)),!this.inView)return 0;let J=n.clientWidth;if((this.contentDOMWidth!=J||this.editorHeight!=t.scrollDOM.clientHeight)&&(this.contentDOMWidth=J,this.editorHeight=t.scrollDOM.clientHeight,x|=8),b){let Me=t.docView.measureVisibleLineHeights(this.viewport);if(h.mustRefreshForHeights(Me)&&(m=!0),m||h.lineWrapping&&Math.abs(J-this.contentDOMWidth)>h.charWidth){let{lineHeight:le,charWidth:se}=t.docView.measureTextSize();m=h.refresh(u,le,se,J/se,Me),m&&(t.docView.minWidth=0,x|=8)}N>0&&F>0?A=Math.max(N,F):N<0&&F<0&&(A=Math.min(N,F)),h.heightChanged=!1;for(let le of this.viewports){let se=le.from==this.viewport.from?Me:t.docView.measureVisibleLineHeights(le);this.heightMap=this.heightMap.updateHeight(h,0,m,new rr(le.from,se))}h.heightChanged&&(x|=2)}let X=!this.viewportIsAppropriate(this.viewport,A)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return X&&(this.viewport=this.getViewport(A,this.scrollTarget)),this.updateForViewport(),(x&2||X)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(m?[]:this.lineGaps)),x|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),x}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,n){let o=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),h=this.heightMap,u=this.state.doc,{visibleTop:m,visibleBottom:b}=this,x=new fs(h.lineAt(m-o*1e3,we.ByHeight,u,0,0).from,h.lineAt(b+(1-o)*1e3,we.ByHeight,u,0,0).to);if(n){let{head:A}=n.range;if(A<x.from||A>x.to){let D=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),P=h.lineAt(A,we.ByPos,u,0,0),V;n.y=="center"?V=(P.top+P.bottom)/2-D/2:n.y=="start"||n.y=="nearest"&&A<x.from?V=P.top:V=P.bottom-D,x=new fs(h.lineAt(V-1e3/2,we.ByHeight,u,0,0).from,h.lineAt(V+D+1e3/2,we.ByHeight,u,0,0).to)}}return x}mapViewport(t,n){let o=n.mapPos(t.from,-1),h=n.mapPos(t.to,1);return new fs(this.heightMap.lineAt(o,we.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(h,we.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:t,to:n},o=0){if(!this.inView)return!0;let{top:h}=this.heightMap.lineAt(t,we.ByPos,this.state.doc,0,0),{bottom:u}=this.heightMap.lineAt(n,we.ByPos,this.state.doc,0,0),{visibleTop:m,visibleBottom:b}=this;return(t==0||h<=m-Math.max(10,Math.min(-o,250)))&&(n==this.state.doc.length||u>=b+Math.max(10,Math.min(o,250)))&&h>m-2*1e3&&u<b+2*1e3}mapLineGaps(t,n){if(!t.length||n.empty)return t;let o=[];for(let h of t)n.touchesRange(h.from,h.to)||o.push(new lr(n.mapPos(h.from),n.mapPos(h.to),h.size));return o}ensureLineGaps(t){let n=[];if(this.defaultTextDirection!=p.LTR)return n;for(let o of this.viewportLines){if(o.length<4e3)continue;let h=Ao(o.from,o.to,this.stateDeco);if(h.total<4e3)continue;let u,m;if(this.heightOracle.lineWrapping){let A=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;u=Vi(h,(this.visibleTop-o.top-A)/o.height),m=Vi(h,(this.visibleBottom-o.top+A)/o.height)}else{let A=h.total*this.heightOracle.charWidth,D=2e3*this.heightOracle.charWidth;u=Vi(h,(this.pixelViewport.left-D)/A),m=Vi(h,(this.pixelViewport.right+D)/A)}let b=[];u>o.from&&b.push({from:o.from,to:u}),m<o.to&&b.push({from:m,to:o.to});let x=this.state.selection.main;x.from>=o.from&&x.from<=o.to&&ar(b,x.from-10,x.from+10),!x.empty&&x.to>=o.from&&x.to<=o.to&&ar(b,x.to-10,x.to+10);for(let{from:A,to:D}of b)D-A>1e3&&n.push(Mo(t,P=>P.from>=o.from&&P.to<=o.to&&Math.abs(P.from-A)<1e3&&Math.abs(P.to-D)<1e3)||new lr(A,D,this.gapSize(o,A,D,h)))}return n}gapSize(t,n,o,h){let u=Fi(h,o)-Fi(h,n);return this.heightOracle.lineWrapping?t.height*u:h.total*this.heightOracle.charWidth*u}updateLineGaps(t){lr.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=oe.set(t.map(n=>n.draw(this.heightOracle.lineWrapping))))}computeVisibleRanges(){let t=this.stateDeco;this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let n=[];T.Xs.spans(t,this.viewport.from,this.viewport.to,{span(h,u){n.push({from:h,to:u})},point(){}},20);let o=n.length!=this.visibleRanges.length||this.visibleRanges.some((h,u)=>h.from!=n[u].from||h.to!=n[u].to);return this.visibleRanges=n,o?4:0}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find(n=>n.from<=t&&n.to>=t)||vi(this.heightMap.lineAt(t,we.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(t){return vi(this.heightMap.lineAt(this.scaler.fromDOM(t),we.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(t){return vi(this.heightMap.blockAt(this.scaler.fromDOM(t),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class fs{constructor(t,n){this.from=t,this.to=n}}function Ao(a,t,n){let o=[],h=a,u=0;return T.Xs.spans(n,a,t,{span(){},point(m,b){m>h&&(o.push({from:h,to:m}),u+=m-h),h=b}},20),h<t&&(o.push({from:h,to:t}),u+=t-h),{total:u,ranges:o}}function Vi({total:a,ranges:t},n){if(n<=0)return t[0].from;if(n>=1)return t[t.length-1].to;let o=Math.floor(a*n);for(let h=0;;h++){let{from:u,to:m}=t[h],b=m-u;if(o<=b)return u+o;o-=b}}function Fi(a,t){let n=0;for(let{from:o,to:h}of a.ranges){if(t<=h){n+=t-o;break}n+=h-o}return n/a.total}function ar(a,t,n){for(let o=0;o<a.length;o++){let h=a[o];if(h.from<n&&h.to>t){let u=[];h.from<t&&u.push({from:h.from,to:t}),h.to>n&&u.push({from:n,to:h.to}),a.splice(o,1,...u),o+=u.length-1}}}function Mo(a,t){for(let n of a)if(t(n))return n}const us={toDOM(a){return a},fromDOM(a){return a},scale:1};class To{constructor(t,n,o){let h=0,u=0,m=0;this.viewports=o.map(({from:b,to:x})=>{let A=n.lineAt(b,we.ByPos,t,0,0).top,D=n.lineAt(x,we.ByPos,t,0,0).bottom;return h+=D-A,{from:b,to:x,top:A,bottom:D,domTop:0,domBottom:0}}),this.scale=(7e6-h)/(n.height-h);for(let b of this.viewports)b.domTop=m+(b.top-u)*this.scale,m=b.domBottom=b.domTop+(b.bottom-b.top),u=b.bottom}toDOM(t){for(let n=0,o=0,h=0;;n++){let u=n<this.viewports.length?this.viewports[n]:null;if(!u||t<u.top)return h+(t-o)*this.scale;if(t<=u.bottom)return u.domTop+(t-u.top);o=u.bottom,h=u.domBottom}}fromDOM(t){for(let n=0,o=0,h=0;;n++){let u=n<this.viewports.length?this.viewports[n]:null;if(!u||t<u.domTop)return o+(t-h)/this.scale;if(t<=u.domBottom)return u.top+(t-u.domTop);o=u.bottom,h=u.domBottom}}}function vi(a,t){if(t.scale==1)return a;let n=t.toDOM(a.top),o=t.toDOM(a.bottom);return new Qt(a.from,a.length,n,o-n,Array.isArray(a.type)?a.type.map(h=>vi(h,t)):a.type)}const Mn=T.r$.define({combine:a=>a.join(" ")}),ds=T.r$.define({combine:a=>a.indexOf(!0)>-1}),Tn=B.V.newName(),hr=B.V.newName(),Dn=B.V.newName(),cr={"&light":"."+hr,"&dark":"."+Dn};function fr(a,t,n){return new B.V(t,{finish(o){return/&/.test(o)?o.replace(/&\w*/,h=>{if(h=="&")return a;if(!n||!n[h])throw new RangeError(`Unsupported selector: ${h}`);return n[h]}):a+" "+o}})}const On=fr("."+Tn,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{display:"flex",height:"100%",boxSizing:"border-box",left:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},cr),ur={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},Pn=U.ie&&U.ie_version<=11;class Do{constructor(t,n,o){this.view=t,this.onChange=n,this.onScrollChanged=o,this.active=!1,this.selectionRange=new Bt,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver(h=>{for(let u of h)this.queue.push(u);(U.ie&&U.ie_version<=11||U.ios&&t.composing)&&h.some(u=>u.type=="childList"&&u.removedNodes.length||u.type=="characterData"&&u.oldValue.length>u.target.nodeValue.length)?this.flushSoon():this.flush()}),Pn&&(this.onCharData=h=>{this.queue.push({target:h.target,type:"characterData",oldValue:h.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),typeof ResizeObserver=="function"&&(this.resize=new ResizeObserver(()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()}),this.resize.observe(t.scrollDOM)),window.addEventListener("beforeprint",this.onPrint=this.onPrint.bind(this)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(h=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),h.length>0&&h[h.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(h=>{h.length>0&&h[h.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(t){this.intersecting&&this.flush(!1),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500)}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some((n,o)=>n!=t[o]))){this.gapIntersection.disconnect();for(let n of t)this.gapIntersection.observe(n);this.gaps=t}}onSelectionChange(t){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:n}=this,o=this.selectionRange;if(n.state.facet(oi)?n.root.activeElement!=this.dom:!Z(n.dom,o))return;let h=o.anchorNode&&n.docView.nearest(o.anchorNode);h&&h.ignoreEvent(t)||((U.ie&&U.ie_version<=11||U.android&&U.chrome)&&!n.state.selection.main.empty&&o.focusNode&&Ae(o.focusNode,o.focusOffset,o.anchorNode,o.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:t}=this.view,n=Pe(t),o=U.safari&&t.nodeType==11&&je()==this.view.contentDOM&&Dl(this.view)||n;return this.selectionRange.eq(o)?!1:(this.selectionRange.setRange(o),this.selectionChanged=!0)}setSelectionRange(t,n){this.selectionRange.set(t.node,t.offset,n.node,n.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let t=0,n=null;for(let o=this.dom;o;)if(o.nodeType==1)!n&&t<this.scrollTargets.length&&this.scrollTargets[t]==o?t++:n||(n=this.scrollTargets.slice(0,t)),n&&n.push(o),o=o.assignedSlot||o.parentNode;else if(o.nodeType==11)o=o.host;else break;if(t<this.scrollTargets.length&&!n&&(n=this.scrollTargets.slice(0,t)),n){for(let o of this.scrollTargets)o.removeEventListener("scroll",this.onScroll);for(let o of this.scrollTargets=n)o.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,ur),Pn&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),Pn&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,n){this.delayedAndroidKey||requestAnimationFrame(()=>{let o=this.delayedAndroidKey;this.delayedAndroidKey=null,this.delayedFlush=-1,this.flush()||at(this.view.contentDOM,o.key,o.keyCode)}),(!this.delayedAndroidKey||t=="Enter")&&(this.delayedAndroidKey={key:t,keyCode:n})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout(()=>{this.delayedFlush=-1,this.flush()},20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let t=this.queue;for(let u of this.observer.takeRecords())t.push(u);t.length&&(this.queue=[]);let n=-1,o=-1,h=!1;for(let u of t){let m=this.readMutation(u);m&&(m.typeOver&&(h=!0),n==-1?{from:n,to:o}=m:(n=Math.min(m.from,n),o=Math.max(m.to,o)))}return{from:n,to:o,typeOver:h}}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;t&&this.readSelectionRange();let{from:n,to:o,typeOver:h}=this.processRecords(),u=this.selectionChanged&&Z(this.dom,this.selectionRange);if(n<0&&!u)return;this.selectionChanged=!1;let m=this.view.state,b=this.onChange(n,o,h);return this.view.state==m&&this.view.update([]),b}readMutation(t){let n=this.view.docView.nearest(t.target);if(!n||n.ignoreMutation(t))return null;if(n.markDirty(t.type=="attributes"),t.type=="attributes"&&(n.dirty|=4),t.type=="childList"){let o=dr(n,t.previousSibling||t.target.previousSibling,-1),h=dr(n,t.nextSibling||t.target.nextSibling,1);return{from:o?n.posAfter(o):n.posAtStart,to:h?n.posBefore(h):n.posAtEnd,typeOver:!1}}else return t.type=="characterData"?{from:n.posAtStart,to:n.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}destroy(){var t,n,o;this.stop(),(t=this.intersection)===null||t===void 0||t.disconnect(),(n=this.gapIntersection)===null||n===void 0||n.disconnect(),(o=this.resize)===null||o===void 0||o.disconnect();for(let h of this.scrollTargets)h.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("beforeprint",this.onPrint),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}}function dr(a,t,n){for(;t;){let o=de.get(t);if(o&&o.parent==a)return o;let h=t.parentNode;t=h!=a.dom?h:n>0?t.nextSibling:t.previousSibling}return null}function Dl(a){let t=null;function n(x){x.preventDefault(),x.stopImmediatePropagation(),t=x.getTargetRanges()[0]}if(a.contentDOM.addEventListener("beforeinput",n,!0),document.execCommand("indent"),a.contentDOM.removeEventListener("beforeinput",n,!0),!t)return null;let o=t.startContainer,h=t.startOffset,u=t.endContainer,m=t.endOffset,b=a.docView.domAtPos(a.state.selection.main.anchor);return Ae(b.node,b.offset,u,m)&&([o,h,u,m]=[u,m,o,h]),{anchorNode:o,anchorOffset:h,focusNode:u,focusOffset:m}}function Ol(a,t,n,o){let h,u,m=a.state.selection.main;if(t>-1){let b=a.docView.domBoundsAround(t,n,0);if(!b||a.state.readOnly)return!1;let{from:x,to:A}=b,D=a.docView.impreciseHead||a.docView.impreciseAnchor?[]:dt(a),P=new Is(D,a.state);P.readRange(b.startDOM,b.endDOM);let V=m.from,N=null;(a.inputState.lastKeyCode===8&&a.inputState.lastKeyTime>Date.now()-100||U.android&&P.text.length<A-x)&&(V=m.to,N="end");let F=Pl(a.state.doc.sliceString(x,A,ki),P.text,V-x,N);F&&(U.chrome&&a.inputState.lastKeyCode==13&&F.toB==F.from+2&&P.text.slice(F.from,F.toB)==ki+ki&&F.toB--,h={from:x+F.from,to:x+F.toA,insert:T.xv.of(P.text.slice(F.from,F.toB).split(ki))}),u=Bn(D,x)}else if(a.hasFocus||!a.state.facet(oi)){let b=a.observer.selectionRange,{impreciseHead:x,impreciseAnchor:A}=a.docView,D=x&&x.node==b.focusNode&&x.offset==b.focusOffset||!he(a.contentDOM,b.focusNode)?a.state.selection.main.head:a.docView.posFromDOM(b.focusNode,b.focusOffset),P=A&&A.node==b.anchorNode&&A.offset==b.anchorOffset||!he(a.contentDOM,b.anchorNode)?a.state.selection.main.anchor:a.docView.posFromDOM(b.anchorNode,b.anchorOffset);(D!=m.head||P!=m.anchor)&&(u=T.jT.single(P,D))}if(!h&&!u)return!1;if(!h&&o&&!m.empty&&u&&u.main.empty?h={from:m.from,to:m.to,insert:a.state.doc.slice(m.from,m.to)}:h&&h.from>=m.from&&h.to<=m.to&&(h.from!=m.from||h.to!=m.to)&&m.to-m.from-(h.to-h.from)<=4?h={from:m.from,to:m.to,insert:a.state.doc.slice(m.from,h.from).append(h.insert).append(a.state.doc.slice(h.to,m.to))}:(U.mac||U.android)&&h&&h.from==h.to&&h.from==m.head-1&&h.insert.toString()=="."&&(h={from:m.from,to:m.to,insert:T.xv.of([" "])}),h){let b=a.state;if(U.ios&&a.inputState.flushIOSKey(a)||U.android&&(h.from==m.from&&h.to==m.to&&h.insert.length==1&&h.insert.lines==2&&at(a.contentDOM,"Enter",13)||h.from==m.from-1&&h.to==m.to&&h.insert.length==0&&at(a.contentDOM,"Backspace",8)||h.from==m.from&&h.to==m.to+1&&h.insert.length==0&&at(a.contentDOM,"Delete",46)))return!0;let x=h.insert.toString();if(a.state.facet(Le).some(P=>P(a,h.from,h.to,x)))return!0;a.inputState.composing>=0&&a.inputState.composing++;let A;if(h.from>=m.from&&h.to<=m.to&&h.to-h.from>=(m.to-m.from)/3&&(!u||u.main.empty&&u.main.from==h.from+h.insert.length)&&a.inputState.composing<0){let P=m.from<h.from?b.sliceDoc(m.from,h.from):"",V=m.to>h.to?b.sliceDoc(h.to,m.to):"";A=b.replaceSelection(a.state.toText(P+h.insert.sliceString(0,void 0,a.state.lineBreak)+V))}else{let P=b.changes(h),V=u&&!b.selection.main.eq(u.main)&&u.main.to<=P.newLength?u.main:void 0;if(b.selection.ranges.length>1&&a.inputState.composing>=0&&h.to<=m.to&&h.to>=m.to-10){let N=a.state.sliceDoc(h.from,h.to),F=Ws(a)||a.state.doc.lineAt(m.head),_=m.to-h.to,J=m.to-m.from;A=b.changeByRange(X=>{if(X.from==m.from&&X.to==m.to)return{changes:P,range:V||X.map(P)};let Me=X.to-_,le=Me-N.length;if(X.to-X.from!=J||a.state.sliceDoc(le,Me)!=N||F&&X.to>=F.from&&X.from<=F.to)return{range:X};let se=b.changes({from:le,to:Me,insert:h.insert}),He=X.to-m.to;return{changes:se,range:V?T.jT.range(Math.max(0,V.anchor+He),Math.max(0,V.head+He)):X.map(se)}})}else A={changes:P,selection:V&&b.selection.replaceRange(V)}}let D="input.type";return a.composing&&(D+=".compose",a.inputState.compositionFirstChange&&(D+=".start",a.inputState.compositionFirstChange=!1)),a.dispatch(A,{scrollIntoView:!0,userEvent:D}),!0}else if(u&&!u.main.eq(m)){let b=!1,x="select";return a.inputState.lastSelectionTime>Date.now()-50&&(a.inputState.lastSelectionOrigin=="select"&&(b=!0),x=a.inputState.lastSelectionOrigin),a.dispatch({selection:u,scrollIntoView:b,userEvent:x}),!0}else return!1}function Pl(a,t,n,o){let h=Math.min(a.length,t.length),u=0;for(;u<h&&a.charCodeAt(u)==t.charCodeAt(u);)u++;if(u==h&&a.length==t.length)return null;let m=a.length,b=t.length;for(;m>0&&b>0&&a.charCodeAt(m-1)==t.charCodeAt(b-1);)m--,b--;if(o=="end"){let x=Math.max(0,u-Math.min(m,b));n-=m+x-u}if(m<u&&a.length<t.length){let x=n<=u&&n>=m?u-n:0;u-=x,b=u+(b-m),m=u}else if(b<u){let x=n<=u&&n>=b?u-n:0;u-=x,m=u+(m-b),b=u}return{from:u,toA:m,toB:b}}function dt(a){let t=[];if(a.root.activeElement!=a.contentDOM)return t;let{anchorNode:n,anchorOffset:o,focusNode:h,focusOffset:u}=a.observer.selectionRange;return n&&(t.push(new Vs(n,o)),(h!=n||u!=o)&&t.push(new Vs(h,u))),t}function Bn(a,t){if(a.length==0)return null;let n=a[0].pos,o=a.length==2?a[1].pos:n;return n>-1&&o>-1?T.jT.single(n+t,o+t):null}class xe{constructor(t={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=t.dispatch||(n=>this.update([n])),this.dispatch=this.dispatch.bind(this),this.root=t.root||ti(t.parent)||document,this.viewState=new Co(t.state||T.yy.create()),this.plugins=this.state.facet(ft).map(n=>new It(n));for(let n of this.plugins)n.update(this);this.observer=new Do(this,(n,o,h)=>Ol(this,n,o,h),n=>{this.inputState.runScrollHandlers(this,n),this.observer.intersecting&&this.measure()}),this.inputState=new fo(this),this.inputState.ensureHandlers(this,this.plugins),this.docView=new Fs(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),t.parent&&t.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...t){this._dispatch(t.length==1&&t[0]instanceof T.YW?t[0]:this.state.update(...t))}update(t){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let n=!1,o=!1,h,u=this.state;for(let b of t){if(b.startState!=u)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");u=b.state}if(this.destroyed){this.viewState.state=u;return}if(this.observer.clear(),u.facet(T.yy.phrases)!=this.state.facet(T.yy.phrases))return this.setState(u);h=f.create(this,u,t);let m=this.viewState.scrollTarget;try{this.updateState=2;for(let b of t){if(m&&(m=m.map(b.changes)),b.scrollIntoView){let{main:x}=b.state.selection;m=new Zi(x.empty?x:T.jT.cursor(x.head,x.head>x.anchor?-1:1))}for(let x of b.effects)x.is(wi)&&(m=x.value)}this.viewState.update(h,m),this.bidiCache=ot.update(this.bidiCache,h.changes),h.empty||(this.updatePlugins(h),this.inputState.update(h)),n=this.docView.update(h),this.state.facet(li)!=this.styleModules&&this.mountStyles(),o=this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(n,t.some(b=>b.isUserEvent("select.pointer")))}finally{this.updateState=0}if(h.startState.facet(Mn)!=h.state.facet(Mn)&&(this.viewState.mustMeasureContent=!0),(n||o||m||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!h.empty)for(let b of this.state.facet(Xt))b(h)}setState(t){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=t;return}this.updateState=2;let n=this.hasFocus;try{for(let o of this.plugins)o.destroy(this);this.viewState=new Co(t),this.plugins=t.facet(ft).map(o=>new It(o)),this.pluginMap.clear();for(let o of this.plugins)o.update(this);this.docView=new Fs(this),this.inputState.ensureHandlers(this,this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}n&&this.focus(),this.requestMeasure()}updatePlugins(t){let n=t.startState.facet(ft),o=t.state.facet(ft);if(n!=o){let h=[];for(let u of o){let m=n.indexOf(u);if(m<0)h.push(new It(u));else{let b=this.plugins[m];b.mustUpdate=t,h.push(b)}}for(let u of this.plugins)u.mustUpdate!=t&&u.destroy(this);this.plugins=h,this.pluginMap.clear(),this.inputState.ensureHandlers(this,this.plugins)}else for(let h of this.plugins)h.mustUpdate=t;for(let h=0;h<this.plugins.length;h++)this.plugins[h].update(this)}measure(t=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,t&&this.observer.flush();let n=null;try{for(let o=0;;o++){this.updateState=1;let h=this.viewport,u=this.viewState.measure(this);if(!u&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(o>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let m=[];u&4||([this.measureRequests,m]=[m,this.measureRequests]);let b=m.map(P=>{try{return P.read(this)}catch(V){return Et(this.state,V),ps}}),x=f.create(this,this.state,[]),A=!1,D=!1;x.flags|=u,n?n.flags|=u:n=x,this.updateState=2,x.empty||(this.updatePlugins(x),this.inputState.update(x),this.updateAttrs(),A=this.docView.update(x));for(let P=0;P<m.length;P++)if(b[P]!=ps)try{let V=m[P];V.write&&V.write(b[P],this)}catch(V){Et(this.state,V)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,D=!0),A&&this.docView.updateSelection(!0),this.viewport.from==h.from&&this.viewport.to==h.to&&!D&&this.measureRequests.length==0)break}}finally{this.updateState=0,this.measureScheduled=-1}if(n&&!n.empty)for(let o of this.state.facet(Xt))o(n)}get themeClasses(){return Tn+" "+(this.state.facet(ds)?Dn:hr)+" "+this.state.facet(Mn)}updateAttrs(){let t=pr(this,xi,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),n={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(oi)?"true":"false",class:"cm-content",style:`${U.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(n["aria-readonly"]="true"),pr(this,jt,n);let o=this.observer.ignore(()=>{let h=Fe(this.contentDOM,this.contentAttrs,n),u=Fe(this.dom,this.editorAttrs,t);return h||u});return this.editorAttrs=t,this.contentAttrs=n,o}showAnnouncements(t){let n=!0;for(let o of t)for(let h of o.effects)if(h.is(xe.announce)){n&&(this.announceDOM.textContent=""),n=!1;let u=this.announceDOM.appendChild(document.createElement("div"));u.textContent=h.value}}mountStyles(){this.styleModules=this.state.facet(li),B.V.mount(this.root,this.styleModules.concat(On).reverse())}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame(()=>this.measure())),t){if(t.key!=null){for(let n=0;n<this.measureRequests.length;n++)if(this.measureRequests[n].key===t.key){this.measureRequests[n]=t;return}}this.measureRequests.push(t)}}plugin(t){let n=this.pluginMap.get(t);return(n===void 0||n&&n.spec!=t)&&this.pluginMap.set(t,n=this.plugins.find(o=>o.spec==t)||null),n&&n.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,n,o){return Zn(this,t,Xs(this,t,n,o))}moveByGroup(t,n){return Zn(this,t,Xs(this,t,n,o=>co(this,t.head,o)))}moveToLineBoundary(t,n,o=!0){return Js(this,t,n,o)}moveVertically(t,n,o){return Zn(this,t,Yn(this,t,n,o))}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,n=0){return this.docView.posFromDOM(t,n)}posAtCoords(t,n=!0){return this.readMeasured(),Gs(this,t,n)}coordsAtPos(t,n=1){this.readMeasured();let o=this.docView.coordsAt(t,n);if(!o||o.left==o.right)return o;let h=this.state.doc.lineAt(t),u=this.bidiSpans(h),m=u[G.find(u,t-h.from,-1,n)];return Be(o,m.dir==p.LTR==n>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(t){return!this.state.facet(nt)||t<this.viewport.from||t>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(t))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>Oo)return At(t.length);let n=this.textDirectionAt(t.from);for(let h of this.bidiCache)if(h.from==t.from&&h.dir==n)return h.order;let o=ve(t.text,n);return this.bidiCache.push(new ot(t.from,t.to,n,o)),o}get hasFocus(){var t;return(document.hasFocus()||U.safari&&((t=this.inputState)===null||t===void 0?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{Xe(this.contentDOM),this.docView.updateSelection()})}destroy(){for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,n={}){return wi.of(new Zi(typeof t=="number"?T.jT.cursor(t):t,n.y,n.x,n.yMargin,n.xMargin))}static domEventHandlers(t){return Ie.define(()=>({}),{eventHandlers:t})}static theme(t,n){let o=B.V.newName(),h=[Mn.of(o),li.of(fr(`.${o}`,t))];return n&&n.dark&&h.push(ds.of(!0)),h}static baseTheme(t){return T.Wl.lowest(li.of(fr("."+Tn,t,cr)))}}xe.styleModule=li,xe.inputHandler=Le,xe.perLineTextDirection=nt,xe.exceptionSink=Jt,xe.updateListener=Xt,xe.editable=oi,xe.mouseSelectionStyle=Ue,xe.dragMovesSelection=Yi,xe.clickAddsSelectionRange=ye,xe.decorations=Nt,xe.atomicRanges=Ct,xe.scrollMargins=Jn,xe.darkTheme=ds,xe.contentAttributes=jt,xe.editorAttributes=xi,xe.lineWrapping=xe.contentAttributes.of({class:"cm-lineWrapping"}),xe.announce=T.Py.define();const Oo=4096,ps={};class ot{constructor(t,n,o,h){this.from=t,this.to=n,this.dir=o,this.order=h}static update(t,n){if(n.empty)return t;let o=[],h=t.length?t[t.length-1].dir:p.LTR;for(let u=Math.max(0,t.length-10);u<t.length;u++){let m=t[u];m.dir==h&&!n.touchesRange(m.from,m.to)&&o.push(new ot(n.mapPos(m.from,1),n.mapPos(m.to,-1),m.dir,m.order))}return o}}function pr(a,t,n){for(let o=a.state.facet(t),h=o.length-1;h>=0;h--){let u=o[h],m=typeof u=="function"?u(a):u;m&&St(m,n)}return n}const mr=U.mac?"mac":U.windows?"win":U.linux?"linux":"key";function Po(a,t){const n=a.split(/-(?!$)/);let o=n[n.length-1];o=="Space"&&(o=" ");let h,u,m,b;for(let x=0;x<n.length-1;++x){const A=n[x];if(/^(cmd|meta|m)$/i.test(A))b=!0;else if(/^a(lt)?$/i.test(A))h=!0;else if(/^(c|ctrl|control)$/i.test(A))u=!0;else if(/^s(hift)?$/i.test(A))m=!0;else if(/^mod$/i.test(A))t=="mac"?b=!0:u=!0;else throw new Error("Unrecognized modifier name: "+A)}return h&&(o="Alt-"+o),u&&(o="Ctrl-"+o),b&&(o="Meta-"+o),m&&(o="Shift-"+o),o}function rn(a,t,n){return t.altKey&&(a="Alt-"+a),t.ctrlKey&&(a="Ctrl-"+a),t.metaKey&&(a="Meta-"+a),n!==!1&&t.shiftKey&&(a="Shift-"+a),a}const Bo=xe.domEventHandlers({keydown(a,t){return ln(yr(t.state),a,t,"editor")}}),gr=T.r$.define({enables:Bo}),Ft=new WeakMap;function yr(a){let t=a.facet(gr),n=Ft.get(t);return n||Ft.set(t,n=on(t.reduce((o,h)=>o.concat(h),[]))),n}function Hi(a,t,n){return ln(yr(a.state),t,a,n)}let et=null;const $t=4e3;function on(a,t=mr){let n=Object.create(null),o=Object.create(null),h=(m,b)=>{let x=o[m];if(x==null)o[m]=b;else if(x!=b)throw new Error("Key binding "+m+" is used both as a regular binding and as a multi-stroke prefix")},u=(m,b,x,A)=>{let D=n[m]||(n[m]=Object.create(null)),P=b.split(/ (?!$)/).map(F=>Po(F,t));for(let F=1;F<P.length;F++){let _=P.slice(0,F).join(" ");h(_,!0),D[_]||(D[_]={preventDefault:!0,commands:[J=>{let X=et={view:J,prefix:_,scope:m};return setTimeout(()=>{et==X&&(et=null)},$t),!0}]})}let V=P.join(" ");h(V,!1);let N=D[V]||(D[V]={preventDefault:!1,commands:[]});N.commands.push(x),A&&(N.preventDefault=!0)};for(let m of a){let b=m[t]||m.key;if(b)for(let x of m.scope?m.scope.split(" "):["editor"])u(x,b,m.run,m.preventDefault),m.shift&&u(x,"Shift-"+b,m.shift,m.preventDefault)}return n}function ln(a,t,n,o){let h=ie(t),u=h.length==1&&h!=" ",m="",b=!1;et&&et.view==n&&et.scope==o&&(m=et.prefix+" ",(b=kn.indexOf(t.keyCode)<0)&&(et=null));let x=P=>{if(P){for(let V of P.commands)if(V(n))return!0;P.preventDefault&&(b=!0)}return!1},A=a[o],D;if(A){if(x(A[m+rn(h,t,!u)]))return!0;if(u&&(t.shiftKey||t.altKey||t.metaKey)&&(D=Oe[t.keyCode])&&D!=h){if(x(A[m+rn(D,t,!0)]))return!0}else if(u&&t.shiftKey&&x(A[m+rn(h,t,!0)]))return!0}return b}const wt=!U.ios,Wi=T.r$.define({combine(a){return(0,T.BO)(a,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(t,n)=>Math.min(t,n),drawRangeCursor:(t,n)=>t||n})}});function br(a={}){return[Wi.of(a),Bl,Eo]}class Lo{constructor(t,n,o,h,u){this.left=t,this.top=n,this.width=o,this.height=h,this.className=u}draw(){let t=document.createElement("div");return t.className=this.className,this.adjust(t),t}adjust(t){t.style.left=this.left+"px",t.style.top=this.top+"px",this.width>=0&&(t.style.width=this.width+"px"),t.style.height=this.height+"px"}eq(t){return this.left==t.left&&this.top==t.top&&this.width==t.width&&this.height==t.height&&this.className==t.className}}const Bl=Ie.fromClass(class{constructor(a){this.view=a,this.rangePieces=[],this.cursors=[],this.measureReq={read:this.readPos.bind(this),write:this.drawSel.bind(this)},this.selectionLayer=a.scrollDOM.appendChild(document.createElement("div")),this.selectionLayer.className="cm-selectionLayer",this.selectionLayer.setAttribute("aria-hidden","true"),this.cursorLayer=a.scrollDOM.appendChild(document.createElement("div")),this.cursorLayer.className="cm-cursorLayer",this.cursorLayer.setAttribute("aria-hidden","true"),a.requestMeasure(this.measureReq),this.setBlinkRate()}setBlinkRate(){this.cursorLayer.style.animationDuration=this.view.state.facet(Wi).cursorBlinkRate+"ms"}update(a){let t=a.startState.facet(Wi)!=a.state.facet(Wi);(t||a.selectionSet||a.geometryChanged||a.viewportChanged)&&this.view.requestMeasure(this.measureReq),a.transactions.some(n=>n.scrollIntoView)&&(this.cursorLayer.style.animationName=this.cursorLayer.style.animationName=="cm-blink"?"cm-blink2":"cm-blink"),t&&this.setBlinkRate()}readPos(){let{state:a}=this.view,t=a.facet(Wi),n=a.selection.ranges.map(h=>h.empty?[]:xr(this.view,h)).reduce((h,u)=>h.concat(u)),o=[];for(let h of a.selection.ranges){let u=h==a.selection.main;if(h.empty?!u||wt:t.drawRangeCursor){let m=kr(this.view,h,u);m&&o.push(m)}}return{rangePieces:n,cursors:o}}drawSel({rangePieces:a,cursors:t}){if(a.length!=this.rangePieces.length||a.some((n,o)=>!n.eq(this.rangePieces[o]))){this.selectionLayer.textContent="";for(let n of a)this.selectionLayer.appendChild(n.draw());this.rangePieces=a}if(t.length!=this.cursors.length||t.some((n,o)=>!n.eq(this.cursors[o]))){let n=this.cursorLayer.children;if(n.length!==t.length){this.cursorLayer.textContent="";for(const o of t)this.cursorLayer.appendChild(o.draw())}else t.forEach((o,h)=>o.adjust(n[h]));this.cursors=t}}destroy(){this.selectionLayer.remove(),this.cursorLayer.remove()}}),an={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};wt&&(an[".cm-line"].caretColor="transparent !important");const Eo=T.Wl.highest(xe.theme(an));function wr(a){let t=a.scrollDOM.getBoundingClientRect();return{left:(a.textDirection==p.LTR?t.left:t.right-a.scrollDOM.clientWidth)-a.scrollDOM.scrollLeft,top:t.top-a.scrollDOM.scrollTop}}function Ro(a,t,n){let o=T.jT.cursor(t);return{from:Math.max(n.from,a.moveToLineBoundary(o,!1,!0).from),to:Math.min(n.to,a.moveToLineBoundary(o,!0,!0).from),type:fe.Text}}function Io(a,t){let n=a.lineBlockAt(t);if(Array.isArray(n.type)){for(let o of n.type)if(o.to>t||o.to==t&&(o.to==n.to||o.type==fe.Text))return o}return n}function xr(a,t){if(t.to<=a.viewport.from||t.from>=a.viewport.to)return[];let n=Math.max(t.from,a.viewport.from),o=Math.min(t.to,a.viewport.to),h=a.textDirection==p.LTR,u=a.contentDOM,m=u.getBoundingClientRect(),b=wr(a),x=window.getComputedStyle(u.firstChild),A=m.left+parseInt(x.paddingLeft)+Math.min(0,parseInt(x.textIndent)),D=m.right-parseInt(x.paddingRight),P=Io(a,n),V=Io(a,o),N=P.type==fe.Text?P:null,F=V.type==fe.Text?V:null;if(a.lineWrapping&&(N&&(N=Ro(a,n,N)),F&&(F=Ro(a,o,F))),N&&F&&N.from==F.from)return J(X(t.from,t.to,N));{let le=N?X(t.from,null,N):Me(P,!1),se=F?X(null,t.to,F):Me(V,!0),He=[];return(N||P).to<(F||V).from-1?He.push(_(A,le.bottom,D,se.top)):le.bottom<se.top&&a.elementAtHeight((le.bottom+se.top)/2).type==fe.Text&&(le.bottom=se.top=(le.bottom+se.top)/2),J(le).concat(He).concat(J(se))}function _(le,se,He,ui){return new Lo(le-b.left,se-b.top-.01,He-le,ui-se+.01,"cm-selectionBackground")}function J({top:le,bottom:se,horizontal:He}){let ui=[];for(let di=0;di<He.length;di+=2)ui.push(_(He[di],le,He[di+1],se));return ui}function X(le,se,He){let ui=1e9,di=-1e9,jn=[];function Ur(qt,Ai,Mi,pi,Ut){let mi=a.coordsAtPos(qt,qt==He.to?-2:2),xt=a.coordsAtPos(Mi,Mi==He.from?2:-2);ui=Math.min(mi.top,xt.top,ui),di=Math.max(mi.bottom,xt.bottom,di),Ut==p.LTR?jn.push(h&&Ai?A:mi.left,h&&pi?D:xt.right):jn.push(!h&&pi?A:xt.left,!h&&Ai?D:mi.right)}let $n=le??He.from,qn=se??He.to;for(let qt of a.visibleRanges)if(qt.to>$n&&qt.from<qn)for(let Ai=Math.max(qt.from,$n),Mi=Math.min(qt.to,qn);;){let pi=a.state.doc.lineAt(Ai);for(let Ut of a.bidiSpans(pi)){let mi=Ut.from+pi.from,xt=Ut.to+pi.from;if(mi>=Mi)break;xt>Ai&&Ur(Math.max(mi,Ai),le==null&&mi<=$n,Math.min(xt,Mi),se==null&&xt>=qn,Ut.dir)}if(Ai=pi.to+1,Ai>=Mi)break}return jn.length==0&&Ur($n,le==null,qn,se==null,a.textDirection),{top:ui,bottom:di,horizontal:jn}}function Me(le,se){let He=m.top+(se?le.top:le.bottom);return{top:He,bottom:He,horizontal:[]}}}function kr(a,t,n){let o=a.coordsAtPos(t.head,t.assoc||1);if(!o)return null;let h=wr(a);return new Lo(o.left-h.left,o.top-h.top,-1,o.bottom-o.top,n?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary")}const No=T.Py.define({map(a,t){return a==null?null:t.mapPos(a)}}),Ln=T.QQ.define({create(){return null},update(a,t){return a!=null&&(a=t.changes.mapPos(a)),t.effects.reduce((n,o)=>o.is(No)?o.value:n,a)}}),Vo=Ie.fromClass(class{constructor(a){this.view=a,this.cursor=null,this.measureReq={read:this.readPos.bind(this),write:this.drawCursor.bind(this)}}update(a){var t;let n=a.state.field(Ln);n==null?this.cursor!=null&&((t=this.cursor)===null||t===void 0||t.remove(),this.cursor=null):(this.cursor||(this.cursor=this.view.scrollDOM.appendChild(document.createElement("div")),this.cursor.className="cm-dropCursor"),(a.startState.field(Ln)!=n||a.docChanged||a.geometryChanged)&&this.view.requestMeasure(this.measureReq))}readPos(){let a=this.view.state.field(Ln),t=a!=null&&this.view.coordsAtPos(a);if(!t)return null;let n=this.view.scrollDOM.getBoundingClientRect();return{left:t.left-n.left+this.view.scrollDOM.scrollLeft,top:t.top-n.top+this.view.scrollDOM.scrollTop,height:t.bottom-t.top}}drawCursor(a){this.cursor&&(a?(this.cursor.style.left=a.left+"px",this.cursor.style.top=a.top+"px",this.cursor.style.height=a.height+"px"):this.cursor.style.left="-100000px")}destroy(){this.cursor&&this.cursor.remove()}setDropPos(a){this.view.state.field(Ln)!=a&&this.view.dispatch({effects:No.of(a)})}},{eventHandlers:{dragover(a){this.setDropPos(this.view.posAtCoords({x:a.clientX,y:a.clientY}))},dragleave(a){(a.target==this.view.contentDOM||!this.view.contentDOM.contains(a.relatedTarget))&&this.setDropPos(null)},dragend(){this.setDropPos(null)},drop(){this.setDropPos(null)}}});function En(){return[Ln,Vo]}function vr(a,t,n,o,h){t.lastIndex=0;for(let u=a.iterRange(n,o),m=n,b;!u.next().done;m+=u.value.length)if(!u.lineBreak)for(;b=t.exec(u.value);)h(m+b.index,m+b.index+b[0].length,b)}function Fo(a,t){let n=a.visibleRanges;if(n.length==1&&n[0].from==a.viewport.from&&n[0].to==a.viewport.to)return n;let o=[];for(let{from:h,to:u}of n)h=Math.max(a.state.doc.lineAt(h).from,h-t),u=Math.min(a.state.doc.lineAt(u).to,u+t),o.length&&o[o.length-1].to>=h?o[o.length-1].to=u:o.push({from:h,to:u});return o}class Sr{constructor(t){let{regexp:n,decoration:o,boundary:h,maxLength:u=1e3}=t;if(!n.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");this.regexp=n,this.getDeco=typeof o=="function"?o:()=>o,this.boundary=h,this.maxLength=u}createDeco(t){let n=new T.f_;for(let{from:o,to:h}of Fo(t,this.maxLength))vr(t.state.doc,this.regexp,o,h,(u,m,b)=>n.add(u,m,this.getDeco(b,t,u)));return n.finish()}updateDeco(t,n){let o=1e9,h=-1;return t.docChanged&&t.changes.iterChanges((u,m,b,x)=>{x>t.view.viewport.from&&b<t.view.viewport.to&&(o=Math.min(b,o),h=Math.max(x,h))}),t.viewportChanged||h-o>1e3?this.createDeco(t.view):h>-1?this.updateRange(t.view,n.map(t.changes),o,h):n}updateRange(t,n,o,h){for(let u of t.visibleRanges){let m=Math.max(u.from,o),b=Math.min(u.to,h);if(b>m){let x=t.state.doc.lineAt(m),A=x.to<b?t.state.doc.lineAt(b):x,D=Math.max(u.from,x.from),P=Math.min(u.to,A.to);if(this.boundary){for(;m>x.from;m--)if(this.boundary.test(x.text[m-1-x.from])){D=m;break}for(;b<A.to;b++)if(this.boundary.test(A.text[b-A.from])){P=b;break}}let V=[],N;if(x==A)for(this.regexp.lastIndex=D-x.from;(N=this.regexp.exec(x.text))&&N.index<P-x.from;){let F=N.index+x.from;V.push(this.getDeco(N,t,F).range(F,F+N[0].length))}else vr(t.state.doc,this.regexp,D,P,(F,_,J)=>V.push(this.getDeco(J,t,F).range(F,_)));n=n.update({filterFrom:D,filterTo:P,filter:(F,_)=>F<D||_>P,add:V})}}return n}}const Rn=/x/.unicode!=null?"gu":"g",Cr=new RegExp(`[\0-\b
-\x7F-\x9F\xAD\u061C\u200B\u200E\u200F\u2028\u2029\u202D\u202E\uFEFF\uFFF9-\uFFFC]`,Rn),Ar={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let In=null;function ms(){var a;if(In==null&&typeof document<"u"&&document.body){let t=document.body.style;In=((a=t.tabSize)!==null&&a!==void 0?a:t.MozTabSize)!=null}return In||!1}const Si=T.r$.define({combine(a){let t=(0,T.BO)(a,{render:null,specialChars:Cr,addSpecialChars:null});return(t.replaceTabs=!ms())&&(t.specialChars=new RegExp("	|"+t.specialChars.source,Rn)),t.addSpecialChars&&(t.specialChars=new RegExp(t.specialChars.source+"|"+t.addSpecialChars.source,Rn)),t}});function Mr(a={}){return[Si.of(a),Ho()]}let gs=null;function Ho(){return gs||(gs=Ie.fromClass(class{constructor(a){this.view=a,this.decorations=oe.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(a.state.facet(Si)),this.decorations=this.decorator.createDeco(a)}makeDecorator(a){return new Sr({regexp:a.specialChars,decoration:(t,n,o)=>{let{doc:h}=n.state,u=(0,T.gm)(t[0],0);if(u==9){let m=h.lineAt(o),b=n.state.tabSize,x=(0,T.IS)(m.text,b,o-m.from);return oe.replace({widget:new Ll((b-x%b)*this.view.defaultCharacterWidth)})}return this.decorationCache[u]||(this.decorationCache[u]=oe.replace({widget:new zo(a,u)}))},boundary:a.replaceTabs?void 0:/[^]/})}update(a){let t=a.state.facet(Si);a.startState.facet(Si)!=t?(this.decorator=this.makeDecorator(t),this.decorations=this.decorator.createDeco(a.view)):this.decorations=this.decorator.updateDeco(a,this.decorations)}},{decorations:a=>a.decorations}))}const Wo="\u2022";function Tr(a){return a>=32?Wo:a==10?"\u2424":String.fromCharCode(9216+a)}class zo extends ce{constructor(t,n){super(),this.options=t,this.code=n}eq(t){return t.code==this.code}toDOM(t){let n=Tr(this.code),o=t.state.phrase("Control character")+" "+(Ar[this.code]||"0x"+this.code.toString(16)),h=this.options.render&&this.options.render(this.code,o,n);if(h)return h;let u=document.createElement("span");return u.textContent=n,u.title=o,u.setAttribute("aria-label",o),u.className="cm-specialChar",u}ignoreEvent(){return!1}}class Ll extends ce{constructor(t){super(),this.width=t}eq(t){return t.width==this.width}toDOM(){let t=document.createElement("span");return t.textContent="	",t.className="cm-tab",t.style.width=this.width+"px",t}ignoreEvent(){return!1}}const Mt=null;function ys(){return[Mt,jt.of(a=>{var t;return((t=a.plugin(Mt))===null||t===void 0?void 0:t.attrs)||null})]}function Dr(){return El}const Or=oe.line({class:"cm-activeLine"}),El=Ie.fromClass(class{constructor(a){this.decorations=this.getDeco(a)}update(a){(a.docChanged||a.selectionSet)&&(this.decorations=this.getDeco(a.view))}getDeco(a){let t=-1,n=[];for(let o of a.state.selection.ranges){if(!o.empty)return oe.none;let h=a.lineBlockAt(o.head);h.from>t&&(n.push(Or.range(h.from)),t=h.from)}return oe.set(n)}},{decorations:a=>a.decorations});class Rl extends null{constructor(t){super(),this.content=t}toDOM(){let t=document.createElement("span");return t.className="cm-placeholder",t.style.pointerEvents="none",t.appendChild(typeof this.content=="string"?document.createTextNode(this.content):this.content),typeof this.content=="string"?t.setAttribute("aria-label","placeholder "+this.content):t.setAttribute("aria-hidden","true"),t}ignoreEvent(){return!1}}function bs(a){return Ie.fromClass(class{constructor(t){this.view=t,this.placeholder=oe.set([oe.widget({widget:new Rl(a),side:1}).range(0)])}get decorations(){return this.view.state.doc.length?oe.none:this.placeholder}},{decorations:t=>t.decorations})}const ws=2e3;function jo(a,t,n){let o=Math.min(t.line,n.line),h=Math.max(t.line,n.line),u=[];if(t.off>ws||n.off>ws||t.col<0||n.col<0){let m=Math.min(t.off,n.off),b=Math.max(t.off,n.off);for(let x=o;x<=h;x++){let A=a.doc.line(x);A.length<=b&&u.push(T.jT.range(A.from+m,A.to+b))}}else{let m=Math.min(t.col,n.col),b=Math.max(t.col,n.col);for(let x=o;x<=h;x++){let A=a.doc.line(x),D=(0,T.Gz)(A.text,m,a.tabSize,!0);if(D>-1){let P=(0,T.Gz)(A.text,b,a.tabSize);u.push(T.jT.range(A.from+D,A.from+P))}}}return u}function Il(a,t){let n=a.coordsAtPos(a.viewport.from);return n?Math.round(Math.abs((n.left-t)/a.defaultCharacterWidth)):-1}function $o(a,t){let n=a.posAtCoords({x:t.clientX,y:t.clientY},!1),o=a.state.doc.lineAt(n),h=n-o.from,u=h>ws?-1:h==o.length?Il(a,t.clientX):(0,T.IS)(o.text,a.state.tabSize,n-o.from);return{line:o.number,col:u,off:h}}function Pr(a,t){let n=$o(a,t),o=a.state.selection;return n?{update(h){if(h.docChanged){let u=h.changes.mapPos(h.startState.doc.line(n.line).from),m=h.state.doc.lineAt(u);n={line:m.number,col:n.col,off:Math.min(n.off,m.length)},o=o.map(h.changes)}},get(h,u,m){let b=$o(a,h);if(!b)return o;let x=jo(a.state,n,b);return x.length?m?T.jT.create(x.concat(o.ranges)):T.jT.create(x):o}}:null}function Nl(a){let t=a?.eventFilter||(n=>n.altKey&&n.button==0);return xe.mouseSelectionStyle.of((n,o)=>t(o)?Pr(n,o):null)}const Vl={Alt:[18,a=>a.altKey],Control:[17,a=>a.ctrlKey],Shift:[16,a=>a.shiftKey],Meta:[91,a=>a.metaKey]},qo={style:"cursor: crosshair"};function Uo(a={}){let[t,n]=Vl[a.key||"Alt"],o=Ie.fromClass(class{constructor(h){this.view=h,this.isDown=!1}set(h){this.isDown!=h&&(this.isDown=h,this.view.update([]))}},{eventHandlers:{keydown(h){this.set(h.keyCode==t||n(h))},keyup(h){(h.keyCode==t||!n(h))&&this.set(!1)}}});return[o,xe.contentAttributes.of(h=>{var u;return!((u=h.plugin(o))===null||u===void 0)&&u.isDown?qo:null})]}const Nn="-10000px";class xs{constructor(t,n,o){this.facet=n,this.createTooltipView=o,this.input=t.state.facet(n),this.tooltips=this.input.filter(h=>h),this.tooltipViews=this.tooltips.map(o)}update(t){let n=t.state.facet(this.facet),o=n.filter(u=>u);if(n===this.input){for(let u of this.tooltipViews)u.update&&u.update(t);return!1}let h=[];for(let u=0;u<o.length;u++){let m=o[u],b=-1;if(m){for(let x=0;x<this.tooltips.length;x++){let A=this.tooltips[x];A&&A.create==m.create&&(b=x)}if(b<0)h[u]=this.createTooltipView(m);else{let x=h[u]=this.tooltipViews[b];x.update&&x.update(t)}}}for(let u of this.tooltipViews)h.indexOf(u)<0&&u.dom.remove();return this.input=n,this.tooltips=o,this.tooltipViews=h,!0}}function Go(a={}){return hn.of(a)}function Br(){return{top:0,left:0,bottom:innerHeight,right:innerWidth}}const hn=T.r$.define({combine:a=>{var t,n,o;return{position:U.ios?"absolute":((t=a.find(h=>h.position))===null||t===void 0?void 0:t.position)||"fixed",parent:((n=a.find(h=>h.parent))===null||n===void 0?void 0:n.parent)||null,tooltipSpace:((o=a.find(h=>h.tooltipSpace))===null||o===void 0?void 0:o.tooltipSpace)||Br}}}),Vn=Ie.fromClass(class{constructor(a){var t;this.view=a,this.inView=!0,this.lastTransaction=0,this.measureTimeout=-1;let n=a.state.facet(hn);this.position=n.position,this.parent=n.parent,this.classes=a.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.manager=new xs(a,ks,o=>this.createTooltip(o)),this.intersectionObserver=typeof IntersectionObserver=="function"?new IntersectionObserver(o=>{Date.now()>this.lastTransaction-50&&o.length>0&&o[o.length-1].intersectionRatio<1&&this.measureSoon()},{threshold:[1]}):null,this.observeIntersection(),(t=a.dom.ownerDocument.defaultView)===null||t===void 0||t.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let a of this.manager.tooltipViews)this.intersectionObserver.observe(a.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout(()=>{this.measureTimeout=-1,this.maybeMeasure()},50))}update(a){a.transactions.length&&(this.lastTransaction=Date.now());let t=this.manager.update(a);t&&this.observeIntersection();let n=t||a.geometryChanged,o=a.state.facet(hn);if(o.position!=this.position){this.position=o.position;for(let h of this.manager.tooltipViews)h.dom.style.position=this.position;n=!0}if(o.parent!=this.parent){this.parent&&this.container.remove(),this.parent=o.parent,this.createContainer();for(let h of this.manager.tooltipViews)this.container.appendChild(h.dom);n=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);n&&this.maybeMeasure()}createTooltip(a){let t=a.create(this.view);if(t.dom.classList.add("cm-tooltip"),a.arrow&&!t.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let n=document.createElement("div");n.className="cm-tooltip-arrow",t.dom.appendChild(n)}return t.dom.style.position=this.position,t.dom.style.top=Nn,this.container.appendChild(t.dom),t.mount&&t.mount(this.view),t}destroy(){var a,t;(a=this.view.dom.ownerDocument.defaultView)===null||a===void 0||a.removeEventListener("resize",this.measureSoon);for(let{dom:n}of this.manager.tooltipViews)n.remove();(t=this.intersectionObserver)===null||t===void 0||t.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let a=this.view.dom.getBoundingClientRect();return{editor:a,parent:this.parent?this.container.getBoundingClientRect():a,pos:this.manager.tooltips.map((t,n)=>{let o=this.manager.tooltipViews[n];return o.getCoords?o.getCoords(t.pos):this.view.coordsAtPos(t.pos)}),size:this.manager.tooltipViews.map(({dom:t})=>t.getBoundingClientRect()),space:this.view.state.facet(hn).tooltipSpace(this.view)}}writeMeasure(a){let{editor:t,space:n}=a,o=[];for(let h=0;h<this.manager.tooltips.length;h++){let u=this.manager.tooltips[h],m=this.manager.tooltipViews[h],{dom:b}=m,x=a.pos[h],A=a.size[h];if(!x||x.bottom<=Math.max(t.top,n.top)||x.top>=Math.min(t.bottom,n.bottom)||x.right<Math.max(t.left,n.left)-.1||x.left>Math.min(t.right,n.right)+.1){b.style.top=Nn;continue}let D=u.arrow?m.dom.querySelector(".cm-tooltip-arrow"):null,P=D?7:0,V=A.right-A.left,N=A.bottom-A.top,F=m.offset||Er,_=this.view.textDirection==p.LTR,J=A.width>n.right-n.left?_?n.left:n.right-A.width:_?Math.min(x.left-(D?14:0)+F.x,n.right-V):Math.max(n.left,x.left-V+(D?14:0)-F.x),X=!!u.above;!u.strictSide&&(X?x.top-(A.bottom-A.top)-F.y<n.top:x.bottom+(A.bottom-A.top)+F.y>n.bottom)&&X==n.bottom-x.bottom>x.top-n.top&&(X=!X);let Me=X?x.top-N-P-F.y:x.bottom+P+F.y,le=J+V;if(m.overlap!==!0)for(let se of o)se.left<le&&se.right>J&&se.top<Me+N&&se.bottom>Me&&(Me=X?se.top-N-2-P:se.bottom+P+2);this.position=="absolute"?(b.style.top=Me-a.parent.top+"px",b.style.left=J-a.parent.left+"px"):(b.style.top=Me+"px",b.style.left=J+"px"),D&&(D.style.left=`${x.left+(_?F.x:-F.x)-(J+14-7)}px`),m.overlap!==!0&&o.push({left:J,top:Me,right:le,bottom:Me+N}),b.classList.toggle("cm-tooltip-above",X),b.classList.toggle("cm-tooltip-below",!X),m.positioned&&m.positioned()}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let a of this.manager.tooltipViews)a.dom.style.top=Nn}},{eventHandlers:{scroll(){this.maybeMeasure()}}}),Lr=xe.baseTheme({".cm-tooltip":{zIndex:100},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:`${7*2}px`,position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),Er={x:0,y:0},ks=T.r$.define({enables:[Vn,Lr]}),cn=T.r$.define();class Fn{constructor(t){this.view=t,this.mounted=!1,this.dom=document.createElement("div"),this.dom.classList.add("cm-tooltip-hover"),this.manager=new xs(t,cn,n=>this.createHostedView(n))}static create(t){return new Fn(t)}createHostedView(t){let n=t.create(this.view);return n.dom.classList.add("cm-tooltip-section"),this.dom.appendChild(n.dom),this.mounted&&n.mount&&n.mount(this.view),n}mount(t){for(let n of this.manager.tooltipViews)n.mount&&n.mount(t);this.mounted=!0}positioned(){for(let t of this.manager.tooltipViews)t.positioned&&t.positioned()}update(t){this.manager.update(t)}}const Rr=ks.compute([cn],a=>{let t=a.facet(cn).filter(n=>n);return t.length===0?null:{pos:Math.min(...t.map(n=>n.pos)),end:Math.max(...t.filter(n=>n.end!=null).map(n=>n.end)),create:Fn.create,above:t[0].above,arrow:t.some(n=>n.arrow)}});class Ir{constructor(t,n,o,h,u){this.view=t,this.source=n,this.field=o,this.setHover=h,this.hoverTime=u,this.hoverTimeout=-1,this.restartTimeout=-1,this.pending=null,this.lastMove={x:0,y:0,target:t.dom,time:0},this.checkHover=this.checkHover.bind(this),t.dom.addEventListener("mouseleave",this.mouseleave=this.mouseleave.bind(this)),t.dom.addEventListener("mousemove",this.mousemove=this.mousemove.bind(this))}update(){this.pending&&(this.pending=null,clearTimeout(this.restartTimeout),this.restartTimeout=setTimeout(()=>this.startHover(),20))}get active(){return this.view.state.field(this.field)}checkHover(){if(this.hoverTimeout=-1,this.active)return;let t=Date.now()-this.lastMove.time;t<this.hoverTime?this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime-t):this.startHover()}startHover(){clearTimeout(this.restartTimeout);let{lastMove:t}=this,n=this.view.contentDOM.contains(t.target)?this.view.posAtCoords(t):null;if(n==null)return;let o=this.view.coordsAtPos(n);if(o==null||t.y<o.top||t.y>o.bottom||t.x<o.left-this.view.defaultCharacterWidth||t.x>o.right+this.view.defaultCharacterWidth)return;let h=this.view.bidiSpans(this.view.state.doc.lineAt(n)).find(b=>b.from<=n&&b.to>=n),u=h&&h.dir==p.RTL?-1:1,m=this.source(this.view,n,t.x<o.left?-u:u);if(m?.then){let b=this.pending={pos:n};m.then(x=>{this.pending==b&&(this.pending=null,x&&this.view.dispatch({effects:this.setHover.of(x)}))},x=>Et(this.view.state,x,"hover tooltip"))}else m&&this.view.dispatch({effects:this.setHover.of(m)})}mousemove(t){var n;this.lastMove={x:t.clientX,y:t.clientY,target:t.target,time:Date.now()},this.hoverTimeout<0&&(this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime));let o=this.active;if(o&&!Nr(this.lastMove.target)||this.pending){let{pos:h}=o||this.pending,u=(n=o?.end)!==null&&n!==void 0?n:h;(h==u?this.view.posAtCoords(this.lastMove)!=h:!Ko(this.view,h,u,t.clientX,t.clientY,6))&&(this.view.dispatch({effects:this.setHover.of(null)}),this.pending=null)}}mouseleave(){clearTimeout(this.hoverTimeout),this.hoverTimeout=-1,this.active&&this.view.dispatch({effects:this.setHover.of(null)})}destroy(){clearTimeout(this.hoverTimeout),this.view.dom.removeEventListener("mouseleave",this.mouseleave),this.view.dom.removeEventListener("mousemove",this.mousemove)}}function Nr(a){for(let t=a;t;t=t.parentNode)if(t.nodeType==1&&t.classList.contains("cm-tooltip"))return!0;return!1}function Ko(a,t,n,o,h,u){let m=document.createRange(),b=a.domAtPos(t),x=a.domAtPos(n);m.setEnd(x.node,x.offset),m.setStart(b.node,b.offset);let A=m.getClientRects();m.detach();for(let D=0;D<A.length;D++){let P=A[D];if(Math.max(P.top-h,h-P.bottom,P.left-o,o-P.right)<=u)return!0}return!1}function _o(a,t={}){let n=T.Py.define(),o=T.QQ.define({create(){return null},update(h,u){if(h&&(t.hideOnChange&&(u.docChanged||u.selection)||t.hideOn&&t.hideOn(u,h)))return null;if(h&&u.docChanged){let m=u.changes.mapPos(h.pos,-1,T.gc.TrackDel);if(m==null)return null;let b=Object.assign(Object.create(null),h);b.pos=m,h.end!=null&&(b.end=u.changes.mapPos(h.end)),h=b}for(let m of u.effects)m.is(n)&&(h=m.value),m.is(Hn)&&(h=null);return h},provide:h=>cn.from(h)});return[o,Ie.define(h=>new Ir(h,a,o,n,t.hoverTime||300)),Rr]}function Jo(a,t){let n=a.plugin(Vn);if(!n)return null;let o=n.manager.tooltips.indexOf(t);return o<0?null:n.manager.tooltipViews[o]}function Fl(a){return a.facet(cn).some(t=>t)}const Hn=T.Py.define(),vs=null;function Xo(a){var t;(t=a.plugin(Vn))===null||t===void 0||t.maybeMeasure()}const fn=T.r$.define({combine(a){let t,n;for(let o of a)t=t||o.topContainer,n=n||o.bottomContainer;return{topContainer:t,bottomContainer:n}}});function Qo(a){return a?[fn.of(a)]:[]}function Vr(a,t){let n=a.plugin(Ss),o=n?n.specs.indexOf(t):-1;return o>-1?n.panels[o]:null}const Ss=Ie.fromClass(class{constructor(a){this.input=a.state.facet(As),this.specs=this.input.filter(n=>n),this.panels=this.specs.map(n=>n(a));let t=a.state.facet(fn);this.top=new Wn(a,!0,t.topContainer),this.bottom=new Wn(a,!1,t.bottomContainer),this.top.sync(this.panels.filter(n=>n.top)),this.bottom.sync(this.panels.filter(n=>!n.top));for(let n of this.panels)n.dom.classList.add("cm-panel"),n.mount&&n.mount()}update(a){let t=a.state.facet(fn);this.top.container!=t.topContainer&&(this.top.sync([]),this.top=new Wn(a.view,!0,t.topContainer)),this.bottom.container!=t.bottomContainer&&(this.bottom.sync([]),this.bottom=new Wn(a.view,!1,t.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let n=a.state.facet(As);if(n!=this.input){let o=n.filter(x=>x),h=[],u=[],m=[],b=[];for(let x of o){let A=this.specs.indexOf(x),D;A<0?(D=x(a.view),b.push(D)):(D=this.panels[A],D.update&&D.update(a)),h.push(D),(D.top?u:m).push(D)}this.specs=o,this.panels=h,this.top.sync(u),this.bottom.sync(m);for(let x of b)x.dom.classList.add("cm-panel"),x.mount&&x.mount()}else for(let o of this.panels)o.update&&o.update(a)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:a=>xe.scrollMargins.of(t=>{let n=t.plugin(a);return n&&{top:n.top.scrollMargin(),bottom:n.bottom.scrollMargin()}})});class Wn{constructor(t,n,o){this.view=t,this.top=n,this.container=o,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(t){for(let n of this.panels)n.destroy&&t.indexOf(n)<0&&n.destroy();this.panels=t,this.syncDOM()}syncDOM(){if(this.panels.length==0){this.dom&&(this.dom.remove(),this.dom=void 0);return}if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let n=this.container||this.view.dom;n.insertBefore(this.dom,this.top?n.firstChild:null)}let t=this.dom.firstChild;for(let n of this.panels)if(n.dom.parentNode==this.dom){for(;t!=n.dom;)t=Cs(t);t=t.nextSibling}else this.dom.insertBefore(n.dom,t);for(;t;)t=Cs(t)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(!(!this.container||this.classes==this.view.themeClasses)){for(let t of this.classes.split(" "))t&&this.container.classList.remove(t);for(let t of(this.classes=this.view.themeClasses).split(" "))t&&this.container.classList.add(t)}}}function Cs(a){let t=a.nextSibling;return a.remove(),t}const As=T.r$.define({enables:Ss});class ci extends T.uU{compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}eq(t){return!1}destroy(t){}}ci.prototype.elementClass="",ci.prototype.toDOM=void 0,ci.prototype.mapMode=T.gc.TrackBefore,ci.prototype.startSide=ci.prototype.endSide=-1,ci.prototype.point=!0;const zn=T.r$.define(),Yo={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>T.Xs.empty,lineMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{}},fi=T.r$.define();function Fr(a){return[Hr(),fi.of(Object.assign(Object.assign({},Yo),a))]}const Ms=T.r$.define({combine:a=>a.some(t=>t)});function Hr(a){let t=[Wr];return a&&a.fixed===!1&&t.push(Ms.of(!0)),t}const Wr=Ie.fromClass(class{constructor(a){this.view=a,this.prevViewport=a.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight+"px",this.gutters=a.state.facet(fi).map(t=>new el(a,t));for(let t of this.gutters)this.dom.appendChild(t.dom);this.fixed=!a.state.facet(Ms),this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),a.scrollDOM.insertBefore(this.dom,a.contentDOM)}update(a){if(this.updateGutters(a)){let t=this.prevViewport,n=a.view.viewport,o=Math.min(t.to,n.to)-Math.max(t.from,n.from);this.syncGutters(o<(n.to-n.from)*.8)}a.geometryChanged&&(this.dom.style.minHeight=this.view.contentHeight+"px"),this.view.state.facet(Ms)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":""),this.prevViewport=a.view.viewport}syncGutters(a){let t=this.dom.nextSibling;a&&this.dom.remove();let n=T.Xs.iter(this.view.state.facet(zn),this.view.viewport.from),o=[],h=this.gutters.map(u=>new Zo(u,this.view.viewport,-this.view.documentPadding.top));for(let u of this.view.viewportLineBlocks){let m;if(Array.isArray(u.type)){for(let b of u.type)if(b.type==fe.Text){m=b;break}}else m=u.type==fe.Text?u:void 0;if(m){o.length&&(o=[]),jr(n,o,u.from);for(let b of h)b.line(this.view,m,o)}}for(let u of h)u.finish();a&&this.view.scrollDOM.insertBefore(this.dom,t)}updateGutters(a){let t=a.startState.facet(fi),n=a.state.facet(fi),o=a.docChanged||a.heightChanged||a.viewportChanged||!T.Xs.eq(a.startState.facet(zn),a.state.facet(zn),a.view.viewport.from,a.view.viewport.to);if(t==n)for(let h of this.gutters)h.update(a)&&(o=!0);else{o=!0;let h=[];for(let u of n){let m=t.indexOf(u);m<0?h.push(new el(this.view,u)):(this.gutters[m].update(a),h.push(this.gutters[m]))}for(let u of this.gutters)u.dom.remove(),h.indexOf(u)<0&&u.destroy();for(let u of h)this.dom.appendChild(u.dom);this.gutters=h}return o}destroy(){for(let a of this.gutters)a.destroy();this.dom.remove()}},{provide:a=>xe.scrollMargins.of(t=>{let n=t.plugin(a);return!n||n.gutters.length==0||!n.fixed?null:t.textDirection==p.LTR?{left:n.dom.offsetWidth}:{right:n.dom.offsetWidth}})});function zr(a){return Array.isArray(a)?a:[a]}function jr(a,t,n){for(;a.value&&a.from<=n;)a.from==n&&t.push(a.value),a.next()}class Zo{constructor(t,n,o){this.gutter=t,this.height=o,this.localMarkers=[],this.i=0,this.cursor=T.Xs.iter(t.markers,n.from)}line(t,n,o){this.localMarkers.length&&(this.localMarkers=[]),jr(this.cursor,this.localMarkers,n.from);let h=o.length?this.localMarkers.concat(o):this.localMarkers,u=this.gutter.config.lineMarker(t,n,h);u&&h.unshift(u);let m=this.gutter;if(h.length==0&&!m.config.renderEmptyElements)return;let b=n.top-this.height;if(this.i==m.elements.length){let x=new $r(t,n.height,b,h);m.elements.push(x),m.dom.appendChild(x.dom)}else m.elements[this.i].update(t,n.height,b,h);this.height=n.bottom,this.i++}finish(){let t=this.gutter;for(;t.elements.length>this.i;){let n=t.elements.pop();t.dom.removeChild(n.dom),n.destroy()}}}class el{constructor(t,n){this.view=t,this.config=n,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let o in n.domEventHandlers)this.dom.addEventListener(o,h=>{let u=t.lineBlockAtHeight(h.clientY-t.documentTop);n.domEventHandlers[o](t,u,h)&&h.preventDefault()});this.markers=zr(n.markers(t)),n.initialSpacer&&(this.spacer=new $r(t,0,0,[n.initialSpacer(t)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(t){let n=this.markers;if(this.markers=zr(this.config.markers(t.view)),this.spacer&&this.config.updateSpacer){let h=this.config.updateSpacer(this.spacer.markers[0],t);h!=this.spacer.markers[0]&&this.spacer.update(t.view,0,0,[h])}let o=t.view.viewport;return!T.Xs.eq(this.markers,n,o.from,o.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(t):!1)}destroy(){for(let t of this.elements)t.destroy()}}class $r{constructor(t,n,o,h){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(t,n,o,h)}update(t,n,o,h){this.height!=n&&(this.dom.style.height=(this.height=n)+"px"),this.above!=o&&(this.dom.style.marginTop=(this.above=o)?o+"px":""),tl(this.markers,h)||this.setMarkers(t,h)}setMarkers(t,n){let o="cm-gutterElement",h=this.dom.firstChild;for(let u=0,m=0;;){let b=m,x=u<n.length?n[u++]:null,A=!1;if(x){let D=x.elementClass;D&&(o+=" "+D);for(let P=m;P<this.markers.length;P++)if(this.markers[P].compare(x)){b=P,A=!0;break}}else b=this.markers.length;for(;m<b;){let D=this.markers[m++];if(D.toDOM){D.destroy(h);let P=h.nextSibling;h.remove(),h=P}}if(!x)break;x.toDOM&&(A?h=h.nextSibling:this.dom.insertBefore(x.toDOM(t),h)),A&&m++}this.dom.className=o,this.markers=n}destroy(){this.setMarkers(null,[])}}function tl(a,t){if(a.length!=t.length)return!1;for(let n=0;n<a.length;n++)if(!a[n].compare(t[n]))return!1;return!0}const il=T.r$.define(),Ci=T.r$.define({combine(a){return(0,T.BO)(a,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(t,n){let o=Object.assign({},t);for(let h in n){let u=o[h],m=n[h];o[h]=u?(b,x,A)=>u(b,x,A)||m(b,x,A):m}return o}})}});class un extends ci{constructor(t){super(),this.number=t}eq(t){return this.number==t.number}toDOM(){return document.createTextNode(this.number)}}function Ts(a,t){return a.state.facet(Ci).formatNumber(t,a.state)}const Ds=fi.compute([Ci],a=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers(t){return t.state.facet(il)},lineMarker(t,n,o){return o.some(h=>h.toDOM)?null:new un(Ts(t,t.state.doc.lineAt(n.from).number))},lineMarkerChange:t=>t.startState.facet(Ci)!=t.state.facet(Ci),initialSpacer(t){return new un(Ts(t,nl(t.state.doc.lines)))},updateSpacer(t,n){let o=Ts(n.view,nl(n.view.state.doc.lines));return o==t.number?t:new un(o)},domEventHandlers:a.facet(Ci).domEventHandlers}));function qr(a={}){return[Ci.of(a),Hr(),Ds]}function nl(a){let t=9;for(;t<a;)t=t*10+9;return t}const sl=new class extends ci{constructor(){super(...arguments),this.elementClass="cm-activeLineGutter"}},rl=zn.compute(["selection"],a=>{let t=[],n=-1;for(let o of a.selection.ranges)if(o.empty){let h=a.doc.lineAt(o.head).from;h>n&&(n=h,t.push(sl.range(h)))}return T.Xs.of(t)});function ol(){return rl}const Ta={HeightMap:rt,HeightOracle:sr,MeasuredHeights:rr,QueryType:we,ChangedRange:C,computeOrder:ve,moveVisually:en}},28699:function(lo,Ui,Ht){Ht.d(Ui,{V:function(){return ze}});const T="\u037C",B=typeof Symbol>"u"?"__"+T:Symbol.for(T),Oe=typeof Symbol>"u"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),Kt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{};class ze{constructor(ie,Pe){this.rules=[];let{finish:he}=Pe||{};function je(Y){return/^@/.test(Y)?[Y]:Y.split(/,\s*/)}function Z(Y,Ae,ke,Pt){let mt=[],tt=/^@(\w+)\b/.exec(Y[0]),Be=tt&&tt[1]=="keyframes";if(tt&&Ae==null)return ke.push(Y[0]+";");for(let gt in Ae){let st=Ae[gt];if(/&/.test(gt))Z(gt.split(/,\s*/).map(Bt=>Y.map(me=>Bt.replace(/&/,me))).reduce((Bt,me)=>Bt.concat(me)),st,ke);else if(st&&typeof st=="object"){if(!tt)throw new RangeError("The value of a property ("+gt+") should be a primitive value.");Z(je(gt),st,mt,Be)}else st!=null&&mt.push(gt.replace(/_.*/,"").replace(/[A-Z]/g,Bt=>"-"+Bt.toLowerCase())+": "+st+";")}(mt.length||Be)&&ke.push((he&&!tt&&!Pt?Y.map(he):Y).join(", ")+" {"+mt.join(" ")+"}")}for(let Y in ie)Z(je(Y),ie[Y],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let ie=Kt[B]||1;return Kt[B]=ie+1,T+ie.toString(36)}static mount(ie,Pe,he){let je=ie[Oe],Z=he&&he.nonce;je?Z&&je.setNonce(Z):je=new Te(ie,Z),je.mount(Array.isArray(Pe)?Pe:[Pe],ie)}}let te=new Map;class Te{constructor(ie,Pe){let he=ie.ownerDocument||ie,je=he.defaultView;if(!ie.head&&ie.adoptedStyleSheets&&je.CSSStyleSheet){let Z=te.get(he);if(Z)return ie[Oe]=Z;this.sheet=new je.CSSStyleSheet,te.set(he,this)}else this.styleTag=he.createElement("style"),Pe&&this.styleTag.setAttribute("nonce",Pe);this.modules=[],ie[Oe]=this}mount(ie,Pe){let he=this.sheet,je=0,Z=0;for(let Y=0;Y<ie.length;Y++){let Ae=ie[Y],ke=this.modules.indexOf(Ae);if(ke<Z&&ke>-1&&(this.modules.splice(ke,1),Z--,ke=-1),ke==-1){if(this.modules.splice(Z++,0,Ae),he)for(let Pt=0;Pt<Ae.rules.length;Pt++)he.insertRule(Ae.rules[Pt],je++)}else{for(;Z<ke;)je+=this.modules[Z++].rules.length;je+=Ae.rules.length,Z++}}if(he)Pe.adoptedStyleSheets.indexOf(this.sheet)<0&&(Pe.adoptedStyleSheets=[this.sheet,...Pe.adoptedStyleSheets]);else{let Y="";for(let ke=0;ke<this.modules.length;ke++)Y+=this.modules[ke].getRules()+`
`;this.styleTag.textContent=Y;let Ae=Pe.head||Pe;this.styleTag.parentNode!=Ae&&Ae.insertBefore(this.styleTag,Ae.firstChild)}}setNonce(ie){this.styleTag&&this.styleTag.getAttribute("nonce")!=ie&&this.styleTag.setAttribute("nonce",ie)}}}}]);
